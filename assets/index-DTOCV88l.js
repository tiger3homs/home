const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ServicesSection-CojDcNF_.js","assets/react-vendor-DtCFcp6s.js","assets/firebase-vendor-CAk-8R_y.js","assets/ProjectsSection-BoCnFBN1.js","assets/ContactSection-BrHP75uJ.js"])))=>i.map(i=>d[i]);
import{r as F,a as cd,u as uc,B as ud,R as hd,b as Ur,N as hc}from"./react-vendor-DtCFcp6s.js";import{L as dd,_ as fd,C as md,r as qa,F as gd,a as pd,g as yd,b as _d,c as bd,d as ve,e as vd,f as wd,S as Td,h as te,i as Ed,j as Ad,k as Id,l as xd,o as dc,s as Rd,m as Cd}from"./firebase-vendor-CAk-8R_y.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();var fc={exports:{}},bs={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pd=F,Sd=Symbol.for("react.element"),kd=Symbol.for("react.fragment"),Vd=Object.prototype.hasOwnProperty,Nd=Pd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Dd={key:!0,ref:!0,__self:!0,__source:!0};function mc(n,t,e){var r,s={},o=null,a=null;e!==void 0&&(o=""+e),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)Vd.call(t,r)&&!Dd.hasOwnProperty(r)&&(s[r]=t[r]);if(n&&n.defaultProps)for(r in t=n.defaultProps,t)s[r]===void 0&&(s[r]=t[r]);return{$$typeof:Sd,type:n,key:o,ref:a,props:s,_owner:Nd.current}}bs.Fragment=kd;bs.jsx=mc;bs.jsxs=mc;fc.exports=bs;var w=fc.exports,gc,Ba=cd;gc=Ba.createRoot,Ba.hydrateRoot;const Ld="modulepreload",Md=function(n){return"/home/"+n},za={},zi=function(t,e,r){let s=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(e.map(u=>{if(u=Md(u),u in za)return;za[u]=!0;const d=u.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const _=document.createElement("link");if(_.rel=d?"stylesheet":Ld,d||(_.as="script"),_.crossOrigin="",_.href=u,l&&_.setAttribute("nonce",l),document.head.appendChild(_),d)return new Promise((v,I)=>{_.addEventListener("load",v),_.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})};/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jd=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Fd=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,r)=>r?r.toUpperCase():e.toLowerCase()),Ga=n=>{const t=Fd(n);return t.charAt(0).toUpperCase()+t.slice(1)},pc=(...n)=>n.filter((t,e,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===e).join(" ").trim();/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Od={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ud=F.forwardRef(({color:n="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:r,className:s="",children:o,iconNode:a,...l},u)=>F.createElement("svg",{ref:u,...Od,width:t,height:t,stroke:n,strokeWidth:r?Number(e)*24/Number(t):e,className:pc("lucide",s),...l},[...a.map(([d,f])=>F.createElement(d,f)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=(n,t)=>{const e=F.forwardRef(({className:r,...s},o)=>F.createElement(Ud,{ref:o,iconNode:t,className:pc(`lucide-${jd(Ga(n))}`,`lucide-${n}`,r),...s}));return e.displayName=Ga(n),e};/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $d=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],qd=Xt("arrow-down",$d);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bd=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],zd=Xt("arrow-up",Bd);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gd=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Kd=Xt("circle-plus",Gd);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wd=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Qd=Xt("circle-x",Wd);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hd=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],Xd=Xt("facebook",Hd);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yd=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],Jd=Xt("github",Yd);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zd=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],tf=Xt("instagram",Zd);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ef=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],nf=Xt("linkedin",ef);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rf=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],sf=Xt("mail",rf);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const of=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],af=Xt("save",of);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lf=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],cf=Xt("square-pen",lf);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uf=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],hf=Xt("trash-2",uf);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const df=[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]],ff=Xt("twitter",df),ir={_origin:"https://api.emailjs.com"},mf=(n,t="https://api.emailjs.com")=>{ir._userID=n,ir._origin=t},yc=(n,t,e)=>{if(!n)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!e)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class Ka{constructor(t){this.status=t.status,this.text=t.responseText}}const _c=(n,t,e={})=>new Promise((r,s)=>{const o=new XMLHttpRequest;o.addEventListener("load",({target:a})=>{const l=new Ka(a);l.status===200||l.text==="OK"?r(l):s(l)}),o.addEventListener("error",({target:a})=>{s(new Ka(a))}),o.open("POST",ir._origin+n,!0),Object.keys(e).forEach(a=>{o.setRequestHeader(a,e[a])}),o.send(t)}),gf=(n,t,e,r)=>{const s=r||ir._userID;return yc(s,n,t),_c("/api/v1.0/email/send",JSON.stringify({lib_version:"3.2.0",user_id:s,service_id:n,template_id:t,template_params:e}),{"Content-type":"application/json"})},pf=n=>{let t;if(typeof n=="string"?t=document.querySelector(n):t=n,!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return t},yf=(n,t,e,r)=>{const s=r||ir._userID,o=pf(e);yc(s,n,t);const a=new FormData(o);return a.append("lib_version","3.2.0"),a.append("service_id",n),a.append("template_id",t),a.append("user_id",s),_c("/api/v1.0/email/send-form",a)},Wa={init:mf,send:gf,sendForm:yf};var Qa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ke,bc;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(y,m){function p(){}p.prototype=m.prototype,y.D=m.prototype,y.prototype=new p,y.prototype.constructor=y,y.C=function(b,E,A){for(var T=Array(arguments.length-2),lt=2;lt<arguments.length;lt++)T[lt-2]=arguments[lt];return m.prototype[E].apply(b,T)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(y,m,p){p||(p=0);var b=Array(16);if(typeof m=="string")for(var E=0;16>E;++E)b[E]=m.charCodeAt(p++)|m.charCodeAt(p++)<<8|m.charCodeAt(p++)<<16|m.charCodeAt(p++)<<24;else for(E=0;16>E;++E)b[E]=m[p++]|m[p++]<<8|m[p++]<<16|m[p++]<<24;m=y.g[0],p=y.g[1],E=y.g[2];var A=y.g[3],T=m+(A^p&(E^A))+b[0]+3614090360&4294967295;m=p+(T<<7&4294967295|T>>>25),T=A+(E^m&(p^E))+b[1]+3905402710&4294967295,A=m+(T<<12&4294967295|T>>>20),T=E+(p^A&(m^p))+b[2]+606105819&4294967295,E=A+(T<<17&4294967295|T>>>15),T=p+(m^E&(A^m))+b[3]+3250441966&4294967295,p=E+(T<<22&4294967295|T>>>10),T=m+(A^p&(E^A))+b[4]+4118548399&4294967295,m=p+(T<<7&4294967295|T>>>25),T=A+(E^m&(p^E))+b[5]+1200080426&4294967295,A=m+(T<<12&4294967295|T>>>20),T=E+(p^A&(m^p))+b[6]+2821735955&4294967295,E=A+(T<<17&4294967295|T>>>15),T=p+(m^E&(A^m))+b[7]+4249261313&4294967295,p=E+(T<<22&4294967295|T>>>10),T=m+(A^p&(E^A))+b[8]+1770035416&4294967295,m=p+(T<<7&4294967295|T>>>25),T=A+(E^m&(p^E))+b[9]+2336552879&4294967295,A=m+(T<<12&4294967295|T>>>20),T=E+(p^A&(m^p))+b[10]+4294925233&4294967295,E=A+(T<<17&4294967295|T>>>15),T=p+(m^E&(A^m))+b[11]+2304563134&4294967295,p=E+(T<<22&4294967295|T>>>10),T=m+(A^p&(E^A))+b[12]+1804603682&4294967295,m=p+(T<<7&4294967295|T>>>25),T=A+(E^m&(p^E))+b[13]+4254626195&4294967295,A=m+(T<<12&4294967295|T>>>20),T=E+(p^A&(m^p))+b[14]+2792965006&4294967295,E=A+(T<<17&4294967295|T>>>15),T=p+(m^E&(A^m))+b[15]+1236535329&4294967295,p=E+(T<<22&4294967295|T>>>10),T=m+(E^A&(p^E))+b[1]+4129170786&4294967295,m=p+(T<<5&4294967295|T>>>27),T=A+(p^E&(m^p))+b[6]+3225465664&4294967295,A=m+(T<<9&4294967295|T>>>23),T=E+(m^p&(A^m))+b[11]+643717713&4294967295,E=A+(T<<14&4294967295|T>>>18),T=p+(A^m&(E^A))+b[0]+3921069994&4294967295,p=E+(T<<20&4294967295|T>>>12),T=m+(E^A&(p^E))+b[5]+3593408605&4294967295,m=p+(T<<5&4294967295|T>>>27),T=A+(p^E&(m^p))+b[10]+38016083&4294967295,A=m+(T<<9&4294967295|T>>>23),T=E+(m^p&(A^m))+b[15]+3634488961&4294967295,E=A+(T<<14&4294967295|T>>>18),T=p+(A^m&(E^A))+b[4]+3889429448&4294967295,p=E+(T<<20&4294967295|T>>>12),T=m+(E^A&(p^E))+b[9]+568446438&4294967295,m=p+(T<<5&4294967295|T>>>27),T=A+(p^E&(m^p))+b[14]+3275163606&4294967295,A=m+(T<<9&4294967295|T>>>23),T=E+(m^p&(A^m))+b[3]+4107603335&4294967295,E=A+(T<<14&4294967295|T>>>18),T=p+(A^m&(E^A))+b[8]+1163531501&4294967295,p=E+(T<<20&4294967295|T>>>12),T=m+(E^A&(p^E))+b[13]+2850285829&4294967295,m=p+(T<<5&4294967295|T>>>27),T=A+(p^E&(m^p))+b[2]+4243563512&4294967295,A=m+(T<<9&4294967295|T>>>23),T=E+(m^p&(A^m))+b[7]+1735328473&4294967295,E=A+(T<<14&4294967295|T>>>18),T=p+(A^m&(E^A))+b[12]+2368359562&4294967295,p=E+(T<<20&4294967295|T>>>12),T=m+(p^E^A)+b[5]+4294588738&4294967295,m=p+(T<<4&4294967295|T>>>28),T=A+(m^p^E)+b[8]+2272392833&4294967295,A=m+(T<<11&4294967295|T>>>21),T=E+(A^m^p)+b[11]+1839030562&4294967295,E=A+(T<<16&4294967295|T>>>16),T=p+(E^A^m)+b[14]+4259657740&4294967295,p=E+(T<<23&4294967295|T>>>9),T=m+(p^E^A)+b[1]+2763975236&4294967295,m=p+(T<<4&4294967295|T>>>28),T=A+(m^p^E)+b[4]+1272893353&4294967295,A=m+(T<<11&4294967295|T>>>21),T=E+(A^m^p)+b[7]+4139469664&4294967295,E=A+(T<<16&4294967295|T>>>16),T=p+(E^A^m)+b[10]+3200236656&4294967295,p=E+(T<<23&4294967295|T>>>9),T=m+(p^E^A)+b[13]+681279174&4294967295,m=p+(T<<4&4294967295|T>>>28),T=A+(m^p^E)+b[0]+3936430074&4294967295,A=m+(T<<11&4294967295|T>>>21),T=E+(A^m^p)+b[3]+3572445317&4294967295,E=A+(T<<16&4294967295|T>>>16),T=p+(E^A^m)+b[6]+76029189&4294967295,p=E+(T<<23&4294967295|T>>>9),T=m+(p^E^A)+b[9]+3654602809&4294967295,m=p+(T<<4&4294967295|T>>>28),T=A+(m^p^E)+b[12]+3873151461&4294967295,A=m+(T<<11&4294967295|T>>>21),T=E+(A^m^p)+b[15]+530742520&4294967295,E=A+(T<<16&4294967295|T>>>16),T=p+(E^A^m)+b[2]+3299628645&4294967295,p=E+(T<<23&4294967295|T>>>9),T=m+(E^(p|~A))+b[0]+4096336452&4294967295,m=p+(T<<6&4294967295|T>>>26),T=A+(p^(m|~E))+b[7]+1126891415&4294967295,A=m+(T<<10&4294967295|T>>>22),T=E+(m^(A|~p))+b[14]+2878612391&4294967295,E=A+(T<<15&4294967295|T>>>17),T=p+(A^(E|~m))+b[5]+4237533241&4294967295,p=E+(T<<21&4294967295|T>>>11),T=m+(E^(p|~A))+b[12]+1700485571&4294967295,m=p+(T<<6&4294967295|T>>>26),T=A+(p^(m|~E))+b[3]+2399980690&4294967295,A=m+(T<<10&4294967295|T>>>22),T=E+(m^(A|~p))+b[10]+4293915773&4294967295,E=A+(T<<15&4294967295|T>>>17),T=p+(A^(E|~m))+b[1]+2240044497&4294967295,p=E+(T<<21&4294967295|T>>>11),T=m+(E^(p|~A))+b[8]+1873313359&4294967295,m=p+(T<<6&4294967295|T>>>26),T=A+(p^(m|~E))+b[15]+4264355552&4294967295,A=m+(T<<10&4294967295|T>>>22),T=E+(m^(A|~p))+b[6]+2734768916&4294967295,E=A+(T<<15&4294967295|T>>>17),T=p+(A^(E|~m))+b[13]+1309151649&4294967295,p=E+(T<<21&4294967295|T>>>11),T=m+(E^(p|~A))+b[4]+4149444226&4294967295,m=p+(T<<6&4294967295|T>>>26),T=A+(p^(m|~E))+b[11]+3174756917&4294967295,A=m+(T<<10&4294967295|T>>>22),T=E+(m^(A|~p))+b[2]+718787259&4294967295,E=A+(T<<15&4294967295|T>>>17),T=p+(A^(E|~m))+b[9]+3951481745&4294967295,y.g[0]=y.g[0]+m&4294967295,y.g[1]=y.g[1]+(E+(T<<21&4294967295|T>>>11))&4294967295,y.g[2]=y.g[2]+E&4294967295,y.g[3]=y.g[3]+A&4294967295}r.prototype.u=function(y,m){m===void 0&&(m=y.length);for(var p=m-this.blockSize,b=this.B,E=this.h,A=0;A<m;){if(E==0)for(;A<=p;)s(this,y,A),A+=this.blockSize;if(typeof y=="string"){for(;A<m;)if(b[E++]=y.charCodeAt(A++),E==this.blockSize){s(this,b),E=0;break}}else for(;A<m;)if(b[E++]=y[A++],E==this.blockSize){s(this,b),E=0;break}}this.h=E,this.o+=m},r.prototype.v=function(){var y=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);y[0]=128;for(var m=1;m<y.length-8;++m)y[m]=0;var p=8*this.o;for(m=y.length-8;m<y.length;++m)y[m]=p&255,p/=256;for(this.u(y),y=Array(16),m=p=0;4>m;++m)for(var b=0;32>b;b+=8)y[p++]=this.g[m]>>>b&255;return y};function o(y,m){var p=l;return Object.prototype.hasOwnProperty.call(p,y)?p[y]:p[y]=m(y)}function a(y,m){this.h=m;for(var p=[],b=!0,E=y.length-1;0<=E;E--){var A=y[E]|0;b&&A==m||(p[E]=A,b=!1)}this.g=p}var l={};function u(y){return-128<=y&&128>y?o(y,function(m){return new a([m|0],0>m?-1:0)}):new a([y|0],0>y?-1:0)}function d(y){if(isNaN(y)||!isFinite(y))return _;if(0>y)return R(d(-y));for(var m=[],p=1,b=0;y>=p;b++)m[b]=y/p|0,p*=4294967296;return new a(m,0)}function f(y,m){if(y.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(y.charAt(0)=="-")return R(f(y.substring(1),m));if(0<=y.indexOf("-"))throw Error('number format error: interior "-" character');for(var p=d(Math.pow(m,8)),b=_,E=0;E<y.length;E+=8){var A=Math.min(8,y.length-E),T=parseInt(y.substring(E,E+A),m);8>A?(A=d(Math.pow(m,A)),b=b.j(A).add(d(T))):(b=b.j(p),b=b.add(d(T)))}return b}var _=u(0),v=u(1),I=u(16777216);n=a.prototype,n.m=function(){if(S(this))return-R(this).m();for(var y=0,m=1,p=0;p<this.g.length;p++){var b=this.i(p);y+=(0<=b?b:4294967296+b)*m,m*=4294967296}return y},n.toString=function(y){if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(C(this))return"0";if(S(this))return"-"+R(this).toString(y);for(var m=d(Math.pow(y,6)),p=this,b="";;){var E=z(p,m).g;p=N(p,E.j(m));var A=((0<p.g.length?p.g[0]:p.h)>>>0).toString(y);if(p=E,C(p))return A+b;for(;6>A.length;)A="0"+A;b=A+b}},n.i=function(y){return 0>y?0:y<this.g.length?this.g[y]:this.h};function C(y){if(y.h!=0)return!1;for(var m=0;m<y.g.length;m++)if(y.g[m]!=0)return!1;return!0}function S(y){return y.h==-1}n.l=function(y){return y=N(this,y),S(y)?-1:C(y)?0:1};function R(y){for(var m=y.g.length,p=[],b=0;b<m;b++)p[b]=~y.g[b];return new a(p,~y.h).add(v)}n.abs=function(){return S(this)?R(this):this},n.add=function(y){for(var m=Math.max(this.g.length,y.g.length),p=[],b=0,E=0;E<=m;E++){var A=b+(this.i(E)&65535)+(y.i(E)&65535),T=(A>>>16)+(this.i(E)>>>16)+(y.i(E)>>>16);b=T>>>16,A&=65535,T&=65535,p[E]=T<<16|A}return new a(p,p[p.length-1]&-2147483648?-1:0)};function N(y,m){return y.add(R(m))}n.j=function(y){if(C(this)||C(y))return _;if(S(this))return S(y)?R(this).j(R(y)):R(R(this).j(y));if(S(y))return R(this.j(R(y)));if(0>this.l(I)&&0>y.l(I))return d(this.m()*y.m());for(var m=this.g.length+y.g.length,p=[],b=0;b<2*m;b++)p[b]=0;for(b=0;b<this.g.length;b++)for(var E=0;E<y.g.length;E++){var A=this.i(b)>>>16,T=this.i(b)&65535,lt=y.i(E)>>>16,Ot=y.i(E)&65535;p[2*b+2*E]+=T*Ot,j(p,2*b+2*E),p[2*b+2*E+1]+=A*Ot,j(p,2*b+2*E+1),p[2*b+2*E+1]+=T*lt,j(p,2*b+2*E+1),p[2*b+2*E+2]+=A*lt,j(p,2*b+2*E+2)}for(b=0;b<m;b++)p[b]=p[2*b+1]<<16|p[2*b];for(b=m;b<2*m;b++)p[b]=0;return new a(p,0)};function j(y,m){for(;(y[m]&65535)!=y[m];)y[m+1]+=y[m]>>>16,y[m]&=65535,m++}function $(y,m){this.g=y,this.h=m}function z(y,m){if(C(m))throw Error("division by zero");if(C(y))return new $(_,_);if(S(y))return m=z(R(y),m),new $(R(m.g),R(m.h));if(S(m))return m=z(y,R(m)),new $(R(m.g),m.h);if(30<y.g.length){if(S(y)||S(m))throw Error("slowDivide_ only works with positive integers.");for(var p=v,b=m;0>=b.l(y);)p=it(p),b=it(b);var E=D(p,1),A=D(b,1);for(b=D(b,2),p=D(p,2);!C(b);){var T=A.add(b);0>=T.l(y)&&(E=E.add(p),A=T),b=D(b,1),p=D(p,1)}return m=N(y,E.j(m)),new $(E,m)}for(E=_;0<=y.l(m);){for(p=Math.max(1,Math.floor(y.m()/m.m())),b=Math.ceil(Math.log(p)/Math.LN2),b=48>=b?1:Math.pow(2,b-48),A=d(p),T=A.j(m);S(T)||0<T.l(y);)p-=b,A=d(p),T=A.j(m);C(A)&&(A=v),E=E.add(A),y=N(y,T)}return new $(E,y)}n.A=function(y){return z(this,y).h},n.and=function(y){for(var m=Math.max(this.g.length,y.g.length),p=[],b=0;b<m;b++)p[b]=this.i(b)&y.i(b);return new a(p,this.h&y.h)},n.or=function(y){for(var m=Math.max(this.g.length,y.g.length),p=[],b=0;b<m;b++)p[b]=this.i(b)|y.i(b);return new a(p,this.h|y.h)},n.xor=function(y){for(var m=Math.max(this.g.length,y.g.length),p=[],b=0;b<m;b++)p[b]=this.i(b)^y.i(b);return new a(p,this.h^y.h)};function it(y){for(var m=y.g.length+1,p=[],b=0;b<m;b++)p[b]=y.i(b)<<1|y.i(b-1)>>>31;return new a(p,y.h)}function D(y,m){var p=m>>5;m%=32;for(var b=y.g.length-p,E=[],A=0;A<b;A++)E[A]=0<m?y.i(A+p)>>>m|y.i(A+p+1)<<32-m:y.i(A+p);return new a(E,y.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,bc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,ke=a}).apply(typeof Qa<"u"?Qa:typeof self<"u"?self:typeof window<"u"?window:{});var $r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var vc,Yn,wc,Yr,wi,Tc,Ec,Ac;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,c,h){return i==Array.prototype||i==Object.prototype||(i[c]=h.value),i};function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof $r=="object"&&$r];for(var c=0;c<i.length;++c){var h=i[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=e(this);function s(i,c){if(c)t:{var h=r;i=i.split(".");for(var g=0;g<i.length-1;g++){var x=i[g];if(!(x in h))break t;h=h[x]}i=i[i.length-1],g=h[i],c=c(g),c!=g&&c!=null&&t(h,i,{configurable:!0,writable:!0,value:c})}}function o(i,c){i instanceof String&&(i+="");var h=0,g=!1,x={next:function(){if(!g&&h<i.length){var P=h++;return{value:c(P,i[P]),done:!1}}return g=!0,{done:!0,value:void 0}}};return x[Symbol.iterator]=function(){return x},x}s("Array.prototype.values",function(i){return i||function(){return o(this,function(c,h){return h})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function u(i){var c=typeof i;return c=c!="object"?c:i?Array.isArray(i)?"array":c:"null",c=="array"||c=="object"&&typeof i.length=="number"}function d(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function f(i,c,h){return i.call.apply(i.bind,arguments)}function _(i,c,h){if(!i)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var x=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(x,g),i.apply(c,x)}}return function(){return i.apply(c,arguments)}}function v(i,c,h){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:_,v.apply(null,arguments)}function I(i,c){var h=Array.prototype.slice.call(arguments,1);return function(){var g=h.slice();return g.push.apply(g,arguments),i.apply(this,g)}}function C(i,c){function h(){}h.prototype=c.prototype,i.aa=c.prototype,i.prototype=new h,i.prototype.constructor=i,i.Qb=function(g,x,P){for(var M=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)M[ut-2]=arguments[ut];return c.prototype[x].apply(g,M)}}function S(i){const c=i.length;if(0<c){const h=Array(c);for(let g=0;g<c;g++)h[g]=i[g];return h}return[]}function R(i,c){for(let h=1;h<arguments.length;h++){const g=arguments[h];if(u(g)){const x=i.length||0,P=g.length||0;i.length=x+P;for(let M=0;M<P;M++)i[x+M]=g[M]}else i.push(g)}}class N{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function j(i){return/^[\s\xa0]*$/.test(i)}function $(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function z(i){return z[" "](i),i}z[" "]=function(){};var it=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function D(i,c,h){for(const g in i)c.call(h,i[g],g,i)}function y(i,c){for(const h in i)c.call(void 0,i[h],h,i)}function m(i){const c={};for(const h in i)c[h]=i[h];return c}const p="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(i,c){let h,g;for(let x=1;x<arguments.length;x++){g=arguments[x];for(h in g)i[h]=g[h];for(let P=0;P<p.length;P++)h=p[P],Object.prototype.hasOwnProperty.call(g,h)&&(i[h]=g[h])}}function E(i){var c=1;i=i.split(":");const h=[];for(;0<c&&i.length;)h.push(i.shift()),c--;return i.length&&h.push(i.join(":")),h}function A(i){l.setTimeout(()=>{throw i},0)}function T(){var i=Ge;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class lt{constructor(){this.h=this.g=null}add(c,h){const g=Ot.get();g.set(c,h),this.h?this.h.next=g:this.g=g,this.h=g}}var Ot=new N(()=>new ge,i=>i.reset());class ge{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Yt,Wt=!1,Ge=new lt,Nn=()=>{const i=l.Promise.resolve(void 0);Yt=()=>{i.then(Dn)}};var Dn=()=>{for(var i;i=T();){try{i.h.call(i.g)}catch(h){A(h)}var c=Ot;c.j(i),100>c.h&&(c.h++,i.next=c.g,c.g=i)}Wt=!1};function Jt(){this.s=this.s,this.C=this.C}Jt.prototype.s=!1,Jt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Jt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var J=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const h=()=>{};l.addEventListener("test",h,c),l.removeEventListener("test",h,c)}catch{}return i}();function Z(i,c){if(q.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var h=this.type=i.type,g=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget){if(it){t:{try{z(c.nodeName);var x=!0;break t}catch{}x=!1}x||(c=null)}}else h=="mouseover"?c=i.fromElement:h=="mouseout"&&(c=i.toElement);this.relatedTarget=c,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:ht[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&Z.aa.h.call(this)}}C(Z,q);var ht={2:"touch",3:"pen",4:"mouse"};Z.prototype.h=function(){Z.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var ct="closure_listenable_"+(1e6*Math.random()|0),Pt=0;function ne(i,c,h,g,x){this.listener=i,this.proxy=null,this.src=c,this.type=h,this.capture=!!g,this.ha=x,this.key=++Pt,this.da=this.fa=!1}function ae(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function le(i){this.src=i,this.g={},this.h=0}le.prototype.add=function(i,c,h,g,x){var P=i.toString();i=this.g[P],i||(i=this.g[P]=[],this.h++);var M=Mn(i,c,g,x);return-1<M?(c=i[M],h||(c.fa=!1)):(c=new ne(c,this.src,P,!!g,x),c.fa=h,i.push(c)),c};function Ln(i,c){var h=c.type;if(h in i.g){var g=i.g[h],x=Array.prototype.indexOf.call(g,c,void 0),P;(P=0<=x)&&Array.prototype.splice.call(g,x,1),P&&(ae(c),i.g[h].length==0&&(delete i.g[h],i.h--))}}function Mn(i,c,h,g){for(var x=0;x<i.length;++x){var P=i[x];if(!P.da&&P.listener==c&&P.capture==!!h&&P.ha==g)return x}return-1}var js="closure_lm_"+(1e6*Math.random()|0),Fs={};function Bo(i,c,h,g,x){if(Array.isArray(c)){for(var P=0;P<c.length;P++)Bo(i,c[P],h,g,x);return null}return h=Ko(h),i&&i[ct]?i.K(c,h,d(g)?!!g.capture:!!g,x):Dh(i,c,h,!1,g,x)}function Dh(i,c,h,g,x,P){if(!c)throw Error("Invalid event type");var M=d(x)?!!x.capture:!!x,ut=Us(i);if(ut||(i[js]=ut=new le(i)),h=ut.add(c,h,g,M,P),h.proxy)return h;if(g=Lh(),h.proxy=g,g.src=i,g.listener=h,i.addEventListener)J||(x=M),x===void 0&&(x=!1),i.addEventListener(c.toString(),g,x);else if(i.attachEvent)i.attachEvent(Go(c.toString()),g);else if(i.addListener&&i.removeListener)i.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Lh(){function i(h){return c.call(i.src,i.listener,h)}const c=Mh;return i}function zo(i,c,h,g,x){if(Array.isArray(c))for(var P=0;P<c.length;P++)zo(i,c[P],h,g,x);else g=d(g)?!!g.capture:!!g,h=Ko(h),i&&i[ct]?(i=i.i,c=String(c).toString(),c in i.g&&(P=i.g[c],h=Mn(P,h,g,x),-1<h&&(ae(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete i.g[c],i.h--)))):i&&(i=Us(i))&&(c=i.g[c.toString()],i=-1,c&&(i=Mn(c,h,g,x)),(h=-1<i?c[i]:null)&&Os(h))}function Os(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[ct])Ln(c.i,i);else{var h=i.type,g=i.proxy;c.removeEventListener?c.removeEventListener(h,g,i.capture):c.detachEvent?c.detachEvent(Go(h),g):c.addListener&&c.removeListener&&c.removeListener(g),(h=Us(c))?(Ln(h,i),h.h==0&&(h.src=null,c[js]=null)):ae(i)}}}function Go(i){return i in Fs?Fs[i]:Fs[i]="on"+i}function Mh(i,c){if(i.da)i=!0;else{c=new Z(c,this);var h=i.listener,g=i.ha||i.src;i.fa&&Os(i),i=h.call(g,c)}return i}function Us(i){return i=i[js],i instanceof le?i:null}var $s="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ko(i){return typeof i=="function"?i:(i[$s]||(i[$s]=function(c){return i.handleEvent(c)}),i[$s])}function St(){Jt.call(this),this.i=new le(this),this.M=this,this.F=null}C(St,Jt),St.prototype[ct]=!0,St.prototype.removeEventListener=function(i,c,h,g){zo(this,i,c,h,g)};function Ut(i,c){var h,g=i.F;if(g)for(h=[];g;g=g.F)h.push(g);if(i=i.M,g=c.type||c,typeof c=="string")c=new q(c,i);else if(c instanceof q)c.target=c.target||i;else{var x=c;c=new q(g,i),b(c,x)}if(x=!0,h)for(var P=h.length-1;0<=P;P--){var M=c.g=h[P];x=Ar(M,g,!0,c)&&x}if(M=c.g=i,x=Ar(M,g,!0,c)&&x,x=Ar(M,g,!1,c)&&x,h)for(P=0;P<h.length;P++)M=c.g=h[P],x=Ar(M,g,!1,c)&&x}St.prototype.N=function(){if(St.aa.N.call(this),this.i){var i=this.i,c;for(c in i.g){for(var h=i.g[c],g=0;g<h.length;g++)ae(h[g]);delete i.g[c],i.h--}}this.F=null},St.prototype.K=function(i,c,h,g){return this.i.add(String(i),c,!1,h,g)},St.prototype.L=function(i,c,h,g){return this.i.add(String(i),c,!0,h,g)};function Ar(i,c,h,g){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();for(var x=!0,P=0;P<c.length;++P){var M=c[P];if(M&&!M.da&&M.capture==h){var ut=M.listener,At=M.ha||M.src;M.fa&&Ln(i.i,M),x=ut.call(At,g)!==!1&&x}}return x&&!g.defaultPrevented}function Wo(i,c,h){if(typeof i=="function")h&&(i=v(i,h));else if(i&&typeof i.handleEvent=="function")i=v(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:l.setTimeout(i,c||0)}function Qo(i){i.g=Wo(()=>{i.g=null,i.i&&(i.i=!1,Qo(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class jh extends Jt{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Qo(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function jn(i){Jt.call(this),this.h=i,this.g={}}C(jn,Jt);var Ho=[];function Xo(i){D(i.g,function(c,h){this.g.hasOwnProperty(h)&&Os(c)},i),i.g={}}jn.prototype.N=function(){jn.aa.N.call(this),Xo(this)},jn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var qs=l.JSON.stringify,Fh=l.JSON.parse,Oh=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function Bs(){}Bs.prototype.h=null;function Yo(i){return i.h||(i.h=i.i())}function Jo(){}var Fn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function zs(){q.call(this,"d")}C(zs,q);function Gs(){q.call(this,"c")}C(Gs,q);var Ke={},Zo=null;function Ir(){return Zo=Zo||new St}Ke.La="serverreachability";function ta(i){q.call(this,Ke.La,i)}C(ta,q);function On(i){const c=Ir();Ut(c,new ta(c))}Ke.STAT_EVENT="statevent";function ea(i,c){q.call(this,Ke.STAT_EVENT,i),this.stat=c}C(ea,q);function $t(i){const c=Ir();Ut(c,new ea(c,i))}Ke.Ma="timingevent";function na(i,c){q.call(this,Ke.Ma,i),this.size=c}C(na,q);function Un(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},c)}function $n(){this.g=!0}$n.prototype.xa=function(){this.g=!1};function Uh(i,c,h,g,x,P){i.info(function(){if(i.g)if(P)for(var M="",ut=P.split("&"),At=0;At<ut.length;At++){var ot=ut[At].split("=");if(1<ot.length){var kt=ot[0];ot=ot[1];var Vt=kt.split("_");M=2<=Vt.length&&Vt[1]=="type"?M+(kt+"="+ot+"&"):M+(kt+"=redacted&")}}else M=null;else M=P;return"XMLHTTP REQ ("+g+") [attempt "+x+"]: "+c+`
`+h+`
`+M})}function $h(i,c,h,g,x,P,M){i.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+x+"]: "+c+`
`+h+`
`+P+" "+M})}function nn(i,c,h,g){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Bh(i,h)+(g?" "+g:"")})}function qh(i,c){i.info(function(){return"TIMEOUT: "+c})}$n.prototype.info=function(){};function Bh(i,c){if(!i.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(i=0;i<h.length;i++)if(Array.isArray(h[i])){var g=h[i];if(!(2>g.length)){var x=g[1];if(Array.isArray(x)&&!(1>x.length)){var P=x[0];if(P!="noop"&&P!="stop"&&P!="close")for(var M=1;M<x.length;M++)x[M]=""}}}}return qs(h)}catch{return c}}var xr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ra={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ks;function Rr(){}C(Rr,Bs),Rr.prototype.g=function(){return new XMLHttpRequest},Rr.prototype.i=function(){return{}},Ks=new Rr;function xe(i,c,h,g){this.j=i,this.i=c,this.l=h,this.R=g||1,this.U=new jn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new sa}function sa(){this.i=null,this.g="",this.h=!1}var ia={},Ws={};function Qs(i,c,h){i.L=1,i.v=kr(pe(c)),i.m=h,i.P=!0,oa(i,null)}function oa(i,c){i.F=Date.now(),Cr(i),i.A=pe(i.v);var h=i.A,g=i.R;Array.isArray(g)||(g=[String(g)]),va(h.i,"t",g),i.C=0,h=i.j.J,i.h=new sa,i.g=Fa(i.j,h?c:null,!i.m),0<i.O&&(i.M=new jh(v(i.Y,i,i.g),i.O)),c=i.U,h=i.g,g=i.ca;var x="readystatechange";Array.isArray(x)||(x&&(Ho[0]=x.toString()),x=Ho);for(var P=0;P<x.length;P++){var M=Bo(h,x[P],g||c.handleEvent,!1,c.h||c);if(!M)break;c.g[M.key]=M}c=i.H?m(i.H):{},i.m?(i.u||(i.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,c)):(i.u="GET",i.g.ea(i.A,i.u,null,c)),On(),Uh(i.i,i.u,i.A,i.l,i.R,i.m)}xe.prototype.ca=function(i){i=i.target;const c=this.M;c&&ye(i)==3?c.j():this.Y(i)},xe.prototype.Y=function(i){try{if(i==this.g)t:{const Vt=ye(this.g);var c=this.g.Ba();const on=this.g.Z();if(!(3>Vt)&&(Vt!=3||this.g&&(this.h.h||this.g.oa()||Ra(this.g)))){this.J||Vt!=4||c==7||(c==8||0>=on?On(3):On(2)),Hs(this);var h=this.g.Z();this.X=h;e:if(aa(this)){var g=Ra(this.g);i="";var x=g.length,P=ye(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){We(this),qn(this);var M="";break e}this.h.i=new l.TextDecoder}for(c=0;c<x;c++)this.h.h=!0,i+=this.h.i.decode(g[c],{stream:!(P&&c==x-1)});g.length=0,this.h.g+=i,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=h==200,$h(this.i,this.u,this.A,this.l,this.R,Vt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var ut,At=this.g;if((ut=At.g?At.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(ut)){var ot=ut;break e}}ot=null}if(h=ot)nn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Xs(this,h);else{this.o=!1,this.s=3,$t(12),We(this),qn(this);break t}}if(this.P){h=!0;let re;for(;!this.J&&this.C<M.length;)if(re=zh(this,M),re==Ws){Vt==4&&(this.s=4,$t(14),h=!1),nn(this.i,this.l,null,"[Incomplete Response]");break}else if(re==ia){this.s=4,$t(15),nn(this.i,this.l,M,"[Invalid Chunk]"),h=!1;break}else nn(this.i,this.l,re,null),Xs(this,re);if(aa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Vt!=4||M.length!=0||this.h.h||(this.s=1,$t(16),h=!1),this.o=this.o&&h,!h)nn(this.i,this.l,M,"[Invalid Chunked Response]"),We(this),qn(this);else if(0<M.length&&!this.W){this.W=!0;var kt=this.j;kt.g==this&&kt.ba&&!kt.M&&(kt.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),ni(kt),kt.M=!0,$t(11))}}else nn(this.i,this.l,M,null),Xs(this,M);Vt==4&&We(this),this.o&&!this.J&&(Vt==4?Da(this.j,this):(this.o=!1,Cr(this)))}else ad(this.g),h==400&&0<M.indexOf("Unknown SID")?(this.s=3,$t(12)):(this.s=0,$t(13)),We(this),qn(this)}}}catch{}finally{}};function aa(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function zh(i,c){var h=i.C,g=c.indexOf(`
`,h);return g==-1?Ws:(h=Number(c.substring(h,g)),isNaN(h)?ia:(g+=1,g+h>c.length?Ws:(c=c.slice(g,g+h),i.C=g+h,c)))}xe.prototype.cancel=function(){this.J=!0,We(this)};function Cr(i){i.S=Date.now()+i.I,la(i,i.I)}function la(i,c){if(i.B!=null)throw Error("WatchDog timer not null");i.B=Un(v(i.ba,i),c)}function Hs(i){i.B&&(l.clearTimeout(i.B),i.B=null)}xe.prototype.ba=function(){this.B=null;const i=Date.now();0<=i-this.S?(qh(this.i,this.A),this.L!=2&&(On(),$t(17)),We(this),this.s=2,qn(this)):la(this,this.S-i)};function qn(i){i.j.G==0||i.J||Da(i.j,i)}function We(i){Hs(i);var c=i.M;c&&typeof c.ma=="function"&&c.ma(),i.M=null,Xo(i.U),i.g&&(c=i.g,i.g=null,c.abort(),c.ma())}function Xs(i,c){try{var h=i.j;if(h.G!=0&&(h.g==i||Ys(h.h,i))){if(!i.K&&Ys(h.h,i)&&h.G==3){try{var g=h.Da.g.parse(c)}catch{g=null}if(Array.isArray(g)&&g.length==3){var x=g;if(x[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<i.F)jr(h),Lr(h);else break t;ei(h),$t(18)}}else h.za=x[1],0<h.za-h.T&&37500>x[2]&&h.F&&h.v==0&&!h.C&&(h.C=Un(v(h.Za,h),6e3));if(1>=ha(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else He(h,11)}else if((i.K||h.g==i)&&jr(h),!j(c))for(x=h.Da.g.parse(c),c=0;c<x.length;c++){let ot=x[c];if(h.T=ot[0],ot=ot[1],h.G==2)if(ot[0]=="c"){h.K=ot[1],h.ia=ot[2];const kt=ot[3];kt!=null&&(h.la=kt,h.j.info("VER="+h.la));const Vt=ot[4];Vt!=null&&(h.Aa=Vt,h.j.info("SVER="+h.Aa));const on=ot[5];on!=null&&typeof on=="number"&&0<on&&(g=1.5*on,h.L=g,h.j.info("backChannelRequestTimeoutMs_="+g)),g=h;const re=i.g;if(re){const Or=re.g?re.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Or){var P=g.h;P.g||Or.indexOf("spdy")==-1&&Or.indexOf("quic")==-1&&Or.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Js(P,P.h),P.h=null))}if(g.D){const ri=re.g?re.g.getResponseHeader("X-HTTP-Session-Id"):null;ri&&(g.ya=ri,dt(g.I,g.D,ri))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-i.F,h.j.info("Handshake RTT: "+h.R+"ms")),g=h;var M=i;if(g.qa=ja(g,g.J?g.ia:null,g.W),M.K){da(g.h,M);var ut=M,At=g.L;At&&(ut.I=At),ut.B&&(Hs(ut),Cr(ut)),g.g=M}else Va(g);0<h.i.length&&Mr(h)}else ot[0]!="stop"&&ot[0]!="close"||He(h,7);else h.G==3&&(ot[0]=="stop"||ot[0]=="close"?ot[0]=="stop"?He(h,7):ti(h):ot[0]!="noop"&&h.l&&h.l.ta(ot),h.v=0)}}On(4)}catch{}}var Gh=class{constructor(i,c){this.g=i,this.map=c}};function ca(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ua(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function ha(i){return i.h?1:i.g?i.g.size:0}function Ys(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Js(i,c){i.g?i.g.add(c):i.h=c}function da(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}ca.prototype.cancel=function(){if(this.i=fa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function fa(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const h of i.g.values())c=c.concat(h.D);return c}return S(i.i)}function Kh(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(u(i)){for(var c=[],h=i.length,g=0;g<h;g++)c.push(i[g]);return c}c=[],h=0;for(g in i)c[h++]=i[g];return c}function Wh(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(u(i)||typeof i=="string"){var c=[];i=i.length;for(var h=0;h<i;h++)c.push(h);return c}c=[],h=0;for(const g in i)c[h++]=g;return c}}}function ma(i,c){if(i.forEach&&typeof i.forEach=="function")i.forEach(c,void 0);else if(u(i)||typeof i=="string")Array.prototype.forEach.call(i,c,void 0);else for(var h=Wh(i),g=Kh(i),x=g.length,P=0;P<x;P++)c.call(void 0,g[P],h&&h[P],i)}var ga=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qh(i,c){if(i){i=i.split("&");for(var h=0;h<i.length;h++){var g=i[h].indexOf("="),x=null;if(0<=g){var P=i[h].substring(0,g);x=i[h].substring(g+1)}else P=i[h];c(P,x?decodeURIComponent(x.replace(/\+/g," ")):"")}}}function Qe(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof Qe){this.h=i.h,Pr(this,i.j),this.o=i.o,this.g=i.g,Sr(this,i.s),this.l=i.l;var c=i.i,h=new Gn;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),pa(this,h),this.m=i.m}else i&&(c=String(i).match(ga))?(this.h=!1,Pr(this,c[1]||"",!0),this.o=Bn(c[2]||""),this.g=Bn(c[3]||"",!0),Sr(this,c[4]),this.l=Bn(c[5]||"",!0),pa(this,c[6]||"",!0),this.m=Bn(c[7]||"")):(this.h=!1,this.i=new Gn(null,this.h))}Qe.prototype.toString=function(){var i=[],c=this.j;c&&i.push(zn(c,ya,!0),":");var h=this.g;return(h||c=="file")&&(i.push("//"),(c=this.o)&&i.push(zn(c,ya,!0),"@"),i.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&i.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&i.push("/"),i.push(zn(h,h.charAt(0)=="/"?Yh:Xh,!0))),(h=this.i.toString())&&i.push("?",h),(h=this.m)&&i.push("#",zn(h,Zh)),i.join("")};function pe(i){return new Qe(i)}function Pr(i,c,h){i.j=h?Bn(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function Sr(i,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);i.s=c}else i.s=null}function pa(i,c,h){c instanceof Gn?(i.i=c,td(i.i,i.h)):(h||(c=zn(c,Jh)),i.i=new Gn(c,i.h))}function dt(i,c,h){i.i.set(c,h)}function kr(i){return dt(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function Bn(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function zn(i,c,h){return typeof i=="string"?(i=encodeURI(i).replace(c,Hh),h&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Hh(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var ya=/[#\/\?@]/g,Xh=/[#\?:]/g,Yh=/[#\?]/g,Jh=/[#\?@]/g,Zh=/#/g;function Gn(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Re(i){i.g||(i.g=new Map,i.h=0,i.i&&Qh(i.i,function(c,h){i.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=Gn.prototype,n.add=function(i,c){Re(this),this.i=null,i=rn(this,i);var h=this.g.get(i);return h||this.g.set(i,h=[]),h.push(c),this.h+=1,this};function _a(i,c){Re(i),c=rn(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function ba(i,c){return Re(i),c=rn(i,c),i.g.has(c)}n.forEach=function(i,c){Re(this),this.g.forEach(function(h,g){h.forEach(function(x){i.call(c,x,g,this)},this)},this)},n.na=function(){Re(this);const i=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let g=0;g<c.length;g++){const x=i[g];for(let P=0;P<x.length;P++)h.push(c[g])}return h},n.V=function(i){Re(this);let c=[];if(typeof i=="string")ba(this,i)&&(c=c.concat(this.g.get(rn(this,i))));else{i=Array.from(this.g.values());for(let h=0;h<i.length;h++)c=c.concat(i[h])}return c},n.set=function(i,c){return Re(this),this.i=null,i=rn(this,i),ba(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=this.V(i),0<i.length?String(i[0]):c):c};function va(i,c,h){_a(i,c),0<h.length&&(i.i=null,i.g.set(rn(i,c),S(h)),i.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var g=c[h];const P=encodeURIComponent(String(g)),M=this.V(g);for(g=0;g<M.length;g++){var x=P;M[g]!==""&&(x+="="+encodeURIComponent(String(M[g]))),i.push(x)}}return this.i=i.join("&")};function rn(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function td(i,c){c&&!i.j&&(Re(i),i.i=null,i.g.forEach(function(h,g){var x=g.toLowerCase();g!=x&&(_a(this,g),va(this,x,h))},i)),i.j=c}function ed(i,c){const h=new $n;if(l.Image){const g=new Image;g.onload=I(Ce,h,"TestLoadImage: loaded",!0,c,g),g.onerror=I(Ce,h,"TestLoadImage: error",!1,c,g),g.onabort=I(Ce,h,"TestLoadImage: abort",!1,c,g),g.ontimeout=I(Ce,h,"TestLoadImage: timeout",!1,c,g),l.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=i}else c(!1)}function nd(i,c){const h=new $n,g=new AbortController,x=setTimeout(()=>{g.abort(),Ce(h,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:g.signal}).then(P=>{clearTimeout(x),P.ok?Ce(h,"TestPingServer: ok",!0,c):Ce(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(x),Ce(h,"TestPingServer: error",!1,c)})}function Ce(i,c,h,g,x){try{x&&(x.onload=null,x.onerror=null,x.onabort=null,x.ontimeout=null),g(h)}catch{}}function rd(){this.g=new Oh}function sd(i,c,h){const g=h||"";try{ma(i,function(x,P){let M=x;d(x)&&(M=qs(x)),c.push(g+P+"="+encodeURIComponent(M))})}catch(x){throw c.push(g+"type="+encodeURIComponent("_badmap")),x}}function Vr(i){this.l=i.Ub||null,this.j=i.eb||!1}C(Vr,Bs),Vr.prototype.g=function(){return new Nr(this.l,this.j)},Vr.prototype.i=function(i){return function(){return i}}({});function Nr(i,c){St.call(this),this.D=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Nr,St),n=Nr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=c,this.readyState=1,Wn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(c.body=i),(this.D||l).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Kn(this)),this.readyState=0},n.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Wn(this)),this.g&&(this.readyState=3,Wn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;wa(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function wa(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}n.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?Kn(this):Wn(this),this.readyState==3&&wa(this)}},n.Ra=function(i){this.g&&(this.response=this.responseText=i,Kn(this))},n.Qa=function(i){this.g&&(this.response=i,Kn(this))},n.ga=function(){this.g&&Kn(this)};function Kn(i){i.readyState=4,i.l=null,i.j=null,i.v=null,Wn(i)}n.setRequestHeader=function(i,c){this.u.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,i.push(h[0]+": "+h[1]),h=c.next();return i.join(`\r
`)};function Wn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Nr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Ta(i){let c="";return D(i,function(h,g){c+=g,c+=":",c+=h,c+=`\r
`}),c}function Zs(i,c,h){t:{for(g in h){var g=!1;break t}g=!0}g||(h=Ta(h),typeof i=="string"?h!=null&&encodeURIComponent(String(h)):dt(i,c,h))}function gt(i){St.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(gt,St);var id=/^https?$/i,od=["POST","PUT"];n=gt.prototype,n.Ha=function(i){this.J=i},n.ea=function(i,c,h,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ks.g(),this.v=this.o?Yo(this.o):Yo(Ks),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(P){Ea(this,P);return}if(i=h||"",h=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var x in g)h.set(x,g[x]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const P of g.keys())h.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),x=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(od,c,void 0))||g||x||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[P,M]of h)this.g.setRequestHeader(P,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{xa(this),this.u=!0,this.g.send(i),this.u=!1}catch(P){Ea(this,P)}};function Ea(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.m=5,Aa(i),Dr(i)}function Aa(i){i.A||(i.A=!0,Ut(i,"complete"),Ut(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,Ut(this,"complete"),Ut(this,"abort"),Dr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Dr(this,!0)),gt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ia(this):this.bb())},n.bb=function(){Ia(this)};function Ia(i){if(i.h&&typeof a<"u"&&(!i.v[1]||ye(i)!=4||i.Z()!=2)){if(i.u&&ye(i)==4)Wo(i.Ea,0,i);else if(Ut(i,"readystatechange"),ye(i)==4){i.h=!1;try{const M=i.Z();t:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var g;if(g=M===0){var x=String(i.D).match(ga)[1]||null;!x&&l.self&&l.self.location&&(x=l.self.location.protocol.slice(0,-1)),g=!id.test(x?x.toLowerCase():"")}h=g}if(h)Ut(i,"complete"),Ut(i,"success");else{i.m=6;try{var P=2<ye(i)?i.g.statusText:""}catch{P=""}i.l=P+" ["+i.Z()+"]",Aa(i)}}finally{Dr(i)}}}}function Dr(i,c){if(i.g){xa(i);const h=i.g,g=i.v[0]?()=>{}:null;i.g=null,i.v=null,c||Ut(i,"ready");try{h.onreadystatechange=g}catch{}}}function xa(i){i.I&&(l.clearTimeout(i.I),i.I=null)}n.isActive=function(){return!!this.g};function ye(i){return i.g?i.g.readyState:0}n.Z=function(){try{return 2<ye(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Fh(c)}};function Ra(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function ad(i){const c={};i=(i.g&&2<=ye(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<i.length;g++){if(j(i[g]))continue;var h=E(i[g]);const x=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const P=c[x]||[];c[x]=P,P.push(h)}y(c,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qn(i,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[i]||c}function Ca(i){this.Aa=0,this.i=[],this.j=new $n,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qn("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qn("baseRetryDelayMs",5e3,i),this.cb=Qn("retryDelaySeedMs",1e4,i),this.Wa=Qn("forwardChannelMaxRetries",2,i),this.wa=Qn("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new ca(i&&i.concurrentRequestLimit),this.Da=new rd,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Ca.prototype,n.la=8,n.G=1,n.connect=function(i,c,h,g){$t(0),this.W=i,this.H=c||{},h&&g!==void 0&&(this.H.OSID=h,this.H.OAID=g),this.F=this.X,this.I=ja(this,null,this.W),Mr(this)};function ti(i){if(Pa(i),i.G==3){var c=i.U++,h=pe(i.I);if(dt(h,"SID",i.K),dt(h,"RID",c),dt(h,"TYPE","terminate"),Hn(i,h),c=new xe(i,i.j,c),c.L=2,c.v=kr(pe(h)),h=!1,l.navigator&&l.navigator.sendBeacon)try{h=l.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&l.Image&&(new Image().src=c.v,h=!0),h||(c.g=Fa(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Cr(c)}Ma(i)}function Lr(i){i.g&&(ni(i),i.g.cancel(),i.g=null)}function Pa(i){Lr(i),i.u&&(l.clearTimeout(i.u),i.u=null),jr(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function Mr(i){if(!ua(i.h)&&!i.s){i.s=!0;var c=i.Ga;Yt||Nn(),Wt||(Yt(),Wt=!0),Ge.add(c,i),i.B=0}}function ld(i,c){return ha(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=c.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=Un(v(i.Ga,i,c),La(i,i.B)),i.B++,!0)}n.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;const x=new xe(this,this.j,i);let P=this.o;if(this.S&&(P?(P=m(P),b(P,this.S)):P=this.S),this.m!==null||this.O||(x.H=P,P=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var g=this.i[h];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break e}g=void 0}if(g===void 0)break;if(c+=g,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=ka(this,x,c),h=pe(this.I),dt(h,"RID",i),dt(h,"CVER",22),this.D&&dt(h,"X-HTTP-Session-Id",this.D),Hn(this,h),P&&(this.O?c="headers="+encodeURIComponent(String(Ta(P)))+"&"+c:this.m&&Zs(h,this.m,P)),Js(this.h,x),this.Ua&&dt(h,"TYPE","init"),this.P?(dt(h,"$req",c),dt(h,"SID","null"),x.T=!0,Qs(x,h,null)):Qs(x,h,c),this.G=2}}else this.G==3&&(i?Sa(this,i):this.i.length==0||ua(this.h)||Sa(this))};function Sa(i,c){var h;c?h=c.l:h=i.U++;const g=pe(i.I);dt(g,"SID",i.K),dt(g,"RID",h),dt(g,"AID",i.T),Hn(i,g),i.m&&i.o&&Zs(g,i.m,i.o),h=new xe(i,i.j,h,i.B+1),i.m===null&&(h.H=i.o),c&&(i.i=c.D.concat(i.i)),c=ka(i,h,1e3),h.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),Js(i.h,h),Qs(h,g,c)}function Hn(i,c){i.H&&D(i.H,function(h,g){dt(c,g,h)}),i.l&&ma({},function(h,g){dt(c,g,h)})}function ka(i,c,h){h=Math.min(i.i.length,h);var g=i.l?v(i.l.Na,i.l,i):null;t:{var x=i.i;let P=-1;for(;;){const M=["count="+h];P==-1?0<h?(P=x[0].g,M.push("ofs="+P)):P=0:M.push("ofs="+P);let ut=!0;for(let At=0;At<h;At++){let ot=x[At].g;const kt=x[At].map;if(ot-=P,0>ot)P=Math.max(0,x[At].g-100),ut=!1;else try{sd(kt,M,"req"+ot+"_")}catch{g&&g(kt)}}if(ut){g=M.join("&");break t}}}return i=i.i.splice(0,h),c.D=i,g}function Va(i){if(!i.g&&!i.u){i.Y=1;var c=i.Fa;Yt||Nn(),Wt||(Yt(),Wt=!0),Ge.add(c,i),i.v=0}}function ei(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=Un(v(i.Fa,i),La(i,i.v)),i.v++,!0)}n.Fa=function(){if(this.u=null,Na(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=Un(v(this.ab,this),i)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,$t(10),Lr(this),Na(this))};function ni(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function Na(i){i.g=new xe(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var c=pe(i.qa);dt(c,"RID","rpc"),dt(c,"SID",i.K),dt(c,"AID",i.T),dt(c,"CI",i.F?"0":"1"),!i.F&&i.ja&&dt(c,"TO",i.ja),dt(c,"TYPE","xmlhttp"),Hn(i,c),i.m&&i.o&&Zs(c,i.m,i.o),i.L&&(i.g.I=i.L);var h=i.g;i=i.ia,h.L=1,h.v=kr(pe(c)),h.m=null,h.P=!0,oa(h,i)}n.Za=function(){this.C!=null&&(this.C=null,Lr(this),ei(this),$t(19))};function jr(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function Da(i,c){var h=null;if(i.g==c){jr(i),ni(i),i.g=null;var g=2}else if(Ys(i.h,c))h=c.D,da(i.h,c),g=1;else return;if(i.G!=0){if(c.o)if(g==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var x=i.B;g=Ir(),Ut(g,new na(g,h)),Mr(i)}else Va(i);else if(x=c.s,x==3||x==0&&0<c.X||!(g==1&&ld(i,c)||g==2&&ei(i)))switch(h&&0<h.length&&(c=i.h,c.i=c.i.concat(h)),x){case 1:He(i,5);break;case 4:He(i,10);break;case 3:He(i,6);break;default:He(i,2)}}}function La(i,c){let h=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(h*=2),h*c}function He(i,c){if(i.j.info("Error code "+c),c==2){var h=v(i.fb,i),g=i.Xa;const x=!g;g=new Qe(g||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Pr(g,"https"),kr(g),x?ed(g.toString(),h):nd(g.toString(),h)}else $t(2);i.G=0,i.l&&i.l.sa(c),Ma(i),Pa(i)}n.fb=function(i){i?(this.j.info("Successfully pinged google.com"),$t(2)):(this.j.info("Failed to ping google.com"),$t(1))};function Ma(i){if(i.G=0,i.ka=[],i.l){const c=fa(i.h);(c.length!=0||i.i.length!=0)&&(R(i.ka,c),R(i.ka,i.i),i.h.i.length=0,S(i.i),i.i.length=0),i.l.ra()}}function ja(i,c,h){var g=h instanceof Qe?pe(h):new Qe(h);if(g.g!="")c&&(g.g=c+"."+g.g),Sr(g,g.s);else{var x=l.location;g=x.protocol,c=c?c+"."+x.hostname:x.hostname,x=+x.port;var P=new Qe(null);g&&Pr(P,g),c&&(P.g=c),x&&Sr(P,x),h&&(P.l=h),g=P}return h=i.D,c=i.ya,h&&c&&dt(g,h,c),dt(g,"VER",i.la),Hn(i,g),g}function Fa(i,c,h){if(c&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Ca&&!i.pa?new gt(new Vr({eb:h})):new gt(i.pa),c.Ha(i.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Oa(){}n=Oa.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Fr(){}Fr.prototype.g=function(i,c){return new Qt(i,c)};function Qt(i,c){St.call(this),this.g=new Ca(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(i?i["X-WebChannel-Client-Profile"]=c.va:i={"X-WebChannel-Client-Profile":c.va}),this.g.S=i,(i=c&&c.Sb)&&!j(i)&&(this.g.m=i),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!j(c)&&(this.g.D=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new sn(this)}C(Qt,St),Qt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Qt.prototype.close=function(){ti(this.g)},Qt.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var h={};h.__data__=i,i=h}else this.u&&(h={},h.__data__=qs(i),i=h);c.i.push(new Gh(c.Ya++,i)),c.G==3&&Mr(c)},Qt.prototype.N=function(){this.g.l=null,delete this.j,ti(this.g),delete this.g,Qt.aa.N.call(this)};function Ua(i){zs.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){t:{for(const h in c){i=h;break t}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}C(Ua,zs);function $a(){Gs.call(this),this.status=1}C($a,Gs);function sn(i){this.g=i}C(sn,Oa),sn.prototype.ua=function(){Ut(this.g,"a")},sn.prototype.ta=function(i){Ut(this.g,new Ua(i))},sn.prototype.sa=function(i){Ut(this.g,new $a)},sn.prototype.ra=function(){Ut(this.g,"b")},Fr.prototype.createWebChannel=Fr.prototype.g,Qt.prototype.send=Qt.prototype.o,Qt.prototype.open=Qt.prototype.m,Qt.prototype.close=Qt.prototype.close,Ac=function(){return new Fr},Ec=function(){return Ir()},Tc=Ke,wi={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},xr.NO_ERROR=0,xr.TIMEOUT=8,xr.HTTP_ERROR=6,Yr=xr,ra.COMPLETE="complete",wc=ra,Jo.EventType=Fn,Fn.OPEN="a",Fn.CLOSE="b",Fn.ERROR="c",Fn.MESSAGE="d",St.prototype.listen=St.prototype.K,Yn=Jo,gt.prototype.listenOnce=gt.prototype.L,gt.prototype.getLastError=gt.prototype.Ka,gt.prototype.getLastErrorCode=gt.prototype.Ba,gt.prototype.getStatus=gt.prototype.Z,gt.prototype.getResponseJson=gt.prototype.Oa,gt.prototype.getResponseText=gt.prototype.oa,gt.prototype.send=gt.prototype.ea,gt.prototype.setWithCredentials=gt.prototype.Ha,vc=gt}).apply(typeof $r<"u"?$r:typeof self<"u"?self:typeof window<"u"?window:{});const Ha="@firebase/firestore",Xa="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Dt.UNAUTHENTICATED=new Dt(null),Dt.GOOGLE_CREDENTIALS=new Dt("google-credentials-uid"),Dt.FIRST_PARTY=new Dt("first-party-uid"),Dt.MOCK_USER=new Dt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let An="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Je=new dd("@firebase/firestore");function un(){return Je.logLevel}function U(n,...t){if(Je.logLevel<=ve.DEBUG){const e=t.map(Gi);Je.debug(`Firestore (${An}): ${n}`,...e)}}function Ae(n,...t){if(Je.logLevel<=ve.ERROR){const e=t.map(Gi);Je.error(`Firestore (${An}): ${n}`,...e)}}function gn(n,...t){if(Je.logLevel<=ve.WARN){const e=t.map(Gi);Je.warn(`Firestore (${An}): ${n}`,...e)}}function Gi(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(e){return JSON.stringify(e)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G(n="Unexpected state"){const t=`FIRESTORE (${An}) INTERNAL ASSERTION FAILED: `+n;throw Ae(t),new Error(t)}function at(n,t){n||G()}function X(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends gd{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class _f{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Dt.UNAUTHENTICATED))}shutdown(){}}class bf{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class vf{constructor(t){this.t=t,this.currentUser=Dt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){at(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,e(u)):Promise.resolve();let o=new Te;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Te,t.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const u=o;t.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},l=u=>{U("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(U("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Te)}},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(U("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(at(typeof r.accessToken=="string"),new Ic(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return at(t===null||typeof t=="string"),new Dt(t)}}class wf{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=Dt.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Tf{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new wf(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(Dt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ya{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ef{constructor(t,e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,pd(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,e){at(this.o===void 0);const r=o=>{o.error!=null&&U("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.R;return this.R=o.token,U("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};const s=o=>{U("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){const o=this.A.getImmediate({optional:!0});o?s(o):U("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new Ya(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(at(typeof e.token=="string"),this.R=e.token,new Ya(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xc(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Af(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}}function et(n,t){return n<t?-1:n>t?1:0}function Ti(n,t){let e=0;for(;e<n.length&&e<t.length;){const r=n.codePointAt(e),s=t.codePointAt(e);if(r!==s){if(r<128&&s<128)return et(r,s);{const o=xc(),a=If(o.encode(Ja(n,e)),o.encode(Ja(t,e)));return a!==0?a:et(r,s)}}e+=r>65535?2:1}return et(n.length,t.length)}function Ja(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function If(n,t){for(let e=0;e<n.length&&e<t.length;++e)if(n[e]!==t[e])return et(n[e],t[e]);return et(n.length,t.length)}function pn(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Za=-62135596800,tl=1e6;class wt{static now(){return wt.fromMillis(Date.now())}static fromDate(t){return wt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*tl);return new wt(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new O(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new O(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Za)throw new O(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/tl}_compareTo(t){return this.seconds===t.seconds?et(this.nanoseconds,t.nanoseconds):et(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-Za;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{static fromTimestamp(t){return new H(t)}static min(){return new H(new wt(0,0))}static max(){return new H(new wt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el="__name__";class ce{constructor(t,e,r){e===void 0?e=0:e>t.length&&G(),r===void 0?r=t.length-e:r>t.length-e&&G(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return ce.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ce?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let s=0;s<r;s++){const o=ce.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return et(t.length,e.length)}static compareSegments(t,e){const r=ce.isNumericId(t),s=ce.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?ce.extractNumericId(t).compare(ce.extractNumericId(e)):Ti(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ke.fromString(t.substring(4,t.length-2))}}class ft extends ce{construct(t,e,r){return new ft(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new O(k.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new ft(e)}static emptyPath(){return new ft([])}}const xf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Rt extends ce{construct(t,e,r){return new Rt(t,e,r)}static isValidIdentifier(t){return xf.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Rt.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===el}static keyField(){return new Rt([el])}static fromServerFormat(t){const e=[];let r="",s=0;const o=()=>{if(r.length===0)throw new O(k.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let a=!1;for(;s<t.length;){const l=t[s];if(l==="\\"){if(s+1===t.length)throw new O(k.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const u=t[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new O(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(o(),s++)}if(o(),a)throw new O(k.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Rt(e)}static emptyPath(){return new Rt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(t){this.path=t}static fromPath(t){return new B(ft.fromString(t))}static fromName(t){return new B(ft.fromString(t).popFirst(5))}static empty(){return new B(ft.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&ft.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return ft.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new B(new ft(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const or=-1;function Rf(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=H.fromTimestamp(r===1e9?new wt(e+1,0):new wt(e,r));return new De(s,B.empty(),t)}function Cf(n){return new De(n.readTime,n.key,or)}class De{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new De(H.min(),B.empty(),or)}static max(){return new De(H.max(),B.empty(),or)}}function Pf(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=B.comparator(n.documentKey,t.documentKey),e!==0?e:et(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function In(n){if(n.code!==k.FAILED_PRECONDITION||n.message!==Sf)throw n;U("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new V((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof V?e:V.resolve(e)}catch(e){return V.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):V.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):V.reject(e)}static resolve(t){return new V((e,r)=>{e(t)})}static reject(t){return new V((e,r)=>{r(t)})}static waitFor(t){return new V((e,r)=>{let s=0,o=0,a=!1;t.forEach(l=>{++s,l.next(()=>{++o,a&&o===s&&e()},u=>r(u))}),a=!0,o===s&&e()})}static or(t){let e=V.resolve(!1);for(const r of t)e=e.next(s=>s?V.resolve(s):r());return e}static forEach(t,e){const r=[];return t.forEach((s,o)=>{r.push(e.call(this,s,o))}),this.waitFor(r)}static mapArray(t,e){return new V((r,s)=>{const o=t.length,a=new Array(o);let l=0;for(let u=0;u<o;u++){const d=u;e(t[d]).next(f=>{a[d]=f,++l,l===o&&r(a)},f=>s(f))}})}static doWhile(t,e){return new V((r,s)=>{const o=()=>{t()===!0?e().next(()=>{o()},s):r()};o()})}}function Vf(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function xn(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.oe(r),this._e=r=>e.writeSequenceNumber(r))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}vs.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ki=-1;function ws(n){return n==null}function rs(n){return n===0&&1/n==-1/0}function Nf(n){return typeof n=="number"&&Number.isInteger(n)&&!rs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cc="";function Df(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=nl(t)),t=Lf(n.get(e),t);return nl(t)}function Lf(n,t){let e=t;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":e+="";break;case Cc:e+="";break;default:e+=o}}return e}function nl(n){return n+Cc+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rl(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Ue(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Pc(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(t,e){this.comparator=t,this.root=e||It.EMPTY}insert(t,e){return new mt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,It.BLACK,null,null))}remove(t){return new mt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,It.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){const t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new qr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new qr(this.root,t,this.comparator,!1)}getReverseIterator(){return new qr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new qr(this.root,t,this.comparator,!0)}}class qr{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class It{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??It.RED,this.left=s??It.EMPTY,this.right=o??It.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new It(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this;const o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return It.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return It.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,It.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,It.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();const t=this.left.check();if(t!==this.right.check())throw G();return t+(this.isRed()?0:1)}}It.EMPTY=null,It.RED=!0,It.BLACK=!1;It.EMPTY=new class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(t,e,r,s,o){return this}insert(t,e,r){return new It(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(t){this.comparator=t,this.data=new mt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new sl(this.data.getIterator())}getIteratorFrom(t){return new sl(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof Tt)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new Tt(this.comparator);return e.data=t,e}}class sl{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(t){this.fields=t,t.sort(Rt.comparator)}static empty(){return new Ht([])}unionWith(t){let e=new Tt(Rt.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new Ht(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return pn(this.fields,t.fields,(e,r)=>e.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Sc("Invalid base64 string: "+o):o}}(t);return new Ct(e)}static fromUint8Array(t){const e=function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o}(t);return new Ct(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return et(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ct.EMPTY_BYTE_STRING=new Ct("");const Mf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Le(n){if(at(!!n),typeof n=="string"){let t=0;const e=Mf.exec(n);if(at(!!e),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:pt(n.seconds),nanos:pt(n.nanos)}}function pt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Me(n){return typeof n=="string"?Ct.fromBase64String(n):Ct.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc="server_timestamp",Vc="__type__",Nc="__previous_value__",Dc="__local_write_time__";function Wi(n){var t,e;return((e=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[Vc])===null||e===void 0?void 0:e.stringValue)===kc}function Ts(n){const t=n.mapValue.fields[Nc];return Wi(t)?Ts(t):t}function ar(n){const t=Le(n.mapValue.fields[Dc].timestampValue);return new wt(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(t,e,r,s,o,a,l,u,d){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d}}const ss="(default)";class lr{constructor(t,e){this.projectId=t,this.database=e||ss}static empty(){return new lr("","")}get isDefaultDatabase(){return this.database===ss}isEqual(t){return t instanceof lr&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lc="__type__",Mc="__max__",Br={mapValue:{fields:{__type__:{stringValue:Mc}}}},jc="__vector__",is="value";function je(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Wi(n)?4:Of(n)?9007199254740991:Ff(n)?10:11:G()}function fe(n,t){if(n===t)return!0;const e=je(n);if(e!==je(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return ar(n).isEqual(ar(t));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=Le(s.timestampValue),l=Le(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(s,o){return Me(s.bytesValue).isEqual(Me(o.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(s,o){return pt(s.geoPointValue.latitude)===pt(o.geoPointValue.latitude)&&pt(s.geoPointValue.longitude)===pt(o.geoPointValue.longitude)}(n,t);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return pt(s.integerValue)===pt(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=pt(s.doubleValue),l=pt(o.doubleValue);return a===l?rs(a)===rs(l):isNaN(a)&&isNaN(l)}return!1}(n,t);case 9:return pn(n.arrayValue.values||[],t.arrayValue.values||[],fe);case 10:case 11:return function(s,o){const a=s.mapValue.fields||{},l=o.mapValue.fields||{};if(rl(a)!==rl(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!fe(a[u],l[u])))return!1;return!0}(n,t);default:return G()}}function cr(n,t){return(n.values||[]).find(e=>fe(e,t))!==void 0}function yn(n,t){if(n===t)return 0;const e=je(n),r=je(t);if(e!==r)return et(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return et(n.booleanValue,t.booleanValue);case 2:return function(o,a){const l=pt(o.integerValue||o.doubleValue),u=pt(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(n,t);case 3:return il(n.timestampValue,t.timestampValue);case 4:return il(ar(n),ar(t));case 5:return Ti(n.stringValue,t.stringValue);case 6:return function(o,a){const l=Me(o),u=Me(a);return l.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(o,a){const l=o.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=et(l[d],u[d]);if(f!==0)return f}return et(l.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(o,a){const l=et(pt(o.latitude),pt(a.latitude));return l!==0?l:et(pt(o.longitude),pt(a.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return ol(n.arrayValue,t.arrayValue);case 10:return function(o,a){var l,u,d,f;const _=o.fields||{},v=a.fields||{},I=(l=_[is])===null||l===void 0?void 0:l.arrayValue,C=(u=v[is])===null||u===void 0?void 0:u.arrayValue,S=et(((d=I==null?void 0:I.values)===null||d===void 0?void 0:d.length)||0,((f=C==null?void 0:C.values)===null||f===void 0?void 0:f.length)||0);return S!==0?S:ol(I,C)}(n.mapValue,t.mapValue);case 11:return function(o,a){if(o===Br.mapValue&&a===Br.mapValue)return 0;if(o===Br.mapValue)return 1;if(a===Br.mapValue)return-1;const l=o.fields||{},u=Object.keys(l),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let _=0;_<u.length&&_<f.length;++_){const v=Ti(u[_],f[_]);if(v!==0)return v;const I=yn(l[u[_]],d[f[_]]);if(I!==0)return I}return et(u.length,f.length)}(n.mapValue,t.mapValue);default:throw G()}}function il(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return et(n,t);const e=Le(n),r=Le(t),s=et(e.seconds,r.seconds);return s!==0?s:et(e.nanos,r.nanos)}function ol(n,t){const e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){const o=yn(e[s],r[s]);if(o)return o}return et(e.length,r.length)}function _n(n){return Ei(n)}function Ei(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){const r=Le(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Me(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return B.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",s=!0;for(const o of e.values||[])s?s=!1:r+=",",r+=Ei(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){const r=Object.keys(e.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Ei(e.fields[a])}`;return s+"}"}(n.mapValue):G()}function Jr(n){switch(je(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Ts(n);return t?16+Jr(t):16;case 5:return 2*n.stringValue.length;case 6:return Me(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+Jr(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Ue(r.fields,(o,a)=>{s+=o.length+Jr(a)}),s}(n.mapValue);default:throw G()}}function al(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function Ai(n){return!!n&&"integerValue"in n}function Qi(n){return!!n&&"arrayValue"in n}function ll(n){return!!n&&"nullValue"in n}function cl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Zr(n){return!!n&&"mapValue"in n}function Ff(n){var t,e;return((e=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[Lc])===null||e===void 0?void 0:e.stringValue)===jc}function er(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Ue(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=er(r)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=er(n.arrayValue.values[e]);return t}return Object.assign({},n)}function Of(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Mc}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(t){this.value=t}static empty(){return new Kt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Zr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=er(e)}setAll(t){let e=Rt.emptyPath(),r={},s=[];t.forEach((a,l)=>{if(!e.isImmediateParentOf(l)){const u=this.getFieldsMap(e);this.applyChanges(u,r,s),r={},s=[],e=l.popLast()}a?r[l.lastSegment()]=er(a):s.push(l.lastSegment())});const o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){const e=this.field(t.popLast());Zr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return fe(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];Zr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){Ue(e,(s,o)=>t[s]=o);for(const s of r)delete t[s]}clone(){return new Kt(er(this.value))}}function Fc(n){const t=[];return Ue(n.fields,(e,r)=>{const s=new Rt([e]);if(Zr(r)){const o=Fc(r.mapValue).fields;if(o.length===0)t.push(s);else for(const a of o)t.push(s.child(a))}else t.push(s)}),new Ht(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(t,e,r,s,o,a,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(t){return new Lt(t,0,H.min(),H.min(),H.min(),Kt.empty(),0)}static newFoundDocument(t,e,r,s){return new Lt(t,1,e,H.min(),r,s,0)}static newNoDocument(t,e){return new Lt(t,2,e,H.min(),H.min(),Kt.empty(),0)}static newUnknownDocument(t,e){return new Lt(t,3,e,H.min(),H.min(),Kt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(H.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Kt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=H.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Lt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Lt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(t,e){this.position=t,this.inclusive=e}}function ul(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){const o=t[s],a=n.position[s];if(o.field.isKeyField()?r=B.comparator(B.fromName(a.referenceValue),e.key):r=yn(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function hl(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!fe(n.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(t,e="asc"){this.field=t,this.dir=e}}function Uf(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{}class vt extends Oc{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new qf(t,e,r):e==="array-contains"?new Gf(t,r):e==="in"?new Kf(t,r):e==="not-in"?new Wf(t,r):e==="array-contains-any"?new Qf(t,r):new vt(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Bf(t,r):new zf(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(yn(e,this.value)):e!==null&&je(this.value)===je(e)&&this.matchesComparison(yn(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ie extends Oc{constructor(t,e){super(),this.filters=t,this.op=e,this.ce=null}static create(t,e){return new ie(t,e)}matches(t){return Uc(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Uc(n){return n.op==="and"}function $c(n){return $f(n)&&Uc(n)}function $f(n){for(const t of n.filters)if(t instanceof ie)return!1;return!0}function Ii(n){if(n instanceof vt)return n.field.canonicalString()+n.op.toString()+_n(n.value);if($c(n))return n.filters.map(t=>Ii(t)).join(",");{const t=n.filters.map(e=>Ii(e)).join(",");return`${n.op}(${t})`}}function qc(n,t){return n instanceof vt?function(r,s){return s instanceof vt&&r.op===s.op&&r.field.isEqual(s.field)&&fe(r.value,s.value)}(n,t):n instanceof ie?function(r,s){return s instanceof ie&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,a,l)=>o&&qc(a,s.filters[l]),!0):!1}(n,t):void G()}function Bc(n){return n instanceof vt?function(e){return`${e.field.canonicalString()} ${e.op} ${_n(e.value)}`}(n):n instanceof ie?function(e){return e.op.toString()+" {"+e.getFilters().map(Bc).join(" ,")+"}"}(n):"Filter"}class qf extends vt{constructor(t,e,r){super(t,e,r),this.key=B.fromName(r.referenceValue)}matches(t){const e=B.comparator(t.key,this.key);return this.matchesComparison(e)}}class Bf extends vt{constructor(t,e){super(t,"in",e),this.keys=zc("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class zf extends vt{constructor(t,e){super(t,"not-in",e),this.keys=zc("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function zc(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>B.fromName(r.referenceValue))}class Gf extends vt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Qi(e)&&cr(e.arrayValue,this.value)}}class Kf extends vt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&cr(this.value.arrayValue,e)}}class Wf extends vt{constructor(t,e){super(t,"not-in",e)}matches(t){if(cr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&!cr(this.value.arrayValue,e)}}class Qf extends vt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Qi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>cr(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(t,e=null,r=[],s=[],o=null,a=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.le=null}}function dl(n,t=null,e=[],r=[],s=null,o=null,a=null){return new Hf(n,t,e,r,s,o,a)}function Hi(n){const t=X(n);if(t.le===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>Ii(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),ws(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>_n(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>_n(r)).join(",")),t.le=e}return t.le}function Xi(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Uf(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!qc(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!hl(n.startAt,t.startAt)&&hl(n.endAt,t.endAt)}function xi(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(t,e=null,r=[],s=[],o=null,a="F",l=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=u,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function Xf(n,t,e,r,s,o,a,l){return new Rn(n,t,e,r,s,o,a,l)}function Es(n){return new Rn(n)}function fl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Gc(n){return n.collectionGroup!==null}function nr(n){const t=X(n);if(t.he===null){t.he=[];const e=new Set;for(const o of t.explicitOrderBy)t.he.push(o),e.add(o.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new Tt(Rt.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.he.push(new ur(o,r))}),e.has(Rt.keyField().canonicalString())||t.he.push(new ur(Rt.keyField(),r))}return t.he}function ue(n){const t=X(n);return t.Pe||(t.Pe=Yf(t,nr(n))),t.Pe}function Yf(n,t){if(n.limitType==="F")return dl(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{const o=s.dir==="desc"?"asc":"desc";return new ur(s.field,o)});const e=n.endAt?new os(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new os(n.startAt.position,n.startAt.inclusive):null;return dl(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Ri(n,t){const e=n.filters.concat([t]);return new Rn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Ci(n,t,e){return new Rn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function As(n,t){return Xi(ue(n),ue(t))&&n.limitType===t.limitType}function Kc(n){return`${Hi(ue(n))}|lt:${n.limitType}`}function hn(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>Bc(s)).join(", ")}]`),ws(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>_n(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>_n(s)).join(",")),`Target(${r})`}(ue(n))}; limitType=${n.limitType})`}function Is(n,t){return t.isFoundDocument()&&function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):B.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,t)&&function(r,s){for(const o of nr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,t)&&function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0}(n,t)&&function(r,s){return!(r.startAt&&!function(a,l,u){const d=ul(a,l,u);return a.inclusive?d<=0:d<0}(r.startAt,nr(r),s)||r.endAt&&!function(a,l,u){const d=ul(a,l,u);return a.inclusive?d>=0:d>0}(r.endAt,nr(r),s))}(n,t)}function Jf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Wc(n){return(t,e)=>{let r=!1;for(const s of nr(n)){const o=Zf(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Zf(n,t,e){const r=n.field.isKeyField()?B.comparator(t.key,e.key):function(o,a,l){const u=a.data.field(o),d=l.data.field(o);return u!==null&&d!==null?yn(u,d):G()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Ue(this.inner,(e,r)=>{for(const[s,o]of r)t(s,o)})}isEmpty(){return Pc(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm=new mt(B.comparator);function Ie(){return tm}const Qc=new mt(B.comparator);function Jn(...n){let t=Qc;for(const e of n)t=t.insert(e.key,e);return t}function Hc(n){let t=Qc;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function Xe(){return rr()}function Xc(){return rr()}function rr(){return new tn(n=>n.toString(),(n,t)=>n.isEqual(t))}const em=new mt(B.comparator),nm=new Tt(B.comparator);function rt(...n){let t=nm;for(const e of n)t=t.add(e);return t}const rm=new Tt(et);function sm(){return rm}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yi(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rs(t)?"-0":t}}function Yc(n){return{integerValue:""+n}}function im(n,t){return Nf(t)?Yc(t):Yi(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(){this._=void 0}}function om(n,t,e){return n instanceof as?function(s,o){const a={fields:{[Vc]:{stringValue:kc},[Dc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Wi(o)&&(o=Ts(o)),o&&(a.fields[Nc]=o),{mapValue:a}}(e,t):n instanceof hr?Zc(n,t):n instanceof dr?tu(n,t):function(s,o){const a=Jc(s,o),l=ml(a)+ml(s.Ie);return Ai(a)&&Ai(s.Ie)?Yc(l):Yi(s.serializer,l)}(n,t)}function am(n,t,e){return n instanceof hr?Zc(n,t):n instanceof dr?tu(n,t):e}function Jc(n,t){return n instanceof ls?function(r){return Ai(r)||function(o){return!!o&&"doubleValue"in o}(r)}(t)?t:{integerValue:0}:null}class as extends xs{}class hr extends xs{constructor(t){super(),this.elements=t}}function Zc(n,t){const e=eu(t);for(const r of n.elements)e.some(s=>fe(s,r))||e.push(r);return{arrayValue:{values:e}}}class dr extends xs{constructor(t){super(),this.elements=t}}function tu(n,t){let e=eu(t);for(const r of n.elements)e=e.filter(s=>!fe(s,r));return{arrayValue:{values:e}}}class ls extends xs{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function ml(n){return pt(n.integerValue||n.doubleValue)}function eu(n){return Qi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function lm(n,t){return n.field.isEqual(t.field)&&function(r,s){return r instanceof hr&&s instanceof hr||r instanceof dr&&s instanceof dr?pn(r.elements,s.elements,fe):r instanceof ls&&s instanceof ls?fe(r.Ie,s.Ie):r instanceof as&&s instanceof as}(n.transform,t.transform)}class cm{constructor(t,e){this.version=t,this.transformResults=e}}class Bt{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Bt}static exists(t){return new Bt(void 0,t)}static updateTime(t){return new Bt(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ts(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class Rs{}function nu(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Cs(n.key,Bt.none()):new mr(n.key,n.data,Bt.none());{const e=n.data,r=Kt.empty();let s=new Tt(Rt.comparator);for(let o of t.fields)if(!s.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new $e(n.key,r,new Ht(s.toArray()),Bt.none())}}function um(n,t,e){n instanceof mr?function(s,o,a){const l=s.value.clone(),u=pl(s.fieldTransforms,o,a.transformResults);l.setAll(u),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,t,e):n instanceof $e?function(s,o,a){if(!ts(s.precondition,o))return void o.convertToUnknownDocument(a.version);const l=pl(s.fieldTransforms,o,a.transformResults),u=o.data;u.setAll(ru(s)),u.setAll(l),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,t,e):function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function sr(n,t,e,r){return n instanceof mr?function(o,a,l,u){if(!ts(o.precondition,a))return l;const d=o.value.clone(),f=yl(o.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,t,e,r):n instanceof $e?function(o,a,l,u){if(!ts(o.precondition,a))return l;const d=yl(o.fieldTransforms,u,a),f=a.data;return f.setAll(ru(o)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(_=>_.field))}(n,t,e,r):function(o,a,l){return ts(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,t,e)}function hm(n,t){let e=null;for(const r of n.fieldTransforms){const s=t.data.field(r.field),o=Jc(r.transform,s||null);o!=null&&(e===null&&(e=Kt.empty()),e.set(r.field,o))}return e||null}function gl(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&pn(r,s,(o,a)=>lm(o,a))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class mr extends Rs{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class $e extends Rs{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function ru(n){const t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}}),t}function pl(n,t,e){const r=new Map;at(n.length===e.length);for(let s=0;s<e.length;s++){const o=n[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,am(a,l,e[s]))}return r}function yl(n,t,e){const r=new Map;for(const s of n){const o=s.transform,a=e.data.field(s.field);r.set(s.field,om(o,a,t))}return r}class Cs extends Rs{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dm extends Rs{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(t.key)&&um(o,t,r[s])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=sr(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=sr(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=Xc();return this.mutations.forEach(s=>{const o=t.get(s.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=e.has(s.key)?null:l;const u=nu(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(H.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),rt())}isEqual(t){return this.batchId===t.batchId&&pn(this.mutations,t.mutations,(e,r)=>gl(e,r))&&pn(this.baseMutations,t.baseMutations,(e,r)=>gl(e,r))}}class Ji{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){at(t.mutations.length===r.length);let s=function(){return em}();const o=t.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Ji(t,e,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(t,e){this.count=t,this.unchangedNames=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bt,st;function pm(n){switch(n){case k.OK:return G();case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0;default:return G()}}function su(n){if(n===void 0)return Ae("GRPC error has no .code"),k.UNKNOWN;switch(n){case bt.OK:return k.OK;case bt.CANCELLED:return k.CANCELLED;case bt.UNKNOWN:return k.UNKNOWN;case bt.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case bt.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case bt.INTERNAL:return k.INTERNAL;case bt.UNAVAILABLE:return k.UNAVAILABLE;case bt.UNAUTHENTICATED:return k.UNAUTHENTICATED;case bt.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case bt.NOT_FOUND:return k.NOT_FOUND;case bt.ALREADY_EXISTS:return k.ALREADY_EXISTS;case bt.PERMISSION_DENIED:return k.PERMISSION_DENIED;case bt.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case bt.ABORTED:return k.ABORTED;case bt.OUT_OF_RANGE:return k.OUT_OF_RANGE;case bt.UNIMPLEMENTED:return k.UNIMPLEMENTED;case bt.DATA_LOSS:return k.DATA_LOSS;default:return G()}}(st=bt||(bt={}))[st.OK=0]="OK",st[st.CANCELLED=1]="CANCELLED",st[st.UNKNOWN=2]="UNKNOWN",st[st.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",st[st.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",st[st.NOT_FOUND=5]="NOT_FOUND",st[st.ALREADY_EXISTS=6]="ALREADY_EXISTS",st[st.PERMISSION_DENIED=7]="PERMISSION_DENIED",st[st.UNAUTHENTICATED=16]="UNAUTHENTICATED",st[st.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",st[st.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",st[st.ABORTED=10]="ABORTED",st[st.OUT_OF_RANGE=11]="OUT_OF_RANGE",st[st.UNIMPLEMENTED=12]="UNIMPLEMENTED",st[st.INTERNAL=13]="INTERNAL",st[st.UNAVAILABLE=14]="UNAVAILABLE",st[st.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ym=new ke([4294967295,4294967295],0);function _l(n){const t=xc().encode(n),e=new bc;return e.update(t),new Uint8Array(e.digest())}function bl(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new ke([e,r],0),new ke([s,o],0)]}class Zi{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new Zn(`Invalid padding: ${e}`);if(r<0)throw new Zn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new Zn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new Zn(`Invalid padding when bitmap length is 0: ${e}`);this.Ee=8*t.length-e,this.de=ke.fromNumber(this.Ee)}Ae(t,e,r){let s=t.add(e.multiply(ke.fromNumber(r)));return s.compare(ym)===1&&(s=new ke([s.getBits(0),s.getBits(1)],0)),s.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const e=_l(t),[r,s]=bl(e);for(let o=0;o<this.hashCount;o++){const a=this.Ae(r,s,o);if(!this.Re(a))return!1}return!0}static create(t,e,r){const s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new Zi(o,s,e);return r.forEach(l=>a.insert(l)),a}insert(t){if(this.Ee===0)return;const e=_l(t),[r,s]=bl(e);for(let o=0;o<this.hashCount;o++){const a=this.Ae(r,s,o);this.Ve(a)}}Ve(t){const e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}}class Zn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const s=new Map;return s.set(t,gr.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new Ps(H.min(),s,new mt(et),Ie(),rt())}}class gr{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new gr(r,e,rt(),rt(),rt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(t,e,r,s){this.me=t,this.removedTargetIds=e,this.key=r,this.fe=s}}class iu{constructor(t,e){this.targetId=t,this.ge=e}}class ou{constructor(t,e,r=Ct.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}}class vl{constructor(){this.pe=0,this.ye=wl(),this.we=Ct.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=rt(),e=rt(),r=rt();return this.ye.forEach((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:G()}}),new gr(this.we,this.Se,t,e,r)}Me(){this.be=!1,this.ye=wl()}xe(t,e){this.be=!0,this.ye=this.ye.insert(t,e)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,at(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class _m{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Ie(),this.$e=zr(),this.Ue=zr(),this.Ke=new mt(et)}We(t){for(const e of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(e,t.fe):this.ze(e,t.key,t.fe);for(const e of t.removedTargetIds)this.ze(e,t.key,t.fe)}je(t){this.forEachTarget(t,e=>{const r=this.He(e);switch(t.state){case 0:this.Je(e)&&r.Ce(t.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(t.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(e);break;case 3:this.Je(e)&&(r.Le(),r.Ce(t.resumeToken));break;case 4:this.Je(e)&&(this.Ye(e),r.Ce(t.resumeToken));break;default:G()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.qe.forEach((r,s)=>{this.Je(s)&&e(s)})}Ze(t){const e=t.targetId,r=t.ge.count,s=this.Xe(e);if(s){const o=s.target;if(xi(o))if(r===0){const a=new B(o.path);this.ze(e,a,Lt.newNoDocument(a,H.min()))}else at(r===1);else{const a=this.et(e);if(a!==r){const l=this.tt(t),u=l?this.nt(l,t,a):1;if(u!==0){this.Ye(e);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,d)}}}}}tt(t){const e=t.ge.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e;let a,l;try{a=Me(r).toUint8Array()}catch(u){if(u instanceof Sc)return gn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Zi(a,s,o)}catch(u){return gn(u instanceof Zn?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.Ee===0?null:l}nt(t,e,r){return e.ge.count===r-this.st(t,e.targetId)?0:2}st(t,e){const r=this.ke.getRemoteKeysForTarget(e);let s=0;return r.forEach(o=>{const a=this.ke.it(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.ze(e,o,null),s++)}),s}ot(t){const e=new Map;this.qe.forEach((o,a)=>{const l=this.Xe(a);if(l){if(o.current&&xi(l.target)){const u=new B(l.target.path);this._t(u).has(a)||this.ut(a,u)||this.ze(a,u,Lt.newNoDocument(u,t))}o.ve&&(e.set(a,o.Fe()),o.Me())}});let r=rt();this.Ue.forEach((o,a)=>{let l=!0;a.forEachWhile(u=>{const d=this.Xe(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.Qe.forEach((o,a)=>a.setReadTime(t));const s=new Ps(t,e,this.Ke,this.Qe,r);return this.Qe=Ie(),this.$e=zr(),this.Ue=zr(),this.Ke=new mt(et),s}Ge(t,e){if(!this.Je(t))return;const r=this.ut(t,e.key)?2:0;this.He(t).xe(e.key,r),this.Qe=this.Qe.insert(e.key,e),this.$e=this.$e.insert(e.key,this._t(e.key).add(t)),this.Ue=this.Ue.insert(e.key,this.ct(e.key).add(t))}ze(t,e,r){if(!this.Je(t))return;const s=this.He(t);this.ut(t,e)?s.xe(e,1):s.Oe(e),this.Ue=this.Ue.insert(e,this.ct(e).delete(t)),this.Ue=this.Ue.insert(e,this.ct(e).add(t)),r&&(this.Qe=this.Qe.insert(e,r))}removeTarget(t){this.qe.delete(t)}et(t){const e=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let e=this.qe.get(t);return e||(e=new vl,this.qe.set(t,e)),e}ct(t){let e=this.Ue.get(t);return e||(e=new Tt(et),this.Ue=this.Ue.insert(t,e)),e}_t(t){let e=this.$e.get(t);return e||(e=new Tt(et),this.$e=this.$e.insert(t,e)),e}Je(t){const e=this.Xe(t)!==null;return e||U("WatchChangeAggregator","Detected inactive target",t),e}Xe(t){const e=this.qe.get(t);return e&&e.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new vl),this.ke.getRemoteKeysForTarget(t).forEach(e=>{this.ze(t,e,null)})}ut(t,e){return this.ke.getRemoteKeysForTarget(t).has(e)}}function zr(){return new mt(B.comparator)}function wl(){return new mt(B.comparator)}const bm={asc:"ASCENDING",desc:"DESCENDING"},vm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wm={and:"AND",or:"OR"};class Tm{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Pi(n,t){return n.useProto3Json||ws(t)?t:{value:t}}function cs(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function au(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Em(n,t){return cs(n,t.toTimestamp())}function he(n){return at(!!n),H.fromTimestamp(function(e){const r=Le(e);return new wt(r.seconds,r.nanos)}(n))}function to(n,t){return Si(n,t).canonicalString()}function Si(n,t){const e=function(s){return new ft(["projects",s.projectId,"databases",s.database])}(n).child("documents");return t===void 0?e:e.child(t)}function lu(n){const t=ft.fromString(n);return at(fu(t)),t}function ki(n,t){return to(n.databaseId,t.path)}function si(n,t){const e=lu(t);if(e.get(1)!==n.databaseId.projectId)throw new O(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new O(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new B(uu(e))}function cu(n,t){return to(n.databaseId,t)}function Am(n){const t=lu(n);return t.length===4?ft.emptyPath():uu(t)}function Vi(n){return new ft(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function uu(n){return at(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Tl(n,t,e){return{name:ki(n,t),fields:e.value.mapValue.fields}}function Im(n,t){let e;if("targetChange"in t){t.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:G()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=function(d,f){return d.useProto3Json?(at(f===void 0||typeof f=="string"),Ct.fromBase64String(f||"")):(at(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Ct.fromUint8Array(f||new Uint8Array))}(n,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&function(d){const f=d.code===void 0?k.UNKNOWN:su(d.code);return new O(f,d.message||"")}(a);e=new ou(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=si(n,r.document.name),o=he(r.document.updateTime),a=r.document.createTime?he(r.document.createTime):H.min(),l=new Kt({mapValue:{fields:r.document.fields}}),u=Lt.newFoundDocument(s,o,a,l),d=r.targetIds||[],f=r.removedTargetIds||[];e=new es(d,f,u.key,u)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=si(n,r.document),o=r.readTime?he(r.readTime):H.min(),a=Lt.newNoDocument(s,o),l=r.removedTargetIds||[];e=new es([],l,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=si(n,r.document),o=r.removedTargetIds||[];e=new es([],o,s,null)}else{if(!("filter"in t))return G();{t.filter;const r=t.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new gm(s,o),l=r.targetId;e=new iu(l,a)}}return e}function xm(n,t){let e;if(t instanceof mr)e={update:Tl(n,t.key,t.value)};else if(t instanceof Cs)e={delete:ki(n,t.key)};else if(t instanceof $e)e={update:Tl(n,t.key,t.data),updateMask:Lm(t.fieldMask)};else{if(!(t instanceof dm))return G();e={verify:ki(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(o,a){const l=a.transform;if(l instanceof as)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof hr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof dr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof ls)return{fieldPath:a.field.canonicalString(),increment:l.Ie};throw G()}(0,r))),t.precondition.isNone||(e.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Em(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:G()}(n,t.precondition)),e}function Rm(n,t){return n&&n.length>0?(at(t!==void 0),n.map(e=>function(s,o){let a=s.updateTime?he(s.updateTime):he(o);return a.isEqual(H.min())&&(a=he(o)),new cm(a,s.transformResults||[])}(e,t))):[]}function Cm(n,t){return{documents:[cu(n,t.path)]}}function Pm(n,t){const e={structuredQuery:{}},r=t.path;let s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=cu(n,s);const o=function(d){if(d.length!==0)return du(ie.create(d,"and"))}(t.filters);o&&(e.structuredQuery.where=o);const a=function(d){if(d.length!==0)return d.map(f=>function(v){return{field:dn(v.field),direction:Vm(v.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);const l=Pi(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{ht:e,parent:s}}function Sm(n){let t=Am(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let s=null;if(r>0){at(r===1);const f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let o=[];e.where&&(o=function(_){const v=hu(_);return v instanceof ie&&$c(v)?v.getFilters():[v]}(e.where));let a=[];e.orderBy&&(a=function(_){return _.map(v=>function(C){return new ur(fn(C.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(v))}(e.orderBy));let l=null;e.limit&&(l=function(_){let v;return v=typeof _=="object"?_.value:_,ws(v)?null:v}(e.limit));let u=null;e.startAt&&(u=function(_){const v=!!_.before,I=_.values||[];return new os(I,v)}(e.startAt));let d=null;return e.endAt&&(d=function(_){const v=!_.before,I=_.values||[];return new os(I,v)}(e.endAt)),Xf(t,s,a,o,l,"F",u,d)}function km(n,t){const e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function hu(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=fn(e.unaryFilter.field);return vt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=fn(e.unaryFilter.field);return vt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=fn(e.unaryFilter.field);return vt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=fn(e.unaryFilter.field);return vt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return G()}}(n):n.fieldFilter!==void 0?function(e){return vt.create(fn(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return G()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return ie.create(e.compositeFilter.filters.map(r=>hu(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return G()}}(e.compositeFilter.op))}(n):G()}function Vm(n){return bm[n]}function Nm(n){return vm[n]}function Dm(n){return wm[n]}function dn(n){return{fieldPath:n.canonicalString()}}function fn(n){return Rt.fromServerFormat(n.fieldPath)}function du(n){return n instanceof vt?function(e){if(e.op==="=="){if(cl(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NAN"}};if(ll(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(cl(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NOT_NAN"}};if(ll(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dn(e.field),op:Nm(e.op),value:e.value}}}(n):n instanceof ie?function(e){const r=e.getFilters().map(s=>du(s));return r.length===1?r[0]:{compositeFilter:{op:Dm(e.op),filters:r}}}(n):G()}function Lm(n){const t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function fu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(t,e,r,s,o=H.min(),a=H.min(),l=Ct.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(t){return new Se(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Se(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Se(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Se(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(t){this.Tt=t}}function jm(n){const t=Sm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ci(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(){this.Tn=new Om}addToCollectionParentIndex(t,e){return this.Tn.add(e),V.resolve()}getCollectionParents(t,e){return V.resolve(this.Tn.getEntries(e))}addFieldIndex(t,e){return V.resolve()}deleteFieldIndex(t,e){return V.resolve()}deleteAllFieldIndexes(t){return V.resolve()}createTargetIndexes(t,e){return V.resolve()}getDocumentsMatchingTarget(t,e){return V.resolve(null)}getIndexType(t,e){return V.resolve(0)}getFieldIndexes(t,e){return V.resolve([])}getNextCollectionGroupToUpdate(t){return V.resolve(null)}getMinOffset(t,e){return V.resolve(De.min())}getMinOffsetFromCollectionGroup(t,e){return V.resolve(De.min())}updateCollectionGroup(t,e,r){return V.resolve()}updateIndexEntries(t,e){return V.resolve()}}class Om{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new Tt(ft.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new Tt(ft.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const El={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},mu=41943040;class Gt{static withCacheSize(t){return new Gt(t,Gt.DEFAULT_COLLECTION_PERCENTILE,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Gt.DEFAULT_COLLECTION_PERCENTILE=10,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Gt.DEFAULT=new Gt(mu,Gt.DEFAULT_COLLECTION_PERCENTILE,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Gt.DISABLED=new Gt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new bn(0)}static Kn(){return new bn(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Al="LruGarbageCollector",Um=1048576;function Il([n,t],[e,r]){const s=et(n,e);return s===0?et(t,r):s}class $m{constructor(t){this.Hn=t,this.buffer=new Tt(Il),this.Jn=0}Yn(){return++this.Jn}Zn(t){const e=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();Il(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class qm{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){U(Al,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){xn(e)?U(Al,"Ignoring IndexedDB error during garbage collection: ",e):await In(e)}await this.er(3e5)})}}class Bm{constructor(t,e){this.tr=t,this.params=e}calculateTargetCount(t,e){return this.tr.nr(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return V.resolve(vs.ae);const r=new $m(e);return this.tr.forEachTarget(t,s=>r.Zn(s.sequenceNumber)).next(()=>this.tr.rr(t,s=>r.Zn(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.tr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.tr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(U("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(El)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),El):this.ir(t,e))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,e){let r,s,o,a,l,u,d;const f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(U("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),s=this.params.maximumSequenceNumbersToCollect):s=_,a=Date.now(),this.nthSequenceNumber(t,s))).next(_=>(r=_,l=Date.now(),this.removeTargets(t,r,e))).next(_=>(o=_,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(_=>(d=Date.now(),un()<=ve.DEBUG&&U("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${o} targets in `+(u-l)+`ms
	Removed ${_} documents in `+(d-u)+`ms
Total Duration: ${d-f}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:_})))}}function zm(n,t){return new Bm(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(){this.changes=new tn(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Lt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?V.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&sr(r.mutation,s,Ht.empty(),wt.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,rt()).next(()=>r))}getLocalViewOfDocuments(t,e,r=rt()){const s=Xe();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(o=>{let a=Jn();return o.forEach((l,u)=>{a=a.insert(l,u.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){const r=Xe();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,rt()))}populateOverlays(t,e,r){const s=[];return r.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((a,l)=>{e.set(a,l)})})}computeViews(t,e,r,s){let o=Ie();const a=rr(),l=function(){return rr()}();return e.forEach((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof $e)?o=o.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),sr(f.mutation,d,f.mutation.getFieldMask(),wt.now())):a.set(d.key,Ht.empty())}),this.recalculateAndSaveOverlays(t,o).next(u=>(u.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var _;return l.set(d,new Km(f,(_=a.get(d))!==null&&_!==void 0?_:null))}),l))}recalculateAndSaveOverlays(t,e){const r=rr();let s=new mt((a,l)=>a-l),o=rt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(const l of a)l.keys().forEach(u=>{const d=e.get(u);if(d===null)return;let f=r.get(u)||Ht.empty();f=l.applyToLocalView(d,f),r.set(u,f);const _=(s.get(l.batchId)||rt()).add(u);s=s.insert(l.batchId,_)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,_=Xc();f.forEach(v=>{if(!o.has(v)){const I=nu(e.get(v),r.get(v));I!==null&&_.set(v,I),o=o.add(v)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,_))}return V.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return function(a){return B.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Gc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):V.resolve(Xe());let l=or,u=o;return a.next(d=>V.forEach(d,(f,_)=>(l<_.largestBatchId&&(l=_.largestBatchId),o.get(f)?V.resolve():this.remoteDocumentCache.getEntry(t,f).next(v=>{u=u.insert(f,v)}))).next(()=>this.populateOverlays(t,d,o)).next(()=>this.computeViews(t,u,d,rt())).next(f=>({batchId:l,changes:Hc(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new B(e)).next(r=>{let s=Jn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){const o=e.collectionGroup;let a=Jn();return this.indexManager.getCollectionParents(t,o).next(l=>V.forEach(l,u=>{const d=function(_,v){return new Rn(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)}(e,u.child(o));return this.getDocumentsMatchingCollectionQuery(t,d,r,s).next(f=>{f.forEach((_,v)=>{a=a.insert(_,v)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s))).next(a=>{o.forEach((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,Lt.newInvalidDocument(f)))});let l=Jn();return a.forEach((u,d)=>{const f=o.get(u);f!==void 0&&sr(f.mutation,d,Ht.empty(),wt.now()),Is(e,d)&&(l=l.insert(u,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,e){return V.resolve(this.dr.get(e))}saveBundleMetadata(t,e){return this.dr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:he(s.createTime)}}(e)),V.resolve()}getNamedQuery(t,e){return V.resolve(this.Ar.get(e))}saveNamedQuery(t,e){return this.Ar.set(e.name,function(s){return{name:s.name,query:jm(s.bundledQuery),readTime:he(s.readTime)}}(e)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hm{constructor(){this.overlays=new mt(B.comparator),this.Rr=new Map}getOverlay(t,e){return V.resolve(this.overlays.get(e))}getOverlays(t,e){const r=Xe();return V.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,o)=>{this.Et(t,e,o)}),V.resolve()}removeOverlaysForBatchId(t,e,r){const s=this.Rr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.Rr.delete(r)),V.resolve()}getOverlaysForCollection(t,e,r){const s=Xe(),o=e.length+1,a=new B(e.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===o&&u.largestBatchId>r&&s.set(u.getKey(),u)}return V.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new mt((d,f)=>d-f);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>r){let f=o.get(d.largestBatchId);f===null&&(f=Xe(),o=o.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Xe(),u=o.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=s)););return V.resolve(l)}Et(t,e,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Rr.get(s.largestBatchId).delete(r.key);this.Rr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new mm(e,r));let o=this.Rr.get(e);o===void 0&&(o=rt(),this.Rr.set(e,o)),this.Rr.set(e,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(){this.sessionToken=Ct.EMPTY_BYTE_STRING}getSessionToken(t){return V.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,V.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(){this.Vr=new Tt(Et.mr),this.gr=new Tt(Et.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,e){const r=new Et(t,e);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.wr(new Et(t,e))}Sr(t,e){t.forEach(r=>this.removeReference(r,e))}br(t){const e=new B(new ft([])),r=new Et(e,t),s=new Et(e,t+1),o=[];return this.gr.forEachInRange([r,s],a=>{this.wr(a),o.push(a.key)}),o}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const e=new B(new ft([])),r=new Et(e,t),s=new Et(e,t+1);let o=rt();return this.gr.forEachInRange([r,s],a=>{o=o.add(a.key)}),o}containsKey(t){const e=new Et(t,0),r=this.Vr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class Et{constructor(t,e){this.key=t,this.Cr=e}static mr(t,e){return B.comparator(t.key,e.key)||et(t.Cr,e.Cr)}static pr(t,e){return et(t.Cr,e.Cr)||B.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Fr=1,this.Mr=new Tt(Et.mr)}checkEmpty(t){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){const o=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new fm(o,e,r,s);this.mutationQueue.push(a);for(const l of s)this.Mr=this.Mr.add(new Et(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return V.resolve(a)}lookupMutationBatch(t,e){return V.resolve(this.Or(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,s=this.Nr(r),o=s<0?0:s;return V.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?Ki:this.Fr-1)}getAllMutationBatches(t){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new Et(e,0),s=new Et(e,Number.POSITIVE_INFINITY),o=[];return this.Mr.forEachInRange([r,s],a=>{const l=this.Or(a.Cr);o.push(l)}),V.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new Tt(et);return e.forEach(s=>{const o=new Et(s,0),a=new Et(s,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([o,a],l=>{r=r.add(l.Cr)})}),V.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,s=r.length+1;let o=r;B.isDocumentKey(o)||(o=o.child(""));const a=new Et(new B(o),0);let l=new Tt(et);return this.Mr.forEachWhile(u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.Cr)),!0)},a),V.resolve(this.Br(l))}Br(t){const e=[];return t.forEach(r=>{const s=this.Or(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){at(this.Lr(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return V.forEach(e.mutations,s=>{const o=new Et(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Mr=r})}qn(t){}containsKey(t,e){const r=new Et(e,0),s=this.Mr.firstAfterOrEqual(r);return V.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,V.resolve()}Lr(t,e){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const e=this.Nr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(t){this.kr=t,this.docs=function(){return new mt(B.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,s=this.docs.get(r),o=s?s.size:0,a=this.kr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return V.resolve(r?r.document.mutableCopy():Lt.newInvalidDocument(e))}getEntries(t,e){let r=Ie();return e.forEach(s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Lt.newInvalidDocument(s))}),V.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Ie();const a=e.path,l=new B(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Pf(Cf(f),r)<=0||(s.has(f.key)||Is(e,f))&&(o=o.insert(f.key,f.mutableCopy()))}return V.resolve(o)}getAllFromCollectionGroup(t,e,r,s){G()}qr(t,e){return V.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Zm(this)}getSize(t){return V.resolve(this.size)}}class Zm extends Gm{constructor(t){super(),this.Ir=t}applyChanges(t){const e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.Ir.addEntry(t,s)):this.Ir.removeEntry(r)}),V.waitFor(e)}getFromCache(t,e){return this.Ir.getEntry(t,e)}getAllFromCache(t,e){return this.Ir.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(t){this.persistence=t,this.Qr=new tn(e=>Hi(e),Xi),this.lastRemoteSnapshotVersion=H.min(),this.highestTargetId=0,this.$r=0,this.Ur=new eo,this.targetCount=0,this.Kr=bn.Un()}forEachTarget(t,e){return this.Qr.forEach((r,s)=>e(s)),V.resolve()}getLastRemoteSnapshotVersion(t){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return V.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.$r&&(this.$r=e),V.resolve()}zn(t){this.Qr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Kr=new bn(e),this.highestTargetId=e),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,e){return this.zn(e),this.targetCount+=1,V.resolve()}updateTargetData(t,e){return this.zn(e),V.resolve()}removeTargetData(t,e){return this.Qr.delete(e.target),this.Ur.br(e.targetId),this.targetCount-=1,V.resolve()}removeTargets(t,e,r){let s=0;const o=[];return this.Qr.forEach((a,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.Qr.delete(a),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),V.waitFor(o).next(()=>s)}getTargetCount(t){return V.resolve(this.targetCount)}getTargetData(t,e){const r=this.Qr.get(e)||null;return V.resolve(r)}addMatchingKeys(t,e,r){return this.Ur.yr(e,r),V.resolve()}removeMatchingKeys(t,e,r){this.Ur.Sr(e,r);const s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(a=>{o.push(s.markPotentiallyOrphaned(t,a))}),V.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.Ur.br(e),V.resolve()}getMatchingKeysForTargetId(t,e){const r=this.Ur.vr(e);return V.resolve(r)}containsKey(t,e){return V.resolve(this.Ur.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(t,e){this.Wr={},this.overlays={},this.Gr=new vs(0),this.zr=!1,this.zr=!0,this.jr=new Xm,this.referenceDelegate=t(this),this.Hr=new tg(this),this.indexManager=new Fm,this.remoteDocumentCache=function(s){return new Jm(s)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new Mm(e),this.Yr=new Qm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Hm,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Wr[t.toKey()];return r||(r=new Ym(e,this.referenceDelegate),this.Wr[t.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,e,r){U("MemoryPersistence","Starting transaction:",t);const s=new eg(this.Gr.next());return this.referenceDelegate.Zr(),r(s).next(o=>this.referenceDelegate.Xr(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}ei(t,e){return V.or(Object.values(this.Wr).map(r=>()=>r.containsKey(t,e)))}}class eg extends kf{constructor(t){super(),this.currentSequenceNumber=t}}class no{constructor(t){this.persistence=t,this.ti=new eo,this.ni=null}static ri(t){return new no(t)}get ii(){if(this.ni)return this.ni;throw G()}addReference(t,e,r){return this.ti.addReference(r,e),this.ii.delete(r.toString()),V.resolve()}removeReference(t,e,r){return this.ti.removeReference(r,e),this.ii.add(r.toString()),V.resolve()}markPotentiallyOrphaned(t,e){return this.ii.add(e.toString()),V.resolve()}removeTarget(t,e){this.ti.br(e.targetId).forEach(s=>this.ii.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.ii.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}Zr(){this.ni=new Set}Xr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.ii,r=>{const s=B.fromPath(r);return this.si(t,s).next(o=>{o||e.removeEntry(s,H.min())})}).next(()=>(this.ni=null,e.apply(t)))}updateLimboDocument(t,e){return this.si(t,e).next(r=>{r?this.ii.delete(e.toString()):this.ii.add(e.toString())})}Jr(t){return 0}si(t,e){return V.or([()=>V.resolve(this.ti.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.ei(t,e)])}}class us{constructor(t,e){this.persistence=t,this.oi=new tn(r=>Df(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=zm(this,e)}static ri(t,e){return new us(t,e)}Zr(){}Xr(t){return V.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}nr(t){const e=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}sr(t){let e=0;return this.rr(t,r=>{e++}).next(()=>e)}rr(t,e){return V.forEach(this.oi,(r,s)=>this.ar(t,r,s).next(o=>o?V.resolve():e(s)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.qr(t,a=>this.ar(t,a,e).next(l=>{l||(r++,o.removeEntry(a,H.min()))})).next(()=>o.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.oi.set(e,t.currentSequenceNumber),V.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.oi.set(r,t.currentSequenceNumber),V.resolve()}removeReference(t,e,r){return this.oi.set(r,t.currentSequenceNumber),V.resolve()}updateLimboDocument(t,e){return this.oi.set(e,t.currentSequenceNumber),V.resolve()}Jr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Jr(t.data.value)),e}ar(t,e,r){return V.or([()=>this.persistence.ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.oi.get(e);return V.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Hi=r,this.Ji=s}static Yi(t,e){let r=rt(),s=rt();for(const o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new ro(t,e.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return Ed()?8:Vf(Ad())>0?6:4}()}initialize(t,e){this.ns=t,this.indexManager=e,this.Zi=!0}getDocumentsMatchingQuery(t,e,r,s){const o={result:null};return this.rs(t,e).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ss(t,e,s,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new ng;return this._s(t,e,a).next(l=>{if(o.result=l,this.Xi)return this.us(t,e,a,l.size)})}).next(()=>o.result)}us(t,e,r,s){return r.documentReadCount<this.es?(un()<=ve.DEBUG&&U("QueryEngine","SDK will not create cache indexes for query:",hn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),V.resolve()):(un()<=ve.DEBUG&&U("QueryEngine","Query:",hn(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ts*s?(un()<=ve.DEBUG&&U("QueryEngine","The SDK decides to create cache indexes for query:",hn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,ue(e))):V.resolve())}rs(t,e){if(fl(e))return V.resolve(null);let r=ue(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Ci(e,null,"F"),r=ue(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{const a=rt(...o);return this.ns.getDocuments(t,a).next(l=>this.indexManager.getMinOffset(t,r).next(u=>{const d=this.cs(e,l);return this.ls(e,d,a,u.readTime)?this.rs(t,Ci(e,null,"F")):this.hs(t,d,e,u)}))})))}ss(t,e,r,s){return fl(e)||s.isEqual(H.min())?V.resolve(null):this.ns.getDocuments(t,r).next(o=>{const a=this.cs(e,o);return this.ls(e,a,r,s)?V.resolve(null):(un()<=ve.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),hn(e)),this.hs(t,a,e,Rf(s,or)).next(l=>l))})}cs(t,e){let r=new Tt(Wc(t));return e.forEach((s,o)=>{Is(t,o)&&(r=r.add(o))}),r}ls(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}_s(t,e,r){return un()<=ve.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",hn(e)),this.ns.getDocumentsMatchingQuery(t,e,De.min(),r)}hs(t,e,r,s){return this.ns.getDocumentsMatchingQuery(t,r,s).next(o=>(e.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const so="LocalStore",sg=3e8;class ig{constructor(t,e,r,s){this.persistence=t,this.Ps=e,this.serializer=s,this.Ts=new mt(et),this.Is=new tn(o=>Hi(o),Xi),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(r)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Wm(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ts))}}function og(n,t,e,r){return new ig(n,t,e,r)}async function pu(n,t){const e=X(n);return await e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,e.As(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{const a=[],l=[];let u=rt();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of o){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return e.localDocuments.getDocuments(r,u).next(d=>({Rs:d,removedBatchIds:a,addedBatchIds:l}))})})}function ag(n,t){const e=X(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=t.batch.keys(),o=e.ds.newChangeBuffer({trackRemovals:!0});return function(l,u,d,f){const _=d.batch,v=_.keys();let I=V.resolve();return v.forEach(C=>{I=I.next(()=>f.getEntry(u,C)).next(S=>{const R=d.docVersions.get(C);at(R!==null),S.version.compareTo(R)<0&&(_.applyToRemoteDocument(S,d),S.isValidDocument()&&(S.setReadTime(d.commitVersion),f.addEntry(S)))})}),I.next(()=>l.mutationQueue.removeMutationBatch(u,_))}(e,r,t,o).next(()=>o.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let u=rt();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u}(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function yu(n){const t=X(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Hr.getLastRemoteSnapshotVersion(e))}function lg(n,t){const e=X(n),r=t.snapshotVersion;let s=e.Ts;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=e.ds.newChangeBuffer({trackRemovals:!0});s=e.Ts;const l=[];t.targetChanges.forEach((f,_)=>{const v=s.get(_);if(!v)return;l.push(e.Hr.removeMatchingKeys(o,f.removedDocuments,_).next(()=>e.Hr.addMatchingKeys(o,f.addedDocuments,_)));let I=v.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(_)!==null?I=I.withResumeToken(Ct.EMPTY_BYTE_STRING,H.min()).withLastLimboFreeSnapshotVersion(H.min()):f.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(f.resumeToken,r)),s=s.insert(_,I),function(S,R,N){return S.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=sg?!0:N.addedDocuments.size+N.modifiedDocuments.size+N.removedDocuments.size>0}(v,I,f)&&l.push(e.Hr.updateTargetData(o,I))});let u=Ie(),d=rt();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,f))}),l.push(cg(o,a,t.documentUpdates).next(f=>{u=f.Vs,d=f.fs})),!r.isEqual(H.min())){const f=e.Hr.getLastRemoteSnapshotVersion(o).next(_=>e.Hr.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(f)}return V.waitFor(l).next(()=>a.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,u,d)).next(()=>u)}).then(o=>(e.Ts=s,o))}function cg(n,t,e){let r=rt(),s=rt();return e.forEach(o=>r=r.add(o)),t.getEntries(n,r).next(o=>{let a=Ie();return e.forEach((l,u)=>{const d=o.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(H.min())?(t.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(u),a=a.insert(l,u)):U(so,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)}),{Vs:a,fs:s}})}function ug(n,t){const e=X(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=Ki),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function hg(n,t){const e=X(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.Hr.getTargetData(r,t).next(o=>o?(s=o,V.resolve(s)):e.Hr.allocateTargetId(r).next(a=>(s=new Se(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Hr.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=e.Ts.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ts=e.Ts.insert(r.targetId,r),e.Is.set(t,r.targetId)),r})}async function Ni(n,t,e){const r=X(n),s=r.Ts.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!xn(a))throw a;U(so,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ts=r.Ts.remove(t),r.Is.delete(s.target)}function xl(n,t,e){const r=X(n);let s=H.min(),o=rt();return r.persistence.runTransaction("Execute query","readwrite",a=>function(u,d,f){const _=X(u),v=_.Is.get(f);return v!==void 0?V.resolve(_.Ts.get(v)):_.Hr.getTargetData(d,f)}(r,a,ue(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(a,l.targetId).next(u=>{o=u})}).next(()=>r.Ps.getDocumentsMatchingQuery(a,t,e?s:H.min(),e?o:rt())).next(l=>(dg(r,Jf(t),l),{documents:l,gs:o})))}function dg(n,t,e){let r=n.Es.get(t)||H.min();e.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Es.set(t,r)}class Rl{constructor(){this.activeTargetIds=sm()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class fg{constructor(){this.ho=new Rl,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,e,r){this.Po[t]=e}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new Rl,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl="ConnectivityMonitor";class Pl{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){U(Cl,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){U(Cl,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gr=null;function Di(){return Gr===null?Gr=function(){return 268435456+Math.round(2147483648*Math.random())}():Gr++,"0x"+Gr.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii="RestConnection",gg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pg{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.po=e+"://"+t.host,this.yo=`projects/${r}/databases/${s}`,this.wo=this.databaseId.database===ss?`project_id=${r}`:`project_id=${r}&database_id=${s}`}So(t,e,r,s,o){const a=Di(),l=this.bo(t,e.toUriEncodedString());U(ii,`Sending RPC '${t}' ${a}:`,l,r);const u={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(u,s,o),this.vo(t,l,u,r).then(d=>(U(ii,`Received RPC '${t}' ${a}: `,d),d),d=>{throw gn(ii,`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",r),d})}Co(t,e,r,s,o,a){return this.So(t,e,r,s,o)}Do(t,e,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+An}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}bo(t,e){const r=gg[t];return`${this.po}/v1/${e}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt="WebChannelConnection";class _g extends pg{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,e,r,s){const o=Di();return new Promise((a,l)=>{const u=new vc;u.setWithCredentials(!0),u.listenOnce(wc.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Yr.NO_ERROR:const f=u.getResponseJson();U(Nt,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(f)),a(f);break;case Yr.TIMEOUT:U(Nt,`RPC '${t}' ${o} timed out`),l(new O(k.DEADLINE_EXCEEDED,"Request time out"));break;case Yr.HTTP_ERROR:const _=u.getStatus();if(U(Nt,`RPC '${t}' ${o} failed with status:`,_,"response text:",u.getResponseText()),_>0){let v=u.getResponseJson();Array.isArray(v)&&(v=v[0]);const I=v==null?void 0:v.error;if(I&&I.status&&I.message){const C=function(R){const N=R.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(N)>=0?N:k.UNKNOWN}(I.status);l(new O(C,I.message))}else l(new O(k.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new O(k.UNAVAILABLE,"Connection failed."));break;default:G()}}finally{U(Nt,`RPC '${t}' ${o} completed.`)}});const d=JSON.stringify(s);U(Nt,`RPC '${t}' ${o} sending request:`,s),u.send(e,"POST",d,r,15)})}Wo(t,e,r){const s=Di(),o=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Ac(),l=Ec(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;const f=o.join("");U(Nt,`Creating RPC '${t}' stream ${s}: ${f}`,u);const _=a.createWebChannel(f,u);let v=!1,I=!1;const C=new yg({Fo:R=>{I?U(Nt,`Not sending because RPC '${t}' stream ${s} is closed:`,R):(v||(U(Nt,`Opening RPC '${t}' stream ${s} transport.`),_.open(),v=!0),U(Nt,`RPC '${t}' stream ${s} sending:`,R),_.send(R))},Mo:()=>_.close()}),S=(R,N,j)=>{R.listen(N,$=>{try{j($)}catch(z){setTimeout(()=>{throw z},0)}})};return S(_,Yn.EventType.OPEN,()=>{I||(U(Nt,`RPC '${t}' stream ${s} transport opened.`),C.Qo())}),S(_,Yn.EventType.CLOSE,()=>{I||(I=!0,U(Nt,`RPC '${t}' stream ${s} transport closed`),C.Uo())}),S(_,Yn.EventType.ERROR,R=>{I||(I=!0,gn(Nt,`RPC '${t}' stream ${s} transport errored:`,R),C.Uo(new O(k.UNAVAILABLE,"The operation could not be completed")))}),S(_,Yn.EventType.MESSAGE,R=>{var N;if(!I){const j=R.data[0];at(!!j);const $=j,z=($==null?void 0:$.error)||((N=$[0])===null||N===void 0?void 0:N.error);if(z){U(Nt,`RPC '${t}' stream ${s} received error:`,z);const it=z.status;let D=function(p){const b=bt[p];if(b!==void 0)return su(b)}(it),y=z.message;D===void 0&&(D=k.INTERNAL,y="Unknown error status: "+it+" with message "+z.message),I=!0,C.Uo(new O(D,y)),_.close()}else U(Nt,`RPC '${t}' stream ${s} received:`,j),C.Ko(j)}}),S(l,Tc.STAT_EVENT,R=>{R.stat===wi.PROXY?U(Nt,`RPC '${t}' stream ${s} detected buffering proxy`):R.stat===wi.NOPROXY&&U(Nt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.$o()},0),C}}function oi(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(n){return new Tm(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Ti=t,this.timerId=e,this.Go=r,this.zo=s,this.jo=o,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const e=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),s=Math.max(0,e-r);s>0&&U("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ho} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,s,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sl="PersistentStream";class bu{constructor(t,e,r,s,o,a,l,u){this.Ti=t,this.n_=r,this.r_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new _u(t,e)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,e){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():e&&e.code===k.RESOURCE_EXHAUSTED?(Ae(e.toString()),Ae("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):e&&e.code===k.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(e)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),e=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.i_===e&&this.V_(r,s)},r=>{t(()=>{const s=new O(k.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(s)})})}V_(t,e){const r=this.R_(this.i_);this.stream=this.f_(t,e),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(s=>{r(()=>this.m_(s))}),this.stream.onMessage(s=>{r(()=>++this.__==1?this.g_(s):this.onNext(s))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return U(Sl,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return e=>{this.Ti.enqueueAndForget(()=>this.i_===t?e():(U(Sl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class bg extends bu{constructor(t,e,r,s,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}f_(t,e){return this.connection.Wo("Listen",t,e)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const e=Im(this.serializer,t),r=function(o){if(!("targetChange"in o))return H.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?H.min():a.readTime?he(a.readTime):H.min()}(t);return this.listener.p_(e,r)}y_(t){const e={};e.database=Vi(this.serializer),e.addTarget=function(o,a){let l;const u=a.target;if(l=xi(u)?{documents:Cm(o,u)}:{query:Pm(o,u).ht},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=au(o,a.resumeToken);const d=Pi(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(H.min())>0){l.readTime=cs(o,a.snapshotVersion.toTimestamp());const d=Pi(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,t);const r=km(this.serializer,t);r&&(e.labels=r),this.I_(e)}w_(t){const e={};e.database=Vi(this.serializer),e.removeTarget=t,this.I_(e)}}class vg extends bu{constructor(t,e,r,s,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,e){return this.connection.Wo("Write",t,e)}g_(t){return at(!!t.streamToken),this.lastStreamToken=t.streamToken,at(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){at(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const e=Rm(t.writeResults,t.commitTime),r=he(t.commitTime);return this.listener.v_(r,e)}C_(){const t={};t.database=Vi(this.serializer),this.I_(t)}b_(t){const e={streamToken:this.lastStreamToken,writes:t.map(r=>xm(this.serializer,r))};this.I_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{}class Tg extends wg{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.F_=!1}M_(){if(this.F_)throw new O(k.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,r,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.So(t,Si(e,r),s,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(k.UNKNOWN,o.toString())})}Co(t,e,r,s,o){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Co(t,Si(e,r),s,a,l,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(k.UNKNOWN,a.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class Eg{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Ae(e),this.N_=!1):U("OnlineStateTracker",e)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ze="RemoteStore";class Ag{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=o,this.z_.To(a=>{r.enqueueAndForget(async()=>{en(this)&&(U(Ze,"Restarting streams for network reachability change."),await async function(u){const d=X(u);d.W_.add(4),await pr(d),d.j_.set("Unknown"),d.W_.delete(4),await ks(d)}(this))})}),this.j_=new Eg(r,s)}}async function ks(n){if(en(n))for(const t of n.G_)await t(!0)}async function pr(n){for(const t of n.G_)await t(!1)}function vu(n,t){const e=X(n);e.K_.has(t.targetId)||(e.K_.set(t.targetId,t),lo(e)?ao(e):Cn(e).c_()&&oo(e,t))}function io(n,t){const e=X(n),r=Cn(e);e.K_.delete(t),r.c_()&&wu(e,t),e.K_.size===0&&(r.c_()?r.P_():en(e)&&e.j_.set("Unknown"))}function oo(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(H.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Cn(n).y_(t)}function wu(n,t){n.H_.Ne(t),Cn(n).w_(t)}function ao(n){n.H_=new _m({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.K_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),Cn(n).start(),n.j_.B_()}function lo(n){return en(n)&&!Cn(n).u_()&&n.K_.size>0}function en(n){return X(n).W_.size===0}function Tu(n){n.H_=void 0}async function Ig(n){n.j_.set("Online")}async function xg(n){n.K_.forEach((t,e)=>{oo(n,t)})}async function Rg(n,t){Tu(n),lo(n)?(n.j_.q_(t),ao(n)):n.j_.set("Unknown")}async function Cg(n,t,e){if(n.j_.set("Online"),t instanceof ou&&t.state===2&&t.cause)try{await async function(s,o){const a=o.cause;for(const l of o.targetIds)s.K_.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.K_.delete(l),s.H_.removeTarget(l))}(n,t)}catch(r){U(Ze,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await hs(n,r)}else if(t instanceof es?n.H_.We(t):t instanceof iu?n.H_.Ze(t):n.H_.je(t),!e.isEqual(H.min()))try{const r=await yu(n.localStore);e.compareTo(r)>=0&&await function(o,a){const l=o.H_.ot(a);return l.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=o.K_.get(d);f&&o.K_.set(d,f.withResumeToken(u.resumeToken,a))}}),l.targetMismatches.forEach((u,d)=>{const f=o.K_.get(u);if(!f)return;o.K_.set(u,f.withResumeToken(Ct.EMPTY_BYTE_STRING,f.snapshotVersion)),wu(o,u);const _=new Se(f.target,u,d,f.sequenceNumber);oo(o,_)}),o.remoteSyncer.applyRemoteEvent(l)}(n,e)}catch(r){U(Ze,"Failed to raise snapshot:",r),await hs(n,r)}}async function hs(n,t,e){if(!xn(t))throw t;n.W_.add(1),await pr(n),n.j_.set("Offline"),e||(e=()=>yu(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{U(Ze,"Retrying IndexedDB access"),await e(),n.W_.delete(1),await ks(n)})}function Eu(n,t){return t().catch(e=>hs(n,e,t))}async function Vs(n){const t=X(n),e=Fe(t);let r=t.U_.length>0?t.U_[t.U_.length-1].batchId:Ki;for(;Pg(t);)try{const s=await ug(t.localStore,r);if(s===null){t.U_.length===0&&e.P_();break}r=s.batchId,Sg(t,s)}catch(s){await hs(t,s)}Au(t)&&Iu(t)}function Pg(n){return en(n)&&n.U_.length<10}function Sg(n,t){n.U_.push(t);const e=Fe(n);e.c_()&&e.S_&&e.b_(t.mutations)}function Au(n){return en(n)&&!Fe(n).u_()&&n.U_.length>0}function Iu(n){Fe(n).start()}async function kg(n){Fe(n).C_()}async function Vg(n){const t=Fe(n);for(const e of n.U_)t.b_(e.mutations)}async function Ng(n,t,e){const r=n.U_.shift(),s=Ji.from(r,t,e);await Eu(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Vs(n)}async function Dg(n,t){t&&Fe(n).S_&&await async function(r,s){if(function(a){return pm(a)&&a!==k.ABORTED}(s.code)){const o=r.U_.shift();Fe(r).h_(),await Eu(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),await Vs(r)}}(n,t),Au(n)&&Iu(n)}async function kl(n,t){const e=X(n);e.asyncQueue.verifyOperationInProgress(),U(Ze,"RemoteStore received new credentials");const r=en(e);e.W_.add(3),await pr(e),r&&e.j_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.W_.delete(3),await ks(e)}async function Lg(n,t){const e=X(n);t?(e.W_.delete(2),await ks(e)):t||(e.W_.add(2),await pr(e),e.j_.set("Unknown"))}function Cn(n){return n.J_||(n.J_=function(e,r,s){const o=X(e);return o.M_(),new bg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{xo:Ig.bind(null,n),No:xg.bind(null,n),Lo:Rg.bind(null,n),p_:Cg.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),lo(n)?ao(n):n.j_.set("Unknown")):(await n.J_.stop(),Tu(n))})),n.J_}function Fe(n){return n.Y_||(n.Y_=function(e,r,s){const o=X(e);return o.M_(),new vg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:kg.bind(null,n),Lo:Dg.bind(null,n),D_:Vg.bind(null,n),v_:Ng.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await Vs(n)):(await n.Y_.stop(),n.U_.length>0&&(U(Ze,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Te,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){const a=Date.now()+r,l=new co(t,e,a,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(k.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function uo(n,t){if(Ae("AsyncQueue",`${t}: ${n}`),xn(n))return new O(k.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{static emptySet(t){return new mn(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||B.comparator(e.key,r.key):(e,r)=>B.comparator(e.key,r.key),this.keyedMap=Jn(),this.sortedSet=new mt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof mn)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const r=new mn;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(){this.Z_=new mt(B.comparator)}track(t){const e=t.doc.key,r=this.Z_.get(e);r?t.type!==0&&r.type===3?this.Z_=this.Z_.insert(e,t):t.type===3&&r.type!==1?this.Z_=this.Z_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.Z_=this.Z_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.Z_=this.Z_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.Z_=this.Z_.remove(e):t.type===1&&r.type===2?this.Z_=this.Z_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.Z_=this.Z_.insert(e,{type:2,doc:t.doc}):G():this.Z_=this.Z_.insert(e,t)}X_(){const t=[];return this.Z_.inorderTraversal((e,r)=>{t.push(r)}),t}}class vn{constructor(t,e,r,s,o,a,l,u,d){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(t,e,r,s,o){const a=[];return e.forEach(l=>{a.push({type:0,doc:l})}),new vn(t,e,mn.emptySet(e),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&As(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class jg{constructor(){this.queries=Nl(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(e,r){const s=X(e),o=s.queries;s.queries=Nl(),o.forEach((a,l)=>{for(const u of l.ta)u.onError(r)})})(this,new O(k.ABORTED,"Firestore shutting down"))}}function Nl(){return new tn(n=>Kc(n),As)}async function ho(n,t){const e=X(n);let r=3;const s=t.query;let o=e.queries.get(s);o?!o.na()&&t.ra()&&(r=2):(o=new Mg,r=t.ra()?0:1);try{switch(r){case 0:o.ea=await e.onListen(s,!0);break;case 1:o.ea=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const l=uo(a,`Initialization of query '${hn(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.ta.push(t),t.sa(e.onlineState),o.ea&&t.oa(o.ea)&&mo(e)}async function fo(n,t){const e=X(n),r=t.query;let s=3;const o=e.queries.get(r);if(o){const a=o.ta.indexOf(t);a>=0&&(o.ta.splice(a,1),o.ta.length===0?s=t.ra()?0:1:!o.na()&&t.ra()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function Fg(n,t){const e=X(n);let r=!1;for(const s of t){const o=s.query,a=e.queries.get(o);if(a){for(const l of a.ta)l.oa(s)&&(r=!0);a.ea=s}}r&&mo(e)}function Og(n,t,e){const r=X(n),s=r.queries.get(t);if(s)for(const o of s.ta)o.onError(e);r.queries.delete(t)}function mo(n){n.ia.forEach(t=>{t.next()})}var Li,Dl;(Dl=Li||(Li={}))._a="default",Dl.Cache="cache";class go{constructor(t,e,r){this.query=t,this.aa=e,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(t){if(!this.options.includeMetadataChanges){const r=[];for(const s of t.docChanges)s.type!==3&&r.push(s);t=new vn(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ua?this.la(t)&&(this.aa.next(t),e=!0):this.ha(t,this.onlineState)&&(this.Pa(t),e=!0),this.ca=t,e}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let e=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),e=!0),e}ha(t,e){if(!t.fromCache||!this.ra())return!0;const r=e!=="Offline";return(!this.options.Ta||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}la(t){if(t.docChanges.length>0)return!0;const e=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}Pa(t){t=vn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==Li.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu{constructor(t){this.key=t}}class Ru{constructor(t){this.key=t}}class Ug{constructor(t,e){this.query=t,this.fa=e,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=rt(),this.mutatedKeys=rt(),this.ya=Wc(t),this.wa=new mn(this.ya)}get Sa(){return this.fa}ba(t,e){const r=e?e.Da:new Vl,s=e?e.wa:this.wa;let o=e?e.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((f,_)=>{const v=s.get(f),I=Is(this.query,_)?_:null,C=!!v&&this.mutatedKeys.has(v.key),S=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations);let R=!1;v&&I?v.data.isEqual(I.data)?C!==S&&(r.track({type:3,doc:I}),R=!0):this.va(v,I)||(r.track({type:2,doc:I}),R=!0,(u&&this.ya(I,u)>0||d&&this.ya(I,d)<0)&&(l=!0)):!v&&I?(r.track({type:0,doc:I}),R=!0):v&&!I&&(r.track({type:1,doc:v}),R=!0,(u||d)&&(l=!0)),R&&(I?(a=a.add(I),o=S?o.add(f):o.delete(f)):(a=a.delete(f),o=o.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),o=o.delete(f.key),r.track({type:1,doc:f})}return{wa:a,Da:r,ls:l,mutatedKeys:o}}va(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){const o=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const a=t.Da.X_();a.sort((f,_)=>function(I,C){const S=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return G()}};return S(I)-S(C)}(f.type,_.type)||this.ya(f.doc,_.doc)),this.Ca(r),s=s!=null&&s;const l=e&&!s?this.Fa():[],u=this.pa.size===0&&this.current&&!s?1:0,d=u!==this.ga;return this.ga=u,a.length!==0||d?{snapshot:new vn(this.query,t.wa,o,a,t.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:l}:{Ma:l}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Vl,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(e=>this.fa=this.fa.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.fa=this.fa.delete(e)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=rt(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});const e=[];return t.forEach(r=>{this.pa.has(r)||e.push(new Ru(r))}),this.pa.forEach(r=>{t.has(r)||e.push(new xu(r))}),e}Oa(t){this.fa=t.gs,this.pa=rt();const e=this.ba(t.documents);return this.applyChanges(e,!0)}Na(){return vn.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const po="SyncEngine";class $g{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class qg{constructor(t){this.key=t,this.Ba=!1}}class Bg{constructor(t,e,r,s,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.La={},this.ka=new tn(l=>Kc(l),As),this.qa=new Map,this.Qa=new Set,this.$a=new mt(B.comparator),this.Ua=new Map,this.Ka=new eo,this.Wa={},this.Ga=new Map,this.za=bn.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function zg(n,t,e=!0){const r=Nu(n);let s;const o=r.ka.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.Na()):s=await Cu(r,t,e,!0),s}async function Gg(n,t){const e=Nu(n);await Cu(e,t,!0,!1)}async function Cu(n,t,e,r){const s=await hg(n.localStore,ue(t)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e);let l;return r&&(l=await Kg(n,t,o,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&vu(n.remoteStore,s),l}async function Kg(n,t,e,r,s){n.Ha=(_,v,I)=>async function(S,R,N,j){let $=R.view.ba(N);$.ls&&($=await xl(S.localStore,R.query,!1).then(({documents:y})=>R.view.ba(y,$)));const z=j&&j.targetChanges.get(R.targetId),it=j&&j.targetMismatches.get(R.targetId)!=null,D=R.view.applyChanges($,S.isPrimaryClient,z,it);return Ml(S,R.targetId,D.Ma),D.snapshot}(n,_,v,I);const o=await xl(n.localStore,t,!0),a=new Ug(t,o.gs),l=a.ba(o.documents),u=gr.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,u);Ml(n,e,d.Ma);const f=new $g(t,e,a);return n.ka.set(t,f),n.qa.has(e)?n.qa.get(e).push(t):n.qa.set(e,[t]),d.snapshot}async function Wg(n,t,e){const r=X(n),s=r.ka.get(t),o=r.qa.get(s.targetId);if(o.length>1)return r.qa.set(s.targetId,o.filter(a=>!As(a,t))),void r.ka.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ni(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&io(r.remoteStore,s.targetId),Mi(r,s.targetId)}).catch(In)):(Mi(r,s.targetId),await Ni(r.localStore,s.targetId,!0))}async function Qg(n,t){const e=X(n),r=e.ka.get(t),s=e.qa.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),io(e.remoteStore,r.targetId))}async function Hg(n,t,e){const r=np(n);try{const s=await function(a,l){const u=X(a),d=wt.now(),f=l.reduce((I,C)=>I.add(C.key),rt());let _,v;return u.persistence.runTransaction("Locally write mutations","readwrite",I=>{let C=Ie(),S=rt();return u.ds.getEntries(I,f).next(R=>{C=R,C.forEach((N,j)=>{j.isValidDocument()||(S=S.add(N))})}).next(()=>u.localDocuments.getOverlayedDocuments(I,C)).next(R=>{_=R;const N=[];for(const j of l){const $=hm(j,_.get(j.key).overlayedDocument);$!=null&&N.push(new $e(j.key,$,Fc($.value.mapValue),Bt.exists(!0)))}return u.mutationQueue.addMutationBatch(I,d,N,l)}).next(R=>{v=R;const N=R.applyToLocalDocumentSet(_,S);return u.documentOverlayCache.saveOverlays(I,R.batchId,N)})}).then(()=>({batchId:v.batchId,changes:Hc(_)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,u){let d=a.Wa[a.currentUser.toKey()];d||(d=new mt(et)),d=d.insert(l,u),a.Wa[a.currentUser.toKey()]=d}(r,s.batchId,e),await yr(r,s.changes),await Vs(r.remoteStore)}catch(s){const o=uo(s,"Failed to persist write");e.reject(o)}}async function Pu(n,t){const e=X(n);try{const r=await lg(e.localStore,t);t.targetChanges.forEach((s,o)=>{const a=e.Ua.get(o);a&&(at(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.Ba=!0:s.modifiedDocuments.size>0?at(a.Ba):s.removedDocuments.size>0&&(at(a.Ba),a.Ba=!1))}),await yr(e,r,t)}catch(r){await In(r)}}function Ll(n,t,e){const r=X(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const s=[];r.ka.forEach((o,a)=>{const l=a.view.sa(t);l.snapshot&&s.push(l.snapshot)}),function(a,l){const u=X(a);u.onlineState=l;let d=!1;u.queries.forEach((f,_)=>{for(const v of _.ta)v.sa(l)&&(d=!0)}),d&&mo(u)}(r.eventManager,t),s.length&&r.La.p_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Xg(n,t,e){const r=X(n);r.sharedClientState.updateQueryState(t,"rejected",e);const s=r.Ua.get(t),o=s&&s.key;if(o){let a=new mt(B.comparator);a=a.insert(o,Lt.newNoDocument(o,H.min()));const l=rt().add(o),u=new Ps(H.min(),new Map,new mt(et),a,l);await Pu(r,u),r.$a=r.$a.remove(o),r.Ua.delete(t),yo(r)}else await Ni(r.localStore,t,!1).then(()=>Mi(r,t,e)).catch(In)}async function Yg(n,t){const e=X(n),r=t.batch.batchId;try{const s=await ag(e.localStore,t);ku(e,r,null),Su(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await yr(e,s)}catch(s){await In(s)}}async function Jg(n,t,e){const r=X(n);try{const s=await function(a,l){const u=X(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next(_=>(at(_!==null),f=_.keys(),u.mutationQueue.removeMutationBatch(d,_))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>u.localDocuments.getDocuments(d,f))})}(r.localStore,t);ku(r,t,e),Su(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await yr(r,s)}catch(s){await In(s)}}function Su(n,t){(n.Ga.get(t)||[]).forEach(e=>{e.resolve()}),n.Ga.delete(t)}function ku(n,t,e){const r=X(n);let s=r.Wa[r.currentUser.toKey()];if(s){const o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Wa[r.currentUser.toKey()]=s}}function Mi(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.qa.get(t))n.ka.delete(r),e&&n.La.Ja(r,e);n.qa.delete(t),n.isPrimaryClient&&n.Ka.br(t).forEach(r=>{n.Ka.containsKey(r)||Vu(n,r)})}function Vu(n,t){n.Qa.delete(t.path.canonicalString());const e=n.$a.get(t);e!==null&&(io(n.remoteStore,e),n.$a=n.$a.remove(t),n.Ua.delete(e),yo(n))}function Ml(n,t,e){for(const r of e)r instanceof xu?(n.Ka.addReference(r.key,t),Zg(n,r)):r instanceof Ru?(U(po,"Document no longer in limbo: "+r.key),n.Ka.removeReference(r.key,t),n.Ka.containsKey(r.key)||Vu(n,r.key)):G()}function Zg(n,t){const e=t.key,r=e.path.canonicalString();n.$a.get(e)||n.Qa.has(r)||(U(po,"New document in limbo: "+e),n.Qa.add(r),yo(n))}function yo(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const e=new B(ft.fromString(t)),r=n.za.next();n.Ua.set(r,new qg(e)),n.$a=n.$a.insert(e,r),vu(n.remoteStore,new Se(ue(Es(e.path)),r,"TargetPurposeLimboResolution",vs.ae))}}async function yr(n,t,e){const r=X(n),s=[],o=[],a=[];r.ka.isEmpty()||(r.ka.forEach((l,u)=>{a.push(r.Ha(u,t,e).then(d=>{var f;if((d||e)&&r.isPrimaryClient){const _=d?!d.fromCache:(f=e==null?void 0:e.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,_?"current":"not-current")}if(d){s.push(d);const _=ro.Yi(u.targetId,d);o.push(_)}}))}),await Promise.all(a),r.La.p_(s),await async function(u,d){const f=X(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>V.forEach(d,v=>V.forEach(v.Hi,I=>f.persistence.referenceDelegate.addReference(_,v.targetId,I)).next(()=>V.forEach(v.Ji,I=>f.persistence.referenceDelegate.removeReference(_,v.targetId,I)))))}catch(_){if(!xn(_))throw _;U(so,"Failed to update sequence numbers: "+_)}for(const _ of d){const v=_.targetId;if(!_.fromCache){const I=f.Ts.get(v),C=I.snapshotVersion,S=I.withLastLimboFreeSnapshotVersion(C);f.Ts=f.Ts.insert(v,S)}}}(r.localStore,o))}async function tp(n,t){const e=X(n);if(!e.currentUser.isEqual(t)){U(po,"User change. New user:",t.toKey());const r=await pu(e.localStore,t);e.currentUser=t,function(o,a){o.Ga.forEach(l=>{l.forEach(u=>{u.reject(new O(k.CANCELLED,a))})}),o.Ga.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await yr(e,r.Rs)}}function ep(n,t){const e=X(n),r=e.Ua.get(t);if(r&&r.Ba)return rt().add(r.key);{let s=rt();const o=e.qa.get(t);if(!o)return s;for(const a of o){const l=e.ka.get(a);s=s.unionWith(l.view.Sa)}return s}}function Nu(n){const t=X(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Pu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ep.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Xg.bind(null,t),t.La.p_=Fg.bind(null,t.eventManager),t.La.Ja=Og.bind(null,t.eventManager),t}function np(n){const t=X(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Yg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Jg.bind(null,t),t}class ds{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ss(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,e){return null}nu(t,e){return null}eu(t){return og(this.persistence,new rg,t.initialUser,this.serializer)}Xa(t){return new gu(no.ri,this.serializer)}Za(t){return new fg}async terminate(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ds.provider={build:()=>new ds};class rp extends ds{constructor(t){super(),this.cacheSizeBytes=t}tu(t,e){at(this.persistence.referenceDelegate instanceof us);const r=this.persistence.referenceDelegate.garbageCollector;return new qm(r,t.asyncQueue,e)}Xa(t){const e=this.cacheSizeBytes!==void 0?Gt.withCacheSize(this.cacheSizeBytes):Gt.DEFAULT;return new gu(r=>us.ri(r,e),this.serializer)}}class ji{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ll(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=tp.bind(null,this.syncEngine),await Lg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new jg}()}createDatastore(t){const e=Ss(t.databaseInfo.databaseId),r=function(o){return new _g(o)}(t.databaseInfo);return function(o,a,l,u){return new Tg(o,a,l,u)}(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return function(r,s,o,a,l){return new Ag(r,s,o,a,l)}(this.localStore,this.datastore,t.asyncQueue,e=>Ll(this.syncEngine,e,0),function(){return Pl.D()?new Pl:new mg}())}createSyncEngine(t,e){return function(s,o,a,l,u,d,f){const _=new Bg(s,o,a,l,u,d);return f&&(_.ja=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(s){const o=X(s);U(Ze,"RemoteStore shutting down."),o.W_.add(5),await pr(o),o.z_.shutdown(),o.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(e=this.eventManager)===null||e===void 0||e.terminate()}}ji.provider={build:()=>new ji};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Ae("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,e){setTimeout(()=>{this.muted||t(e)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oe="FirestoreClient";class sp{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=Dt.UNAUTHENTICATED,this.clientId=Rc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async a=>{U(Oe,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(U(Oe,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Te;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=uo(e,"Failed to shutdown persistence");t.reject(r)}}),t.promise}}async function ai(n,t){n.asyncQueue.verifyOperationInProgress(),U(Oe,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await pu(t.localStore,s),r=s)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function jl(n,t){n.asyncQueue.verifyOperationInProgress();const e=await ip(n);U(Oe,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>kl(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>kl(t.remoteStore,s)),n._onlineComponents=t}async function ip(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){U(Oe,"Using user provided OfflineComponentProvider");try{await ai(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!function(s){return s.name==="FirebaseError"?s.code===k.FAILED_PRECONDITION||s.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;gn("Error using user provided cache. Falling back to memory cache: "+e),await ai(n,new ds)}}else U(Oe,"Using default OfflineComponentProvider"),await ai(n,new rp(void 0));return n._offlineComponents}async function Du(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(U(Oe,"Using user provided OnlineComponentProvider"),await jl(n,n._uninitializedComponentsProvider._online)):(U(Oe,"Using default OnlineComponentProvider"),await jl(n,new ji))),n._onlineComponents}function op(n){return Du(n).then(t=>t.syncEngine)}async function fs(n){const t=await Du(n),e=t.eventManager;return e.onListen=zg.bind(null,t.syncEngine),e.onUnlisten=Wg.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Gg.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Qg.bind(null,t.syncEngine),e}function ap(n,t,e={}){const r=new Te;return n.asyncQueue.enqueueAndForget(async()=>function(o,a,l,u,d){const f=new _o({next:v=>{f.su(),a.enqueueAndForget(()=>fo(o,_));const I=v.docs.has(l);!I&&v.fromCache?d.reject(new O(k.UNAVAILABLE,"Failed to get document because the client is offline.")):I&&v.fromCache&&u&&u.source==="server"?d.reject(new O(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(v)},error:v=>d.reject(v)}),_=new go(Es(l.path),f,{includeMetadataChanges:!0,Ta:!0});return ho(o,_)}(await fs(n),n.asyncQueue,t,e,r)),r.promise}function lp(n,t,e={}){const r=new Te;return n.asyncQueue.enqueueAndForget(async()=>function(o,a,l,u,d){const f=new _o({next:v=>{f.su(),a.enqueueAndForget(()=>fo(o,_)),v.fromCache&&u.source==="server"?d.reject(new O(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(v)},error:v=>d.reject(v)}),_=new go(l,f,{includeMetadataChanges:!0,Ta:!0});return ho(o,_)}(await fs(n),n.asyncQueue,t,e,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fl=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(n,t,e){if(!e)throw new O(k.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function cp(n,t,e,r){if(t===!0&&r===!0)throw new O(k.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Ol(n){if(!B.isDocumentKey(n))throw new O(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ul(n){if(B.isDocumentKey(n))throw new O(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ns(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":G()}function zt(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new O(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Ns(n);throw new O(k.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ju="firestore.googleapis.com",$l=!0;class ql{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new O(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ju,this.ssl=$l}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:$l;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=mu;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Um)throw new O(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}cp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Lu((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new O(k.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new O(k.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new O(k.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ds{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ql({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new O(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ql(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new _f;switch(r.type){case"firstParty":return new Tf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const r=Fl.get(e);r&&(U("ComponentProvider","Removing Datastore"),Fl.delete(e),r.terminate())}(this),Promise.resolve()}}function up(n,t,e,r={}){var s;const o=(n=zt(n,Ds))._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),l=`${t}:${e}`;o.host!==ju&&o.host!==l&&gn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},o),{host:l,ssl:!1,emulatorOptions:r});if(!vd(u,a)&&(n._setSettings(u),r.mockUserToken)){let d,f;if(typeof r.mockUserToken=="string")d=r.mockUserToken,f=Dt.MOCK_USER;else{d=wd(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const _=r.mockUserToken.sub||r.mockUserToken.user_id;if(!_)throw new O(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Dt(_)}n._authCredentials=new bf(new Ic(d,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new qe(this.firestore,t,this._query)}}class Ft{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ve(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ft(this.firestore,t,this._key)}}class Ve extends qe{constructor(t,e,r){super(t,e,Es(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ft(this.firestore,null,new B(t))}withConverter(t){return new Ve(this.firestore,t,this._path)}}function ms(n,t,...e){if(n=te(n),Mu("collection","path",t),n instanceof Ds){const r=ft.fromString(t,...e);return Ul(r),new Ve(n,null,r)}{if(!(n instanceof Ft||n instanceof Ve))throw new O(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ft.fromString(t,...e));return Ul(r),new Ve(n.firestore,null,r)}}function xt(n,t,...e){if(n=te(n),arguments.length===1&&(t=Rc.newId()),Mu("doc","path",t),n instanceof Ds){const r=ft.fromString(t,...e);return Ol(r),new Ft(n,null,new B(r))}{if(!(n instanceof Ft||n instanceof Ve))throw new O(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ft.fromString(t,...e));return Ol(r),new Ft(n.firestore,n instanceof Ve?n.converter:null,new B(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bl="AsyncQueue";class zl{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new _u(this,"async_queue_retry"),this.Su=()=>{const r=oi();r&&U(Bl,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.bu=t;const e=oi();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const e=oi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const e=new Te;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!xn(t))throw t;U(Bl,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const e=this.bu.then(()=>(this.pu=!0,t().catch(r=>{this.gu=r,this.pu=!1;const s=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw Ae("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.pu=!1,r))));return this.bu=e,e}enqueueAfterDelay(t,e,r){this.Du(),this.wu.indexOf(t)>-1&&(e=0);const s=co.createAndSchedule(this,t,e,r,o=>this.Fu(o));return this.fu.push(s),s}Du(){this.gu&&G()}verifyOperationInProgress(){}async Mu(){let t;do t=this.bu,await t;while(t!==this.bu)}xu(t){for(const e of this.fu)if(e.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(const e of this.fu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const e=this.fu.indexOf(t);this.fu.splice(e,1)}}function Gl(n){return function(e,r){if(typeof e!="object"||e===null)return!1;const s=e;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1}(n,["next","error","complete"])}class me extends Ds{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new zl,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new zl(t),this._firestoreClient=void 0,await t}}}function hp(n,t){const e=typeof n=="object"?n:yd(),r=typeof n=="string"?n:ss,s=_d(e,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=bd("firestore");o&&up(s,...o)}return s}function _r(n){if(n._terminated)throw new O(k.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||dp(n),n._firestoreClient}function dp(n){var t,e,r;const s=n._freezeSettings(),o=function(l,u,d,f){return new jf(l,u,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Lu(f.experimentalLongPollingOptions),f.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new sp(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(t){this._byteString=t}static fromBase64String(t){try{return new wn(Ct.fromBase64String(t))}catch(e){throw new O(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new wn(Ct.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class br{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new O(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new O(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new O(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return et(this._lat,t._lat)||et(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fp=/^__.*__$/;class mp{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new $e(t,this.data,this.fieldMask,e,this.fieldTransforms):new mr(t,this.data,e,this.fieldTransforms)}}class Fu{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new $e(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Ou(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}class To{constructor(t,e,r,s,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Bu(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new To(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var e;const r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.ku({path:r,Qu:!1});return s.$u(t),s}Uu(t){var e;const r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.ku({path:r,Qu:!1});return s.Bu(),s}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return gs(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Ou(this.Lu)&&fp.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class gp{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Ss(t)}ju(t,e,r,s=!1){return new To({Lu:t,methodName:e,zu:r,path:Rt.emptyPath(),Qu:!1,Gu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vr(n){const t=n._freezeSettings(),e=Ss(n._databaseId);return new gp(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Eo(n,t,e,r,s,o={}){const a=n.ju(o.merge||o.mergeFields?2:0,t,e,s);Ao("Data must be an object, but it was:",a,r);const l=qu(r,a);let u,d;if(o.merge)u=new Ht(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const f=[];for(const _ of o.mergeFields){const v=Fi(t,_,e);if(!a.contains(v))throw new O(k.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);zu(f,v)||f.push(v)}u=new Ht(f),d=a.fieldTransforms.filter(_=>u.covers(_.field))}else u=null,d=a.fieldTransforms;return new mp(new Kt(l),u,d)}class wr extends bo{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof wr}}function Uu(n,t,e,r){const s=n.ju(1,t,e);Ao("Data must be an object, but it was:",s,r);const o=[],a=Kt.empty();Ue(r,(u,d)=>{const f=Io(t,u,e);d=te(d);const _=s.Uu(f);if(d instanceof wr)o.push(f);else{const v=Tr(d,_);v!=null&&(o.push(f),a.set(f,v))}});const l=new Ht(o);return new Fu(a,l,s.fieldTransforms)}function $u(n,t,e,r,s,o){const a=n.ju(1,t,e),l=[Fi(t,r,e)],u=[s];if(o.length%2!=0)throw new O(k.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)l.push(Fi(t,o[v])),u.push(o[v+1]);const d=[],f=Kt.empty();for(let v=l.length-1;v>=0;--v)if(!zu(d,l[v])){const I=l[v];let C=u[v];C=te(C);const S=a.Uu(I);if(C instanceof wr)d.push(I);else{const R=Tr(C,S);R!=null&&(d.push(I),f.set(I,R))}}const _=new Ht(d);return new Fu(f,_,a.fieldTransforms)}function pp(n,t,e,r=!1){return Tr(e,n.ju(r?4:3,t))}function Tr(n,t){if(Bu(n=te(n)))return Ao("Unsupported field value:",t,n),qu(n,t);if(n instanceof bo)return function(r,s){if(!Ou(s.Lu))throw s.Wu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Wu(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(r,s){const o=[];let a=0;for(const l of r){let u=Tr(l,s.Ku(a));u==null&&(u={nullValue:"NULL_VALUE"}),o.push(u),a++}return{arrayValue:{values:o}}}(n,t)}return function(r,s){if((r=te(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return im(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=wt.fromDate(r);return{timestampValue:cs(s.serializer,o)}}if(r instanceof wt){const o=new wt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:cs(s.serializer,o)}}if(r instanceof vo)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof wn)return{bytesValue:au(s.serializer,r._byteString)};if(r instanceof Ft){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Wu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:to(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof wo)return function(a,l){return{mapValue:{fields:{[Lc]:{stringValue:jc},[is]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw l.Wu("VectorValues must only contain numeric values.");return Yi(l.serializer,d)})}}}}}}(r,s);throw s.Wu(`Unsupported field value: ${Ns(r)}`)}(n,t)}function qu(n,t){const e={};return Pc(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ue(n,(r,s)=>{const o=Tr(s,t.qu(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function Bu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof wt||n instanceof vo||n instanceof wn||n instanceof Ft||n instanceof bo||n instanceof wo)}function Ao(n,t,e){if(!Bu(e)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(e)){const r=Ns(e);throw r==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+r)}}function Fi(n,t,e){if((t=te(t))instanceof br)return t._internalPath;if(typeof t=="string")return Io(n,t);throw gs("Field path arguments must be of type string or ",n,!1,void 0,e)}const yp=new RegExp("[~\\*/\\[\\]]");function Io(n,t,e){if(t.search(yp)>=0)throw gs(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new br(...t.split("."))._internalPath}catch{throw gs(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function gs(n,t,e,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(o||a)&&(u+=" (found",o&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new O(k.INVALID_ARGUMENT,l+n+u)}function zu(n,t){return n.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ft(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new _p(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(xo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class _p extends Gu{data(){return super.data()}}function xo(n,t){return typeof t=="string"?Io(n,t):t instanceof br?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ku(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ro{}class Wu extends Ro{}function Qu(n,t,...e){let r=[];t instanceof Ro&&r.push(t),r=r.concat(e),function(o){const a=o.filter(u=>u instanceof Po).length,l=o.filter(u=>u instanceof Co).length;if(a>1||a>0&&l>0)throw new O(k.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Co extends Wu{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new Co(t,e,r)}_apply(t){const e=this._parse(t);return Xu(t._query,e),new qe(t.firestore,t.converter,Ri(t._query,e))}_parse(t){const e=vr(t.firestore);return function(o,a,l,u,d,f,_){let v;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new O(k.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Wl(_,f);const C=[];for(const S of _)C.push(Kl(u,o,S));v={arrayValue:{values:C}}}else v=Kl(u,o,_)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Wl(_,f),v=pp(l,a,_,f==="in"||f==="not-in");return vt.create(d,f,v)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}class Po extends Ro{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Po(t,e)}_parse(t){const e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:ie.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:(function(s,o){let a=s;const l=o.getFlattenedFilters();for(const u of l)Xu(a,u),a=Ri(a,u)}(t._query,e),new qe(t.firestore,t.converter,Ri(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class So extends Wu{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new So(t,e)}_apply(t){const e=function(s,o,a){if(s.startAt!==null)throw new O(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new O(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ur(o,a)}(t._query,this._field,this._direction);return new qe(t.firestore,t.converter,function(s,o){const a=s.explicitOrderBy.concat([o]);return new Rn(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}}function Hu(n,t="asc"){const e=t,r=xo("orderBy",n);return So._create(r,e)}function Kl(n,t,e){if(typeof(e=te(e))=="string"){if(e==="")throw new O(k.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Gc(t)&&e.indexOf("/")!==-1)throw new O(k.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const r=t.path.child(ft.fromString(e));if(!B.isDocumentKey(r))throw new O(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return al(n,new B(r))}if(e instanceof Ft)return al(n,e._key);throw new O(k.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ns(e)}.`)}function Wl(n,t){if(!Array.isArray(n)||n.length===0)throw new O(k.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Xu(n,t){const e=function(s,o){for(const a of s)for(const l of a.getFlattenedFilters())if(o.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new O(k.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new O(k.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class bp{convertValue(t,e="none"){switch(je(t)){case 0:return null;case 1:return t.booleanValue;case 2:return pt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Me(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw G()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return Ue(t,(s,o)=>{r[s]=this.convertValue(o,e)}),r}convertVectorValue(t){var e,r,s;const o=(s=(r=(e=t.fields)===null||e===void 0?void 0:e[is].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>pt(a.doubleValue));return new wo(o)}convertGeoPoint(t){return new vo(pt(t.latitude),pt(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":const r=Ts(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(ar(t));default:return null}}convertTimestamp(t){const e=Le(t);return new wt(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=ft.fromString(t);at(fu(r));const s=new lr(r.get(1),r.get(3)),o=new B(r.popFirst(5));return s.isEqual(e)||Ae(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ko(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Yu extends Gu{constructor(t,e,r,s,o,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new ns(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(xo("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}}class ns extends Yu{data(t={}){return super.data(t)}}class Ju{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new tr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new ns(this._firestore,this._userDataWriter,r.key,r,new tr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const u=new ns(s._firestore,s._userDataWriter,l.doc.key,l.doc,new tr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{const u=new ns(s._firestore,s._userDataWriter,l.doc.key,l.doc,new tr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:vp(l.type),doc:u,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function vp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zu(n){n=zt(n,Ft);const t=zt(n.firestore,me);return ap(_r(t),n._key).then(e=>rh(t,n,e))}class Vo extends bp{constructor(t){super(),this.firestore=t}convertBytes(t){return new wn(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ft(this.firestore,null,e)}}function No(n){n=zt(n,qe);const t=zt(n.firestore,me),e=_r(t),r=new Vo(t);return Ku(n._query),lp(e,n._query).then(s=>new Ju(t,r,n,s))}function Oi(n,t,e){n=zt(n,Ft);const r=zt(n.firestore,me),s=ko(n.converter,t,e);return Er(r,[Eo(vr(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Bt.none())])}function Ui(n,t,e,...r){n=zt(n,Ft);const s=zt(n.firestore,me),o=vr(s);let a;return a=typeof(t=te(t))=="string"||t instanceof br?$u(o,"updateDoc",n._key,t,e,r):Uu(o,"updateDoc",n._key,t),Er(s,[a.toMutation(n._key,Bt.exists(!0))])}function th(n){return Er(zt(n.firestore,me),[new Cs(n._key,Bt.none())])}function eh(n,t){const e=zt(n.firestore,me),r=xt(n),s=ko(n.converter,t);return Er(e,[Eo(vr(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Bt.exists(!1))]).then(()=>r)}function nh(n,...t){var e,r,s;n=te(n);let o={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||Gl(t[a])||(o=t[a],a++);const l={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Gl(t[a])){const _=t[a];t[a]=(e=_.next)===null||e===void 0?void 0:e.bind(_),t[a+1]=(r=_.error)===null||r===void 0?void 0:r.bind(_),t[a+2]=(s=_.complete)===null||s===void 0?void 0:s.bind(_)}let u,d,f;if(n instanceof Ft)d=zt(n.firestore,me),f=Es(n._key.path),u={next:_=>{t[a]&&t[a](rh(d,n,_))},error:t[a+1],complete:t[a+2]};else{const _=zt(n,qe);d=zt(_.firestore,me),f=_._query;const v=new Vo(d);u={next:I=>{t[a]&&t[a](new Ju(d,v,_,I))},error:t[a+1],complete:t[a+2]},Ku(n._query)}return function(v,I,C,S){const R=new _o(S),N=new go(I,R,C);return v.asyncQueue.enqueueAndForget(async()=>ho(await fs(v),N)),()=>{R.su(),v.asyncQueue.enqueueAndForget(async()=>fo(await fs(v),N))}}(_r(d),f,l,u)}function Er(n,t){return function(r,s){const o=new Te;return r.asyncQueue.enqueueAndForget(async()=>Hg(await op(r),s,o)),o.promise}(_r(n),t)}function rh(n,t,e){const r=e.docs.get(t._key),s=new Vo(n);return new Yu(n,s,t._key,r,new tr(e.hasPendingWrites,e.fromCache),t.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wp{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=vr(t)}set(t,e,r){this._verifyNotCommitted();const s=li(t,this._firestore),o=ko(s.converter,e,r),a=Eo(this._dataReader,"WriteBatch.set",s._key,o,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Bt.none())),this}update(t,e,r,...s){this._verifyNotCommitted();const o=li(t,this._firestore);let a;return a=typeof(e=te(e))=="string"||e instanceof br?$u(this._dataReader,"WriteBatch.update",o._key,e,r,s):Uu(this._dataReader,"WriteBatch.update",o._key,e),this._mutations.push(a.toMutation(o._key,Bt.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=li(t,this._firestore);return this._mutations=this._mutations.concat(new Cs(e._key,Bt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new O(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function li(n,t){if((n=te(n)).firestore!==t)throw new O(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tp(){return new wr("deleteField")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ql(n){return _r(n=zt(n,me)),new wp(n,t=>Er(n,t))}(function(t,e=!0){(function(s){An=s})(Td),fd(new md("firestore",(r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),l=new me(new vf(r.getProvider("auth-internal")),new Ef(a,r.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new O(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new lr(d.options.projectId,f)}(a,s),a);return o=Object.assign({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),qa(Ha,Xa,t),qa(Ha,Xa,"esm2017")})();const Ep={apiKey:"AIzaSyAsGrtbRSjz77iShv4tB0vQ33A23ie9JM8",authDomain:"tiger3homs-f3a5f-d60da.firebaseapp.com",projectId:"tiger3homs-f3a5f-d60da",storageBucket:"tiger3homs-f3a5f-d60da.firebasestorage.app",messagingSenderId:"509990310606",appId:"1:509990310606:web:e36d91ea748c4cd64d369f",measurementId:"G-DDZTZ6MR6S"};let ci=null,Ne=null,Q=null;try{ci=Id(Ep),Ne=xd(ci),Q=hp(ci)}catch(n){throw console.error("Firebase initialization error:",n),new Error(`Firebase initialization failed: ${n instanceof Error?n.message:String(n)}`)}if(!Q)throw new Error("Firestore failed to initialize and is null.");const Mt={en:{generalInfo:{title:"General Information",siteTitle:"Tiger3Homs",siteRole:"Website Developer & Tech Enthusiast",logoUrl:"https://raw.githubusercontent.com/tiger3homs/home/refs/heads/main/public/logo.png",footerText:"© 2025. Built and designed by Tiger3homs"},about:{title:"About Me",description:"I'm a passionate software developer with expertise in web development and system architecture. I love building efficient, scalable solutions and contributing to open-source projects. When I'm not coding, you can find me exploring new technologies and sharing knowledge with the developer community."},projects:{title:"Featured Projects",project1:{title:"OS Design v1",description:"The website offers a sleek, intuitive design with straightforward navigation and professional fonts. It highlights the company's services and expertise, making it easy for visitors to get in touch. Simple visuals and effective calls-to-action ensure a smooth and engaging experience. For more information, explore the site.",tags:["Modern","User-friendly","Professional"],link:""},project2:{title:"Project 2",description:"Coming soon.",tags:["Wait","For","It"],link:""},project3:{title:"New Project",description:"This is a new project description.",tags:["New","Exciting","Innovative"],link:""}},contact:{title:"Contact Me",nameLabel:"Name",namePlaceholder:"Enter your name",emailLabel:"Email",emailPlaceholder:"Enter your email",messageLabel:"Message",messagePlaceholder:"Enter your message",submitButton:"Send Message"},services:{title:"Services",list:[{title:"Web Development",description:"Building modern, responsive websites tailored to your needs."},{title:"UI/UX Design",description:"Crafting user-friendly and visually appealing designs."},{title:"SEO Optimization",description:"Improving your website's visibility on search engines."},{title:"Consulting",description:"Providing expert advice to help you achieve your goals."}]}}},Ap=n=>{const e=/[A-Z]/.test(n),r=/[a-z]/.test(n),s=/\d/.test(n),o=/[!@#$%^&*(),.?":{}|<>]/.test(n);return n.length>=8&&e&&r&&s&&o},Ip=()=>{const[n,t]=F.useState(""),[e,r]=F.useState(""),[s,o]=F.useState(""),[a,l]=F.useState(!1),u=uc();F.useEffect(()=>{const f=setTimeout(()=>{Ne.signOut()},18e5);return()=>clearTimeout(f)},[]),F.useEffect(()=>{const f=dc(Ne,_=>{_&&u("/admin/dashboard",{replace:!0})});return()=>f()},[u]);const d=async f=>{if(f.preventDefault(),o(""),l(!0),!n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){o("Please enter a valid email address"),l(!1);return}if(!Ap(e)){o("Password must be at least 8 characters long and contain uppercase, lowercase, numbers, and special characters"),l(!1);return}try{await Rd(Ne,n,e)}catch(_){let v="Failed to log in. Please check your credentials.";if(_.code)switch(_.code){case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":v="Invalid email or password.";break;case"auth/invalid-email":v="Invalid email format.";break;case"auth/too-many-requests":v="Too many failed attempts. Please try again later.";break;default:console.error("Firebase Login error:",_)}o(v)}finally{l(!1)}};return w.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:w.jsxs("div",{className:"p-8 bg-white rounded shadow-md w-full max-w-sm",children:[w.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Admin Login"}),w.jsxs("form",{onSubmit:d,children:[w.jsxs("div",{className:"mb-4",children:[w.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),w.jsx("input",{type:"email",id:"email",value:n,onChange:f=>t(f.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0,disabled:a})]}),w.jsxs("div",{className:"mb-4",children:[w.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"password",children:"Password"}),w.jsx("input",{type:"password",id:"password",value:e,onChange:f=>r(f.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0,disabled:a})]}),s&&w.jsx("p",{className:"text-red-500 text-xs italic mb-4",children:s}),w.jsx("div",{className:"flex items-center justify-between",children:w.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full disabled:opacity-50",disabled:a,children:a?"Logging in...":"Login"})})]})]})})},xp=({data:n,path:t,handleChange:e,editingPath:r,setEditingPath:s,handleAddProject:o,handleDelete:a,renderFields:l})=>w.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded",children:[w.jsxs("div",{className:"flex justify-between items-center mb-3",children:[w.jsx("h4",{className:"text-lg font-semibold capitalize",children:(n==null?void 0:n.title)||String(t[0]).replace(/([A-Z])/g," $1")}),w.jsx("button",{onClick:o,className:"bg-blue-500 hover:bg-blue-700 text-white text-sm font-bold py-1 px-3 rounded focus:outline-none focus:shadow-outline",children:"+ Add Project"})]}),(n==null?void 0:n.title)!==void 0&&typeof n.title=="string"&&l({title:n.title},t,e,r,s,void 0,void 0),Object.entries(n).map(([u,d])=>{if(u!=="title"&&typeof d=="object"&&d!==null&&!Array.isArray(d)){const f=[...t,u];return w.jsxs("div",{className:"mb-6 p-4 bg-white border border-gray-200 rounded-lg shadow-sm relative",children:[w.jsxs("div",{className:"flex justify-between items-start mb-3",children:[w.jsxs("h5",{className:"text-lg font-semibold text-gray-700 mr-4",children:["Project: ",w.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:u})]}),w.jsx("button",{onClick:()=>{window.confirm(`Are you sure you want to delete project "${u}"?`)&&a(f)},className:"bg-red-500 hover:bg-red-600 text-white text-xs font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline transition-colors duration-150","aria-label":`Delete project ${u}`,children:"Delete Project"})]}),w.jsx("div",{className:"space-y-4",children:l(d,f,e,r,s,void 0,a)})]},f.join("."))}return null})]},t.join(".")),Hl=({data:n,path:t,handleChange:e,editingPath:r,setEditingPath:s,handleDelete:o,handleAddService:a,renderFields:l})=>!n||typeof n!="object"?w.jsx("p",{children:"Error: Services data is missing or invalid."}):(Array.isArray(n.list)||console.warn("Services data is missing 'list' array."),w.jsxs(w.Fragment,{children:[w.jsx("button",{onClick:a,className:"mb-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-700 focus:ring-opacity-50","aria-label":"Add new service item",children:"Add New Service Item"}),l(n,t,e,r,s,void 0,o)]})),{min:Rp,max:Cp}=Math,Ye=(n,t=0,e=1)=>Rp(Cp(t,n),e),Do=n=>{n._clipped=!1,n._unclipped=n.slice(0);for(let t=0;t<=3;t++)t<3?((n[t]<0||n[t]>255)&&(n._clipped=!0),n[t]=Ye(n[t],0,255)):t===3&&(n[t]=Ye(n[t],0,1));return n},sh={};for(let n of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])sh[`[object ${n}]`]=n.toLowerCase();function nt(n){return sh[Object.prototype.toString.call(n)]||"object"}const tt=(n,t=null)=>n.length>=3?Array.prototype.slice.call(n):nt(n[0])=="object"&&t?t.split("").filter(e=>n[0][e]!==void 0).map(e=>n[0][e]):n[0].slice(0),Pn=n=>{if(n.length<2)return null;const t=n.length-1;return nt(n[t])=="string"?n[t].toLowerCase():null},{PI:Ls,min:ih,max:oh}=Math,Zt=n=>Math.round(n*100)/100,$i=n=>Math.round(n*100)/100,be=Ls*2,ui=Ls/3,Pp=Ls/180,Sp=180/Ls;function ah(n){return[...n.slice(0,3).reverse(),...n.slice(3)]}const Y={format:{},autodetect:[]};class L{constructor(...t){const e=this;if(nt(t[0])==="object"&&t[0].constructor&&t[0].constructor===this.constructor)return t[0];let r=Pn(t),s=!1;if(!r){s=!0,Y.sorted||(Y.autodetect=Y.autodetect.sort((o,a)=>a.p-o.p),Y.sorted=!0);for(let o of Y.autodetect)if(r=o.test(...t),r)break}if(Y.format[r]){const o=Y.format[r].apply(null,s?t:t.slice(0,-1));e._rgb=Do(o)}else throw new Error("unknown format: "+t);e._rgb.length===3&&e._rgb.push(1)}toString(){return nt(this.hex)=="function"?this.hex():`[${this._rgb.join(",")}]`}}const kp="3.1.2",W=(...n)=>new L(...n);W.version=kp;const Tn={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Vp=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,Np=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,lh=n=>{if(n.match(Vp)){(n.length===4||n.length===7)&&(n=n.substr(1)),n.length===3&&(n=n.split(""),n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]);const t=parseInt(n,16),e=t>>16,r=t>>8&255,s=t&255;return[e,r,s,1]}if(n.match(Np)){(n.length===5||n.length===9)&&(n=n.substr(1)),n.length===4&&(n=n.split(""),n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]);const t=parseInt(n,16),e=t>>24&255,r=t>>16&255,s=t>>8&255,o=Math.round((t&255)/255*100)/100;return[e,r,s,o]}throw new Error(`unknown hex color: ${n}`)},{round:Kr}=Math,ch=(...n)=>{let[t,e,r,s]=tt(n,"rgba"),o=Pn(n)||"auto";s===void 0&&(s=1),o==="auto"&&(o=s<1?"rgba":"rgb"),t=Kr(t),e=Kr(e),r=Kr(r);let l="000000"+(t<<16|e<<8|r).toString(16);l=l.substr(l.length-6);let u="0"+Kr(s*255).toString(16);switch(u=u.substr(u.length-2),o.toLowerCase()){case"rgba":return`#${l}${u}`;case"argb":return`#${u}${l}`;default:return`#${l}`}};L.prototype.name=function(){const n=ch(this._rgb,"rgb");for(let t of Object.keys(Tn))if(Tn[t]===n)return t.toLowerCase();return n};Y.format.named=n=>{if(n=n.toLowerCase(),Tn[n])return lh(Tn[n]);throw new Error("unknown color name: "+n)};Y.autodetect.push({p:5,test:(n,...t)=>{if(!t.length&&nt(n)==="string"&&Tn[n.toLowerCase()])return"named"}});L.prototype.alpha=function(n,t=!1){return n!==void 0&&nt(n)==="number"?t?(this._rgb[3]=n,this):new L([this._rgb[0],this._rgb[1],this._rgb[2],n],"rgb"):this._rgb[3]};L.prototype.clipped=function(){return this._rgb._clipped||!1};const de={Kn:18,labWhitePoint:"d65",Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452,kE:216/24389,kKE:8,kK:24389/27,RefWhiteRGB:{X:.95047,Y:1,Z:1.08883},MtxRGB2XYZ:{m00:.4124564390896922,m01:.21267285140562253,m02:.0193338955823293,m10:.357576077643909,m11:.715152155287818,m12:.11919202588130297,m20:.18043748326639894,m21:.07217499330655958,m22:.9503040785363679},MtxXYZ2RGB:{m00:3.2404541621141045,m01:-.9692660305051868,m02:.055643430959114726,m10:-1.5371385127977166,m11:1.8760108454466942,m12:-.2040259135167538,m20:-.498531409556016,m21:.041556017530349834,m22:1.0572251882231791},As:.9414285350000001,Bs:1.040417467,Cs:1.089532651,MtxAdaptMa:{m00:.8951,m01:-.7502,m02:.0389,m10:.2664,m11:1.7135,m12:-.0685,m20:-.1614,m21:.0367,m22:1.0296},MtxAdaptMaI:{m00:.9869929054667123,m01:.43230526972339456,m02:-.008528664575177328,m10:-.14705425642099013,m11:.5183602715367776,m12:.04004282165408487,m20:.15996265166373125,m21:.0492912282128556,m22:.9684866957875502}},Dp=new Map([["a",[1.0985,.35585]],["b",[1.0985,.35585]],["c",[.98074,1.18232]],["d50",[.96422,.82521]],["d55",[.95682,.92149]],["d65",[.95047,1.08883]],["e",[1,1,1]],["f2",[.99186,.67393]],["f7",[.95041,1.08747]],["f11",[1.00962,.6435]],["icc",[.96422,.82521]]]);function we(n){const t=Dp.get(String(n).toLowerCase());if(!t)throw new Error("unknown Lab illuminant "+n);de.labWhitePoint=n,de.Xn=t[0],de.Zn=t[1]}function fr(){return de.labWhitePoint}const Lo=(...n)=>{n=tt(n,"lab");const[t,e,r]=n,[s,o,a]=Lp(t,e,r),[l,u,d]=uh(s,o,a);return[l,u,d,n.length>3?n[3]:1]},Lp=(n,t,e)=>{const{kE:r,kK:s,kKE:o,Xn:a,Yn:l,Zn:u}=de,d=(n+16)/116,f=.002*t+d,_=d-.005*e,v=f*f*f,I=_*_*_,C=v>r?v:(116*f-16)/s,S=n>o?Math.pow((n+16)/116,3):n/s,R=I>r?I:(116*_-16)/s,N=C*a,j=S*l,$=R*u;return[N,j,$]},hi=n=>{const t=Math.sign(n);return n=Math.abs(n),(n<=.0031308?n*12.92:1.055*Math.pow(n,1/2.4)-.055)*t},uh=(n,t,e)=>{const{MtxAdaptMa:r,MtxAdaptMaI:s,MtxXYZ2RGB:o,RefWhiteRGB:a,Xn:l,Yn:u,Zn:d}=de,f=l*r.m00+u*r.m10+d*r.m20,_=l*r.m01+u*r.m11+d*r.m21,v=l*r.m02+u*r.m12+d*r.m22,I=a.X*r.m00+a.Y*r.m10+a.Z*r.m20,C=a.X*r.m01+a.Y*r.m11+a.Z*r.m21,S=a.X*r.m02+a.Y*r.m12+a.Z*r.m22,R=(n*r.m00+t*r.m10+e*r.m20)*(I/f),N=(n*r.m01+t*r.m11+e*r.m21)*(C/_),j=(n*r.m02+t*r.m12+e*r.m22)*(S/v),$=R*s.m00+N*s.m10+j*s.m20,z=R*s.m01+N*s.m11+j*s.m21,it=R*s.m02+N*s.m12+j*s.m22,D=hi($*o.m00+z*o.m10+it*o.m20),y=hi($*o.m01+z*o.m11+it*o.m21),m=hi($*o.m02+z*o.m12+it*o.m22);return[D*255,y*255,m*255]},Mo=(...n)=>{const[t,e,r,...s]=tt(n,"rgb"),[o,a,l]=hh(t,e,r),[u,d,f]=Mp(o,a,l);return[u,d,f,...s.length>0&&s[0]<1?[s[0]]:[]]};function Mp(n,t,e){const{Xn:r,Yn:s,Zn:o,kE:a,kK:l}=de,u=n/r,d=t/s,f=e/o,_=u>a?Math.pow(u,1/3):(l*u+16)/116,v=d>a?Math.pow(d,1/3):(l*d+16)/116,I=f>a?Math.pow(f,1/3):(l*f+16)/116;return[116*v-16,500*(_-v),200*(v-I)]}function di(n){const t=Math.sign(n);return n=Math.abs(n),(n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4))*t}const hh=(n,t,e)=>{n=di(n/255),t=di(t/255),e=di(e/255);const{MtxRGB2XYZ:r,MtxAdaptMa:s,MtxAdaptMaI:o,Xn:a,Yn:l,Zn:u,As:d,Bs:f,Cs:_}=de;let v=n*r.m00+t*r.m10+e*r.m20,I=n*r.m01+t*r.m11+e*r.m21,C=n*r.m02+t*r.m12+e*r.m22;const S=a*s.m00+l*s.m10+u*s.m20,R=a*s.m01+l*s.m11+u*s.m21,N=a*s.m02+l*s.m12+u*s.m22;let j=v*s.m00+I*s.m10+C*s.m20,$=v*s.m01+I*s.m11+C*s.m21,z=v*s.m02+I*s.m12+C*s.m22;return j*=S/d,$*=R/f,z*=N/_,v=j*o.m00+$*o.m10+z*o.m20,I=j*o.m01+$*o.m11+z*o.m21,C=j*o.m02+$*o.m12+z*o.m22,[v,I,C]};L.prototype.lab=function(){return Mo(this._rgb)};const jp=(...n)=>new L(...n,"lab");Object.assign(W,{lab:jp,getLabWhitePoint:fr,setLabWhitePoint:we});Y.format.lab=Lo;Y.autodetect.push({p:2,test:(...n)=>{if(n=tt(n,"lab"),nt(n)==="array"&&n.length===3)return"lab"}});L.prototype.darken=function(n=1){const t=this,e=t.lab();return e[0]-=de.Kn*n,new L(e,"lab").alpha(t.alpha(),!0)};L.prototype.brighten=function(n=1){return this.darken(-n)};L.prototype.darker=L.prototype.darken;L.prototype.brighter=L.prototype.brighten;L.prototype.get=function(n){const[t,e]=n.split("."),r=this[t]();if(e){const s=t.indexOf(e)-(t.substr(0,2)==="ok"?2:0);if(s>-1)return r[s];throw new Error(`unknown channel ${e} in mode ${t}`)}else return r};const{pow:Fp}=Math,Op=1e-7,Up=20;L.prototype.luminance=function(n,t="rgb"){if(n!==void 0&&nt(n)==="number"){if(n===0)return new L([0,0,0,this._rgb[3]],"rgb");if(n===1)return new L([255,255,255,this._rgb[3]],"rgb");let e=this.luminance(),r=Up;const s=(a,l)=>{const u=a.interpolate(l,.5,t),d=u.luminance();return Math.abs(n-d)<Op||!r--?u:d>n?s(a,u):s(u,l)},o=(e>n?s(new L([0,0,0]),this):s(this,new L([255,255,255]))).rgb();return new L([...o,this._rgb[3]])}return $p(...this._rgb.slice(0,3))};const $p=(n,t,e)=>(n=fi(n),t=fi(t),e=fi(e),.2126*n+.7152*t+.0722*e),fi=n=>(n/=255,n<=.03928?n/12.92:Fp((n+.055)/1.055,2.4)),jt={},En=(n,t,e=.5,...r)=>{let s=r[0]||"lrgb";if(!jt[s]&&!r.length&&(s=Object.keys(jt)[0]),!jt[s])throw new Error(`interpolation mode ${s} is not defined`);return nt(n)!=="object"&&(n=new L(n)),nt(t)!=="object"&&(t=new L(t)),jt[s](n,t,e).alpha(n.alpha()+e*(t.alpha()-n.alpha()))};L.prototype.mix=L.prototype.interpolate=function(n,t=.5,...e){return En(this,n,t,...e)};L.prototype.premultiply=function(n=!1){const t=this._rgb,e=t[3];return n?(this._rgb=[t[0]*e,t[1]*e,t[2]*e,e],this):new L([t[0]*e,t[1]*e,t[2]*e,e],"rgb")};const{sin:qp,cos:Bp}=Math,dh=(...n)=>{let[t,e,r]=tt(n,"lch");return isNaN(r)&&(r=0),r=r*Pp,[t,Bp(r)*e,qp(r)*e]},jo=(...n)=>{n=tt(n,"lch");const[t,e,r]=n,[s,o,a]=dh(t,e,r),[l,u,d]=Lo(s,o,a);return[l,u,d,n.length>3?n[3]:1]},zp=(...n)=>{const t=ah(tt(n,"hcl"));return jo(...t)},{sqrt:Gp,atan2:Kp,round:Wp}=Math,fh=(...n)=>{const[t,e,r]=tt(n,"lab"),s=Gp(e*e+r*r);let o=(Kp(r,e)*Sp+360)%360;return Wp(s*1e4)===0&&(o=Number.NaN),[t,s,o]},Fo=(...n)=>{const[t,e,r,...s]=tt(n,"rgb"),[o,a,l]=Mo(t,e,r),[u,d,f]=fh(o,a,l);return[u,d,f,...s.length>0&&s[0]<1?[s[0]]:[]]};L.prototype.lch=function(){return Fo(this._rgb)};L.prototype.hcl=function(){return ah(Fo(this._rgb))};const Qp=(...n)=>new L(...n,"lch"),Hp=(...n)=>new L(...n,"hcl");Object.assign(W,{lch:Qp,hcl:Hp});Y.format.lch=jo;Y.format.hcl=zp;["lch","hcl"].forEach(n=>Y.autodetect.push({p:2,test:(...t)=>{if(t=tt(t,n),nt(t)==="array"&&t.length===3)return n}}));L.prototype.saturate=function(n=1){const t=this,e=t.lch();return e[1]+=de.Kn*n,e[1]<0&&(e[1]=0),new L(e,"lch").alpha(t.alpha(),!0)};L.prototype.desaturate=function(n=1){return this.saturate(-n)};L.prototype.set=function(n,t,e=!1){const[r,s]=n.split("."),o=this[r]();if(s){const a=r.indexOf(s)-(r.substr(0,2)==="ok"?2:0);if(a>-1){if(nt(t)=="string")switch(t.charAt(0)){case"+":o[a]+=+t;break;case"-":o[a]+=+t;break;case"*":o[a]*=+t.substr(1);break;case"/":o[a]/=+t.substr(1);break;default:o[a]=+t}else if(nt(t)==="number")o[a]=t;else throw new Error("unsupported value for Color.set");const l=new L(o,r);return e?(this._rgb=l._rgb,this):l}throw new Error(`unknown channel ${s} in mode ${r}`)}else return o};L.prototype.tint=function(n=.5,...t){return En(this,"white",n,...t)};L.prototype.shade=function(n=.5,...t){return En(this,"black",n,...t)};const Xp=(n,t,e)=>{const r=n._rgb,s=t._rgb;return new L(r[0]+e*(s[0]-r[0]),r[1]+e*(s[1]-r[1]),r[2]+e*(s[2]-r[2]),"rgb")};jt.rgb=Xp;const{sqrt:mi,pow:an}=Math,Yp=(n,t,e)=>{const[r,s,o]=n._rgb,[a,l,u]=t._rgb;return new L(mi(an(r,2)*(1-e)+an(a,2)*e),mi(an(s,2)*(1-e)+an(l,2)*e),mi(an(o,2)*(1-e)+an(u,2)*e),"rgb")};jt.lrgb=Yp;const Jp=(n,t,e)=>{const r=n.lab(),s=t.lab();return new L(r[0]+e*(s[0]-r[0]),r[1]+e*(s[1]-r[1]),r[2]+e*(s[2]-r[2]),"lab")};jt.lab=Jp;const Sn=(n,t,e,r)=>{let s,o;r==="hsl"?(s=n.hsl(),o=t.hsl()):r==="hsv"?(s=n.hsv(),o=t.hsv()):r==="hcg"?(s=n.hcg(),o=t.hcg()):r==="hsi"?(s=n.hsi(),o=t.hsi()):r==="lch"||r==="hcl"?(r="hcl",s=n.hcl(),o=t.hcl()):r==="oklch"&&(s=n.oklch().reverse(),o=t.oklch().reverse());let a,l,u,d,f,_;(r.substr(0,1)==="h"||r==="oklch")&&([a,u,f]=s,[l,d,_]=o);let v,I,C,S;return!isNaN(a)&&!isNaN(l)?(l>a&&l-a>180?S=l-(a+360):l<a&&a-l>180?S=l+360-a:S=l-a,I=a+e*S):isNaN(a)?isNaN(l)?I=Number.NaN:(I=l,(f==1||f==0)&&r!="hsv"&&(v=d)):(I=a,(_==1||_==0)&&r!="hsv"&&(v=u)),v===void 0&&(v=u+e*(d-u)),C=f+e*(_-f),r==="oklch"?new L([C,v,I],r):new L([I,v,C],r)},mh=(n,t,e)=>Sn(n,t,e,"lch");jt.lch=mh;jt.hcl=mh;const Zp=n=>{if(nt(n)=="number"&&n>=0&&n<=16777215){const t=n>>16,e=n>>8&255,r=n&255;return[t,e,r,1]}throw new Error("unknown num color: "+n)},t0=(...n)=>{const[t,e,r]=tt(n,"rgb");return(t<<16)+(e<<8)+r};L.prototype.num=function(){return t0(this._rgb)};const e0=(...n)=>new L(...n,"num");Object.assign(W,{num:e0});Y.format.num=Zp;Y.autodetect.push({p:5,test:(...n)=>{if(n.length===1&&nt(n[0])==="number"&&n[0]>=0&&n[0]<=16777215)return"num"}});const n0=(n,t,e)=>{const r=n.num(),s=t.num();return new L(r+e*(s-r),"num")};jt.num=n0;const{floor:r0}=Math,s0=(...n)=>{n=tt(n,"hcg");let[t,e,r]=n,s,o,a;r=r*255;const l=e*255;if(e===0)s=o=a=r;else{t===360&&(t=0),t>360&&(t-=360),t<0&&(t+=360),t/=60;const u=r0(t),d=t-u,f=r*(1-e),_=f+l*(1-d),v=f+l*d,I=f+l;switch(u){case 0:[s,o,a]=[I,v,f];break;case 1:[s,o,a]=[_,I,f];break;case 2:[s,o,a]=[f,I,v];break;case 3:[s,o,a]=[f,_,I];break;case 4:[s,o,a]=[v,f,I];break;case 5:[s,o,a]=[I,f,_];break}}return[s,o,a,n.length>3?n[3]:1]},i0=(...n)=>{const[t,e,r]=tt(n,"rgb"),s=ih(t,e,r),o=oh(t,e,r),a=o-s,l=a*100/255,u=s/(255-a)*100;let d;return a===0?d=Number.NaN:(t===o&&(d=(e-r)/a),e===o&&(d=2+(r-t)/a),r===o&&(d=4+(t-e)/a),d*=60,d<0&&(d+=360)),[d,l,u]};L.prototype.hcg=function(){return i0(this._rgb)};const o0=(...n)=>new L(...n,"hcg");W.hcg=o0;Y.format.hcg=s0;Y.autodetect.push({p:1,test:(...n)=>{if(n=tt(n,"hcg"),nt(n)==="array"&&n.length===3)return"hcg"}});const a0=(n,t,e)=>Sn(n,t,e,"hcg");jt.hcg=a0;const{cos:ln}=Math,l0=(...n)=>{n=tt(n,"hsi");let[t,e,r]=n,s,o,a;return isNaN(t)&&(t=0),isNaN(e)&&(e=0),t>360&&(t-=360),t<0&&(t+=360),t/=360,t<1/3?(a=(1-e)/3,s=(1+e*ln(be*t)/ln(ui-be*t))/3,o=1-(a+s)):t<2/3?(t-=1/3,s=(1-e)/3,o=(1+e*ln(be*t)/ln(ui-be*t))/3,a=1-(s+o)):(t-=2/3,o=(1-e)/3,a=(1+e*ln(be*t)/ln(ui-be*t))/3,s=1-(o+a)),s=Ye(r*s*3),o=Ye(r*o*3),a=Ye(r*a*3),[s*255,o*255,a*255,n.length>3?n[3]:1]},{min:c0,sqrt:u0,acos:h0}=Math,d0=(...n)=>{let[t,e,r]=tt(n,"rgb");t/=255,e/=255,r/=255;let s;const o=c0(t,e,r),a=(t+e+r)/3,l=a>0?1-o/a:0;return l===0?s=NaN:(s=(t-e+(t-r))/2,s/=u0((t-e)*(t-e)+(t-r)*(e-r)),s=h0(s),r>e&&(s=be-s),s/=be),[s*360,l,a]};L.prototype.hsi=function(){return d0(this._rgb)};const f0=(...n)=>new L(...n,"hsi");W.hsi=f0;Y.format.hsi=l0;Y.autodetect.push({p:2,test:(...n)=>{if(n=tt(n,"hsi"),nt(n)==="array"&&n.length===3)return"hsi"}});const m0=(n,t,e)=>Sn(n,t,e,"hsi");jt.hsi=m0;const qi=(...n)=>{n=tt(n,"hsl");const[t,e,r]=n;let s,o,a;if(e===0)s=o=a=r*255;else{const l=[0,0,0],u=[0,0,0],d=r<.5?r*(1+e):r+e-r*e,f=2*r-d,_=t/360;l[0]=_+1/3,l[1]=_,l[2]=_-1/3;for(let v=0;v<3;v++)l[v]<0&&(l[v]+=1),l[v]>1&&(l[v]-=1),6*l[v]<1?u[v]=f+(d-f)*6*l[v]:2*l[v]<1?u[v]=d:3*l[v]<2?u[v]=f+(d-f)*(2/3-l[v])*6:u[v]=f;[s,o,a]=[u[0]*255,u[1]*255,u[2]*255]}return n.length>3?[s,o,a,n[3]]:[s,o,a,1]},gh=(...n)=>{n=tt(n,"rgba");let[t,e,r]=n;t/=255,e/=255,r/=255;const s=ih(t,e,r),o=oh(t,e,r),a=(o+s)/2;let l,u;return o===s?(l=0,u=Number.NaN):l=a<.5?(o-s)/(o+s):(o-s)/(2-o-s),t==o?u=(e-r)/(o-s):e==o?u=2+(r-t)/(o-s):r==o&&(u=4+(t-e)/(o-s)),u*=60,u<0&&(u+=360),n.length>3&&n[3]!==void 0?[u,l,a,n[3]]:[u,l,a]};L.prototype.hsl=function(){return gh(this._rgb)};const g0=(...n)=>new L(...n,"hsl");W.hsl=g0;Y.format.hsl=qi;Y.autodetect.push({p:2,test:(...n)=>{if(n=tt(n,"hsl"),nt(n)==="array"&&n.length===3)return"hsl"}});const p0=(n,t,e)=>Sn(n,t,e,"hsl");jt.hsl=p0;const{floor:y0}=Math,_0=(...n)=>{n=tt(n,"hsv");let[t,e,r]=n,s,o,a;if(r*=255,e===0)s=o=a=r;else{t===360&&(t=0),t>360&&(t-=360),t<0&&(t+=360),t/=60;const l=y0(t),u=t-l,d=r*(1-e),f=r*(1-e*u),_=r*(1-e*(1-u));switch(l){case 0:[s,o,a]=[r,_,d];break;case 1:[s,o,a]=[f,r,d];break;case 2:[s,o,a]=[d,r,_];break;case 3:[s,o,a]=[d,f,r];break;case 4:[s,o,a]=[_,d,r];break;case 5:[s,o,a]=[r,d,f];break}}return[s,o,a,n.length>3?n[3]:1]},{min:b0,max:v0}=Math,w0=(...n)=>{n=tt(n,"rgb");let[t,e,r]=n;const s=b0(t,e,r),o=v0(t,e,r),a=o-s;let l,u,d;return d=o/255,o===0?(l=Number.NaN,u=0):(u=a/o,t===o&&(l=(e-r)/a),e===o&&(l=2+(r-t)/a),r===o&&(l=4+(t-e)/a),l*=60,l<0&&(l+=360)),[l,u,d]};L.prototype.hsv=function(){return w0(this._rgb)};const T0=(...n)=>new L(...n,"hsv");W.hsv=T0;Y.format.hsv=_0;Y.autodetect.push({p:2,test:(...n)=>{if(n=tt(n,"hsv"),nt(n)==="array"&&n.length===3)return"hsv"}});const E0=(n,t,e)=>Sn(n,t,e,"hsv");jt.hsv=E0;function ps(n,t){let e=n.length;Array.isArray(n[0])||(n=[n]),Array.isArray(t[0])||(t=t.map(a=>[a]));let r=t[0].length,s=t[0].map((a,l)=>t.map(u=>u[l])),o=n.map(a=>s.map(l=>Array.isArray(a)?a.reduce((u,d,f)=>u+d*(l[f]||0),0):l.reduce((u,d)=>u+d*a,0)));return e===1&&(o=o[0]),r===1?o.map(a=>a[0]):o}const Oo=(...n)=>{n=tt(n,"lab");const[t,e,r,...s]=n,[o,a,l]=A0([t,e,r]),[u,d,f]=uh(o,a,l);return[u,d,f,...s.length>0&&s[0]<1?[s[0]]:[]]};function A0(n){var t=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],e=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],r=ps(e,n);return ps(t,r.map(s=>s**3))}const Uo=(...n)=>{const[t,e,r,...s]=tt(n,"rgb"),o=hh(t,e,r);return[...I0(o),...s.length>0&&s[0]<1?[s[0]]:[]]};function I0(n){const t=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],e=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],r=ps(t,n);return ps(e,r.map(s=>Math.cbrt(s)))}L.prototype.oklab=function(){return Uo(this._rgb)};const x0=(...n)=>new L(...n,"oklab");Object.assign(W,{oklab:x0});Y.format.oklab=Oo;Y.autodetect.push({p:2,test:(...n)=>{if(n=tt(n,"oklab"),nt(n)==="array"&&n.length===3)return"oklab"}});const R0=(n,t,e)=>{const r=n.oklab(),s=t.oklab();return new L(r[0]+e*(s[0]-r[0]),r[1]+e*(s[1]-r[1]),r[2]+e*(s[2]-r[2]),"oklab")};jt.oklab=R0;const C0=(n,t,e)=>Sn(n,t,e,"oklch");jt.oklch=C0;const{pow:gi,sqrt:pi,PI:yi,cos:Xl,sin:Yl,atan2:P0}=Math,S0=(n,t="lrgb",e=null)=>{const r=n.length;e||(e=Array.from(new Array(r)).map(()=>1));const s=r/e.reduce(function(_,v){return _+v});if(e.forEach((_,v)=>{e[v]*=s}),n=n.map(_=>new L(_)),t==="lrgb")return k0(n,e);const o=n.shift(),a=o.get(t),l=[];let u=0,d=0;for(let _=0;_<a.length;_++)if(a[_]=(a[_]||0)*e[0],l.push(isNaN(a[_])?0:e[0]),t.charAt(_)==="h"&&!isNaN(a[_])){const v=a[_]/180*yi;u+=Xl(v)*e[0],d+=Yl(v)*e[0]}let f=o.alpha()*e[0];n.forEach((_,v)=>{const I=_.get(t);f+=_.alpha()*e[v+1];for(let C=0;C<a.length;C++)if(!isNaN(I[C]))if(l[C]+=e[v+1],t.charAt(C)==="h"){const S=I[C]/180*yi;u+=Xl(S)*e[v+1],d+=Yl(S)*e[v+1]}else a[C]+=I[C]*e[v+1]});for(let _=0;_<a.length;_++)if(t.charAt(_)==="h"){let v=P0(d/l[_],u/l[_])/yi*180;for(;v<0;)v+=360;for(;v>=360;)v-=360;a[_]=v}else a[_]=a[_]/l[_];return f/=r,new L(a,t).alpha(f>.99999?1:f,!0)},k0=(n,t)=>{const e=n.length,r=[0,0,0,0];for(let s=0;s<n.length;s++){const o=n[s],a=t[s]/e,l=o._rgb;r[0]+=gi(l[0],2)*a,r[1]+=gi(l[1],2)*a,r[2]+=gi(l[2],2)*a,r[3]+=l[3]*a}return r[0]=pi(r[0]),r[1]=pi(r[1]),r[2]=pi(r[2]),r[3]>.9999999&&(r[3]=1),new L(Do(r))},{pow:V0}=Math;function ys(n){let t="rgb",e=W("#ccc"),r=0,s=[0,1],o=[],a=[0,0],l=!1,u=[],d=!1,f=0,_=1,v=!1,I={},C=!0,S=1;const R=function(y){if(y=y||["#fff","#000"],y&&nt(y)==="string"&&W.brewer&&W.brewer[y.toLowerCase()]&&(y=W.brewer[y.toLowerCase()]),nt(y)==="array"){y.length===1&&(y=[y[0],y[0]]),y=y.slice(0);for(let m=0;m<y.length;m++)y[m]=W(y[m]);o.length=0;for(let m=0;m<y.length;m++)o.push(m/(y.length-1))}return it(),u=y},N=function(y){if(l!=null){const m=l.length-1;let p=0;for(;p<m&&y>=l[p];)p++;return p-1}return 0};let j=y=>y,$=y=>y;const z=function(y,m){let p,b;if(m==null&&(m=!1),isNaN(y)||y===null)return e;m?b=y:l&&l.length>2?b=N(y)/(l.length-2):_!==f?b=(y-f)/(_-f):b=1,b=$(b),m||(b=j(b)),S!==1&&(b=V0(b,S)),b=a[0]+b*(1-a[0]-a[1]),b=Ye(b,0,1);const E=Math.floor(b*1e4);if(C&&I[E])p=I[E];else{if(nt(u)==="array")for(let A=0;A<o.length;A++){const T=o[A];if(b<=T){p=u[A];break}if(b>=T&&A===o.length-1){p=u[A];break}if(b>T&&b<o[A+1]){b=(b-T)/(o[A+1]-T),p=W.interpolate(u[A],u[A+1],b,t);break}}else nt(u)==="function"&&(p=u(b));C&&(I[E]=p)}return p};var it=()=>I={};R(n);const D=function(y){const m=W(z(y));return d&&m[d]?m[d]():m};return D.classes=function(y){if(y!=null){if(nt(y)==="array")l=y,s=[y[0],y[y.length-1]];else{const m=W.analyze(s);y===0?l=[m.min,m.max]:l=W.limits(m,"e",y)}return D}return l},D.domain=function(y){if(!arguments.length)return s;f=y[0],_=y[y.length-1],o=[];const m=u.length;if(y.length===m&&f!==_)for(let p of Array.from(y))o.push((p-f)/(_-f));else{for(let p=0;p<m;p++)o.push(p/(m-1));if(y.length>2){const p=y.map((E,A)=>A/(y.length-1)),b=y.map(E=>(E-f)/(_-f));b.every((E,A)=>p[A]===E)||($=E=>{if(E<=0||E>=1)return E;let A=0;for(;E>=b[A+1];)A++;const T=(E-b[A])/(b[A+1]-b[A]);return p[A]+T*(p[A+1]-p[A])})}}return s=[f,_],D},D.mode=function(y){return arguments.length?(t=y,it(),D):t},D.range=function(y,m){return R(y),D},D.out=function(y){return d=y,D},D.spread=function(y){return arguments.length?(r=y,D):r},D.correctLightness=function(y){return y==null&&(y=!0),v=y,it(),v?j=function(m){const p=z(0,!0).lab()[0],b=z(1,!0).lab()[0],E=p>b;let A=z(m,!0).lab()[0];const T=p+(b-p)*m;let lt=A-T,Ot=0,ge=1,Yt=20;for(;Math.abs(lt)>.01&&Yt-- >0;)(function(){return E&&(lt*=-1),lt<0?(Ot=m,m+=(ge-m)*.5):(ge=m,m+=(Ot-m)*.5),A=z(m,!0).lab()[0],lt=A-T})();return m}:j=m=>m,D},D.padding=function(y){return y!=null?(nt(y)==="number"&&(y=[y,y]),a=y,D):a},D.colors=function(y,m){arguments.length<2&&(m="hex");let p=[];if(arguments.length===0)p=u.slice(0);else if(y===1)p=[D(.5)];else if(y>1){const b=s[0],E=s[1]-b;p=N0(0,y).map(A=>D(b+A/(y-1)*E))}else{n=[];let b=[];if(l&&l.length>2)for(let E=1,A=l.length,T=1<=A;T?E<A:E>A;T?E++:E--)b.push((l[E-1]+l[E])*.5);else b=s;p=b.map(E=>D(E))}return W[m]&&(p=p.map(b=>b[m]())),p},D.cache=function(y){return y!=null?(C=y,D):C},D.gamma=function(y){return y!=null?(S=y,D):S},D.nodata=function(y){return y!=null?(e=W(y),D):e},D}function N0(n,t,e){let r=[],s=n<t,o=t;for(let a=n;s?a<o:a>o;s?a++:a--)r.push(a);return r}const D0=function(n){let t=[1,1];for(let e=1;e<n;e++){let r=[1];for(let s=1;s<=t.length;s++)r[s]=(t[s]||0)+t[s-1];t=r}return t},L0=function(n){let t,e,r,s;if(n=n.map(o=>new L(o)),n.length===2)[e,r]=n.map(o=>o.lab()),t=function(o){const a=[0,1,2].map(l=>e[l]+o*(r[l]-e[l]));return new L(a,"lab")};else if(n.length===3)[e,r,s]=n.map(o=>o.lab()),t=function(o){const a=[0,1,2].map(l=>(1-o)*(1-o)*e[l]+2*(1-o)*o*r[l]+o*o*s[l]);return new L(a,"lab")};else if(n.length===4){let o;[e,r,s,o]=n.map(a=>a.lab()),t=function(a){const l=[0,1,2].map(u=>(1-a)*(1-a)*(1-a)*e[u]+3*(1-a)*(1-a)*a*r[u]+3*(1-a)*a*a*s[u]+a*a*a*o[u]);return new L(l,"lab")}}else if(n.length>=5){let o,a,l;o=n.map(u=>u.lab()),l=n.length-1,a=D0(l),t=function(u){const d=1-u,f=[0,1,2].map(_=>o.reduce((v,I,C)=>v+a[C]*d**(l-C)*u**C*I[_],0));return new L(f,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return t},M0=n=>{const t=L0(n);return t.scale=()=>ys(t),t},{round:ph}=Math;L.prototype.rgb=function(n=!0){return n===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(ph)};L.prototype.rgba=function(n=!0){return this._rgb.slice(0,4).map((t,e)=>e<3?n===!1?t:ph(t):t)};const j0=(...n)=>new L(...n,"rgb");Object.assign(W,{rgb:j0});Y.format.rgb=(...n)=>{const t=tt(n,"rgba");return t[3]===void 0&&(t[3]=1),t};Y.autodetect.push({p:3,test:(...n)=>{if(n=tt(n,"rgba"),nt(n)==="array"&&(n.length===3||n.length===4&&nt(n[3])=="number"&&n[3]>=0&&n[3]<=1))return"rgb"}});const oe=(n,t,e)=>{if(!oe[e])throw new Error("unknown blend mode "+e);return oe[e](n,t)},Be=n=>(t,e)=>{const r=W(e).rgb(),s=W(t).rgb();return W.rgb(n(r,s))},ze=n=>(t,e)=>{const r=[];return r[0]=n(t[0],e[0]),r[1]=n(t[1],e[1]),r[2]=n(t[2],e[2]),r},F0=n=>n,O0=(n,t)=>n*t/255,U0=(n,t)=>n>t?t:n,$0=(n,t)=>n>t?n:t,q0=(n,t)=>255*(1-(1-n/255)*(1-t/255)),B0=(n,t)=>t<128?2*n*t/255:255*(1-2*(1-n/255)*(1-t/255)),z0=(n,t)=>255*(1-(1-t/255)/(n/255)),G0=(n,t)=>n===255?255:(n=255*(t/255)/(1-n/255),n>255?255:n);oe.normal=Be(ze(F0));oe.multiply=Be(ze(O0));oe.screen=Be(ze(q0));oe.overlay=Be(ze(B0));oe.darken=Be(ze(U0));oe.lighten=Be(ze($0));oe.dodge=Be(ze(G0));oe.burn=Be(ze(z0));const{pow:K0,sin:W0,cos:Q0}=Math;function H0(n=300,t=-1.5,e=1,r=1,s=[0,1]){let o=0,a;nt(s)==="array"?a=s[1]-s[0]:(a=0,s=[s,s]);const l=function(u){const d=be*((n+120)/360+t*u),f=K0(s[0]+a*u,r),v=(o!==0?e[0]+u*o:e)*f*(1-f)/2,I=Q0(d),C=W0(d),S=f+v*(-.14861*I+1.78277*C),R=f+v*(-.29227*I-.90649*C),N=f+v*(1.97294*I);return W(Do([S*255,R*255,N*255,1]))};return l.start=function(u){return u==null?n:(n=u,l)},l.rotations=function(u){return u==null?t:(t=u,l)},l.gamma=function(u){return u==null?r:(r=u,l)},l.hue=function(u){return u==null?e:(e=u,nt(e)==="array"?(o=e[1]-e[0],o===0&&(e=e[1])):o=0,l)},l.lightness=function(u){return u==null?s:(nt(u)==="array"?(s=u,a=u[1]-u[0]):(s=[u,u],a=0),l)},l.scale=()=>W.scale(l),l.hue(e),l}const X0="0123456789abcdef",{floor:Y0,random:J0}=Math,Z0=()=>{let n="#";for(let t=0;t<6;t++)n+=X0.charAt(Y0(J0()*16));return new L(n,"hex")},{log:Jl,pow:ty,floor:ey,abs:ny}=Math;function yh(n,t=null){const e={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return nt(n)==="object"&&(n=Object.values(n)),n.forEach(r=>{t&&nt(r)==="object"&&(r=r[t]),r!=null&&!isNaN(r)&&(e.values.push(r),e.sum+=r,r<e.min&&(e.min=r),r>e.max&&(e.max=r),e.count+=1)}),e.domain=[e.min,e.max],e.limits=(r,s)=>_h(e,r,s),e}function _h(n,t="equal",e=7){nt(n)=="array"&&(n=yh(n));const{min:r,max:s}=n,o=n.values.sort((l,u)=>l-u);if(e===1)return[r,s];const a=[];if(t.substr(0,1)==="c"&&(a.push(r),a.push(s)),t.substr(0,1)==="e"){a.push(r);for(let l=1;l<e;l++)a.push(r+l/e*(s-r));a.push(s)}else if(t.substr(0,1)==="l"){if(r<=0)throw new Error("Logarithmic scales are only possible for values > 0");const l=Math.LOG10E*Jl(r),u=Math.LOG10E*Jl(s);a.push(r);for(let d=1;d<e;d++)a.push(ty(10,l+d/e*(u-l)));a.push(s)}else if(t.substr(0,1)==="q"){a.push(r);for(let l=1;l<e;l++){const u=(o.length-1)*l/e,d=ey(u);if(d===u)a.push(o[d]);else{const f=u-d;a.push(o[d]*(1-f)+o[d+1]*f)}}a.push(s)}else if(t.substr(0,1)==="k"){let l;const u=o.length,d=new Array(u),f=new Array(e);let _=!0,v=0,I=null;I=[],I.push(r);for(let R=1;R<e;R++)I.push(r+R/e*(s-r));for(I.push(s);_;){for(let N=0;N<e;N++)f[N]=0;for(let N=0;N<u;N++){const j=o[N];let $=Number.MAX_VALUE,z;for(let it=0;it<e;it++){const D=ny(I[it]-j);D<$&&($=D,z=it),f[z]++,d[N]=z}}const R=new Array(e);for(let N=0;N<e;N++)R[N]=null;for(let N=0;N<u;N++)l=d[N],R[l]===null?R[l]=o[N]:R[l]+=o[N];for(let N=0;N<e;N++)R[N]*=1/f[N];_=!1;for(let N=0;N<e;N++)if(R[N]!==I[N]){_=!0;break}I=R,v++,v>200&&(_=!1)}const C={};for(let R=0;R<e;R++)C[R]=[];for(let R=0;R<u;R++)l=d[R],C[l].push(o[R]);let S=[];for(let R=0;R<e;R++)S.push(C[R][0]),S.push(C[R][C[R].length-1]);S=S.sort((R,N)=>R-N),a.push(S[0]);for(let R=1;R<S.length;R+=2){const N=S[R];!isNaN(N)&&a.indexOf(N)===-1&&a.push(N)}}return a}const ry=(n,t)=>{n=new L(n),t=new L(t);const e=n.luminance(),r=t.luminance();return e>r?(e+.05)/(r+.05):(r+.05)/(e+.05)};/**
 * @license
 *
 * The APCA contrast prediction algorithm is based of the formulas published
 * in the APCA-1.0.98G specification by Myndex. The specification is available at:
 * https://raw.githubusercontent.com/Myndex/apca-w3/master/images/APCAw3_0.1.17_APCA0.0.98G.svg
 *
 * Note that the APCA implementation is still beta, so please update to
 * future versions of chroma.js when they become available.
 *
 * You can read more about the APCA Readability Criterion at
 * https://readtech.org/ARC/
 */const Zl=.027,sy=5e-4,iy=.1,tc=1.14,Wr=.022,ec=1.414,oy=(n,t)=>{n=new L(n),t=new L(t),n.alpha()<1&&(n=En(t,n,n.alpha(),"rgb"));const e=nc(...n.rgb()),r=nc(...t.rgb()),s=e>=Wr?e:e+Math.pow(Wr-e,ec),o=r>=Wr?r:r+Math.pow(Wr-r,ec),a=Math.pow(o,.56)-Math.pow(s,.57),l=Math.pow(o,.65)-Math.pow(s,.62),u=Math.abs(o-s)<sy?0:s<o?a*tc:l*tc;return(Math.abs(u)<iy?0:u>0?u-Zl:u+Zl)*100};function nc(n,t,e){return .2126729*Math.pow(n/255,2.4)+.7151522*Math.pow(t/255,2.4)+.072175*Math.pow(e/255,2.4)}const{sqrt:_e,pow:yt,min:ay,max:ly,atan2:rc,abs:sc,cos:Qr,sin:ic,exp:cy,PI:oc}=Math;function uy(n,t,e=1,r=1,s=1){var o=function(q){return 360*q/(2*oc)},a=function(q){return 2*oc*q/360};n=new L(n),t=new L(t);const[l,u,d]=Array.from(n.lab()),[f,_,v]=Array.from(t.lab()),I=(l+f)/2,C=_e(yt(u,2)+yt(d,2)),S=_e(yt(_,2)+yt(v,2)),R=(C+S)/2,N=.5*(1-_e(yt(R,7)/(yt(R,7)+yt(25,7)))),j=u*(1+N),$=_*(1+N),z=_e(yt(j,2)+yt(d,2)),it=_e(yt($,2)+yt(v,2)),D=(z+it)/2,y=o(rc(d,j)),m=o(rc(v,$)),p=y>=0?y:y+360,b=m>=0?m:m+360,E=sc(p-b)>180?(p+b+360)/2:(p+b)/2,A=1-.17*Qr(a(E-30))+.24*Qr(a(2*E))+.32*Qr(a(3*E+6))-.2*Qr(a(4*E-63));let T=b-p;T=sc(T)<=180?T:b<=p?T+360:T-360,T=2*_e(z*it)*ic(a(T)/2);const lt=f-l,Ot=it-z,ge=1+.015*yt(I-50,2)/_e(20+yt(I-50,2)),Yt=1+.045*D,Wt=1+.015*D*A,Ge=30*cy(-yt((E-275)/25,2)),Dn=-(2*_e(yt(D,7)/(yt(D,7)+yt(25,7))))*ic(2*a(Ge)),Jt=_e(yt(lt/(e*ge),2)+yt(Ot/(r*Yt),2)+yt(T/(s*Wt),2)+Dn*(Ot/(r*Yt))*(T/(s*Wt)));return ly(0,ay(100,Jt))}function hy(n,t,e="lab"){n=new L(n),t=new L(t);const r=n.get(e),s=t.get(e);let o=0;for(let a in r){const l=(r[a]||0)-(s[a]||0);o+=l*l}return Math.sqrt(o)}const dy=(...n)=>{try{return new L(...n),!0}catch{return!1}},fy={cool(){return ys([W.hsl(180,1,.9),W.hsl(250,.7,.4)])},hot(){return ys(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Bi={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},bh=Object.keys(Bi),ac=new Map(bh.map(n=>[n.toLowerCase(),n])),my=typeof Proxy=="function"?new Proxy(Bi,{get(n,t){const e=t.toLowerCase();if(ac.has(e))return n[ac.get(e)]},getOwnPropertyNames(){return Object.getOwnPropertyNames(bh)}}):Bi,gy=(...n)=>{n=tt(n,"cmyk");const[t,e,r,s]=n,o=n.length>4?n[4]:1;return s===1?[0,0,0,o]:[t>=1?0:255*(1-t)*(1-s),e>=1?0:255*(1-e)*(1-s),r>=1?0:255*(1-r)*(1-s),o]},{max:lc}=Math,py=(...n)=>{let[t,e,r]=tt(n,"rgb");t=t/255,e=e/255,r=r/255;const s=1-lc(t,lc(e,r)),o=s<1?1/(1-s):0,a=(1-t-s)*o,l=(1-e-s)*o,u=(1-r-s)*o;return[a,l,u,s]};L.prototype.cmyk=function(){return py(this._rgb)};const yy=(...n)=>new L(...n,"cmyk");Object.assign(W,{cmyk:yy});Y.format.cmyk=gy;Y.autodetect.push({p:2,test:(...n)=>{if(n=tt(n,"cmyk"),nt(n)==="array"&&n.length===4)return"cmyk"}});const _y=(...n)=>{const t=tt(n,"hsla");let e=Pn(n)||"lsa";return t[0]=Zt(t[0]||0)+"deg",t[1]=Zt(t[1]*100)+"%",t[2]=Zt(t[2]*100)+"%",e==="hsla"||t.length>3&&t[3]<1?(t[3]="/ "+(t.length>3?t[3]:1),e="hsla"):t.length=3,`${e.substr(0,3)}(${t.join(" ")})`},by=(...n)=>{const t=tt(n,"lab");let e=Pn(n)||"lab";return t[0]=Zt(t[0])+"%",t[1]=Zt(t[1]),t[2]=Zt(t[2]),e==="laba"||t.length>3&&t[3]<1?t[3]="/ "+(t.length>3?t[3]:1):t.length=3,`lab(${t.join(" ")})`},vy=(...n)=>{const t=tt(n,"lch");let e=Pn(n)||"lab";return t[0]=Zt(t[0])+"%",t[1]=Zt(t[1]),t[2]=isNaN(t[2])?"none":Zt(t[2])+"deg",e==="lcha"||t.length>3&&t[3]<1?t[3]="/ "+(t.length>3?t[3]:1):t.length=3,`lch(${t.join(" ")})`},wy=(...n)=>{const t=tt(n,"lab");return t[0]=Zt(t[0]*100)+"%",t[1]=$i(t[1]),t[2]=$i(t[2]),t.length>3&&t[3]<1?t[3]="/ "+(t.length>3?t[3]:1):t.length=3,`oklab(${t.join(" ")})`},vh=(...n)=>{const[t,e,r,...s]=tt(n,"rgb"),[o,a,l]=Uo(t,e,r),[u,d,f]=fh(o,a,l);return[u,d,f,...s.length>0&&s[0]<1?[s[0]]:[]]},Ty=(...n)=>{const t=tt(n,"lch");return t[0]=Zt(t[0]*100)+"%",t[1]=$i(t[1]),t[2]=isNaN(t[2])?"none":Zt(t[2])+"deg",t.length>3&&t[3]<1?t[3]="/ "+(t.length>3?t[3]:1):t.length=3,`oklch(${t.join(" ")})`},{round:_i}=Math,Ey=(...n)=>{const t=tt(n,"rgba");let e=Pn(n)||"rgb";if(e.substr(0,3)==="hsl")return _y(gh(t),e);if(e.substr(0,3)==="lab"){const r=fr();we("d50");const s=by(Mo(t),e);return we(r),s}if(e.substr(0,3)==="lch"){const r=fr();we("d50");const s=vy(Fo(t),e);return we(r),s}return e.substr(0,5)==="oklab"?wy(Uo(t)):e.substr(0,5)==="oklch"?Ty(vh(t)):(t[0]=_i(t[0]),t[1]=_i(t[1]),t[2]=_i(t[2]),(e==="rgba"||t.length>3&&t[3]<1)&&(t[3]="/ "+(t.length>3?t[3]:1),e="rgba"),`${e.substr(0,3)}(${t.slice(0,e==="rgb"?3:4).join(" ")})`)},wh=(...n)=>{n=tt(n,"lch");const[t,e,r,...s]=n,[o,a,l]=dh(t,e,r),[u,d,f]=Oo(o,a,l);return[u,d,f,...s.length>0&&s[0]<1?[s[0]]:[]]},Ee=/((?:-?\d+)|(?:-?\d+(?:\.\d+)?)%|none)/.source,se=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%?)|none)/.source,_s=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%)|none)/.source,ee=/\s*/.source,kn=/\s+/.source,$o=/\s*,\s*/.source,Ms=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)(?:deg)?)|none)/.source,Vn=/\s*(?:\/\s*((?:[01]|[01]?\.\d+)|\d+(?:\.\d+)?%))?/.source,Th=new RegExp("^rgba?\\("+ee+[Ee,Ee,Ee].join(kn)+Vn+"\\)$"),Eh=new RegExp("^rgb\\("+ee+[Ee,Ee,Ee].join($o)+ee+"\\)$"),Ah=new RegExp("^rgba\\("+ee+[Ee,Ee,Ee,se].join($o)+ee+"\\)$"),Ih=new RegExp("^hsla?\\("+ee+[Ms,_s,_s].join(kn)+Vn+"\\)$"),xh=new RegExp("^hsl?\\("+ee+[Ms,_s,_s].join($o)+ee+"\\)$"),Rh=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Ch=new RegExp("^lab\\("+ee+[se,se,se].join(kn)+Vn+"\\)$"),Ph=new RegExp("^lch\\("+ee+[se,se,Ms].join(kn)+Vn+"\\)$"),Sh=new RegExp("^oklab\\("+ee+[se,se,se].join(kn)+Vn+"\\)$"),kh=new RegExp("^oklch\\("+ee+[se,se,Ms].join(kn)+Vn+"\\)$"),{round:Vh}=Math,cn=n=>n.map((t,e)=>e<=2?Ye(Vh(t),0,255):t),_t=(n,t=0,e=100,r=!1)=>(typeof n=="string"&&n.endsWith("%")&&(n=parseFloat(n.substring(0,n.length-1))/100,r?n=t+(n+1)*.5*(e-t):n=t+n*(e-t)),+n),qt=(n,t)=>n==="none"?t:n,qo=n=>{if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];let t;if(Y.format.named)try{return Y.format.named(n)}catch{}if((t=n.match(Th))||(t=n.match(Eh))){let e=t.slice(1,4);for(let s=0;s<3;s++)e[s]=+_t(qt(e[s],0),0,255);e=cn(e);const r=t[4]!==void 0?+_t(t[4],0,1):1;return e[3]=r,e}if(t=n.match(Ah)){const e=t.slice(1,5);for(let r=0;r<4;r++)e[r]=+_t(e[r],0,255);return e}if((t=n.match(Ih))||(t=n.match(xh))){const e=t.slice(1,4);e[0]=+qt(e[0].replace("deg",""),0),e[1]=+_t(qt(e[1],0),0,100)*.01,e[2]=+_t(qt(e[2],0),0,100)*.01;const r=cn(qi(e)),s=t[4]!==void 0?+_t(t[4],0,1):1;return r[3]=s,r}if(t=n.match(Rh)){const e=t.slice(1,4);e[1]*=.01,e[2]*=.01;const r=qi(e);for(let s=0;s<3;s++)r[s]=Vh(r[s]);return r[3]=+t[4],r}if(t=n.match(Ch)){const e=t.slice(1,4);e[0]=_t(qt(e[0],0),0,100),e[1]=_t(qt(e[1],0),-125,125,!0),e[2]=_t(qt(e[2],0),-125,125,!0);const r=fr();we("d50");const s=cn(Lo(e));we(r);const o=t[4]!==void 0?+_t(t[4],0,1):1;return s[3]=o,s}if(t=n.match(Ph)){const e=t.slice(1,4);e[0]=_t(e[0],0,100),e[1]=_t(qt(e[1],0),0,150,!1),e[2]=+qt(e[2].replace("deg",""),0);const r=fr();we("d50");const s=cn(jo(e));we(r);const o=t[4]!==void 0?+_t(t[4],0,1):1;return s[3]=o,s}if(t=n.match(Sh)){const e=t.slice(1,4);e[0]=_t(qt(e[0],0),0,1),e[1]=_t(qt(e[1],0),-.4,.4,!0),e[2]=_t(qt(e[2],0),-.4,.4,!0);const r=cn(Oo(e)),s=t[4]!==void 0?+_t(t[4],0,1):1;return r[3]=s,r}if(t=n.match(kh)){const e=t.slice(1,4);e[0]=_t(qt(e[0],0),0,1),e[1]=_t(qt(e[1],0),0,.4,!1),e[2]=+qt(e[2].replace("deg",""),0);const r=cn(wh(e)),s=t[4]!==void 0?+_t(t[4],0,1):1;return r[3]=s,r}};qo.test=n=>Th.test(n)||Ih.test(n)||Ch.test(n)||Ph.test(n)||Sh.test(n)||kh.test(n)||Eh.test(n)||Ah.test(n)||xh.test(n)||Rh.test(n)||n==="transparent";L.prototype.css=function(n){return Ey(this._rgb,n)};const Ay=(...n)=>new L(...n,"css");W.css=Ay;Y.format.css=qo;Y.autodetect.push({p:5,test:(n,...t)=>{if(!t.length&&nt(n)==="string"&&qo.test(n))return"css"}});Y.format.gl=(...n)=>{const t=tt(n,"rgba");return t[0]*=255,t[1]*=255,t[2]*=255,t};const Iy=(...n)=>new L(...n,"gl");W.gl=Iy;L.prototype.gl=function(){const n=this._rgb;return[n[0]/255,n[1]/255,n[2]/255,n[3]]};L.prototype.hex=function(n){return ch(this._rgb,n)};const xy=(...n)=>new L(...n,"hex");W.hex=xy;Y.format.hex=lh;Y.autodetect.push({p:4,test:(n,...t)=>{if(!t.length&&nt(n)==="string"&&[3,4,5,6,7,8,9].indexOf(n.length)>=0)return"hex"}});const{log:Hr}=Math,Nh=n=>{const t=n/100;let e,r,s;return t<66?(e=255,r=t<6?0:-155.25485562709179-.44596950469579133*(r=t-2)+104.49216199393888*Hr(r),s=t<20?0:-254.76935184120902+.8274096064007395*(s=t-10)+115.67994401066147*Hr(s)):(e=351.97690566805693+.114206453784165*(e=t-55)-40.25366309332127*Hr(e),r=325.4494125711974+.07943456536662342*(r=t-50)-28.0852963507957*Hr(r),s=255),[e,r,s,1]},{round:Ry}=Math,Cy=(...n)=>{const t=tt(n,"rgb"),e=t[0],r=t[2];let s=1e3,o=4e4;const a=.4;let l;for(;o-s>a;){l=(o+s)*.5;const u=Nh(l);u[2]/u[0]>=r/e?o=l:s=l}return Ry(l)};L.prototype.temp=L.prototype.kelvin=L.prototype.temperature=function(){return Cy(this._rgb)};const bi=(...n)=>new L(...n,"temp");Object.assign(W,{temp:bi,kelvin:bi,temperature:bi});Y.format.temp=Y.format.kelvin=Y.format.temperature=Nh;L.prototype.oklch=function(){return vh(this._rgb)};const Py=(...n)=>new L(...n,"oklch");Object.assign(W,{oklch:Py});Y.format.oklch=wh;Y.autodetect.push({p:2,test:(...n)=>{if(n=tt(n,"oklch"),nt(n)==="array"&&n.length===3)return"oklch"}});Object.assign(W,{analyze:yh,average:S0,bezier:M0,blend:oe,brewer:my,Color:L,colors:Tn,contrast:ry,contrastAPCA:oy,cubehelix:H0,deltaE:uy,distance:hy,input:Y,interpolate:En,limits:_h,mix:En,random:Z0,scale:ys,scales:fy,valid:dy});const K={primaryColor:"#377dc8",secondaryColor:"#0f3257",fontFamily:"'Noto Sans', sans-serif",titleColor:"#d7e3ee",h3TitleColor:"#d7e3ee",textColor:"#c6d3e2",backgroundFromColor:"#111827",backgroundToColor:"#1F2937"},Sy=()=>{const[n,t]=F.useState(K.primaryColor),[e,r]=F.useState(K.secondaryColor),[s,o]=F.useState(K.fontFamily),[a,l]=F.useState(K.titleColor),[u,d]=F.useState(K.h3TitleColor),[f,_]=F.useState(K.textColor),[v,I]=F.useState(K.backgroundFromColor),[C,S]=F.useState(K.backgroundToColor),[R,N]=F.useState(!0),[j,$]=F.useState(!1),[z,it]=F.useState(0),[D,y]=F.useState([]),[m,p]=F.useState(""),[b,E]=F.useState(!0),A=q=>/^#[0-9A-F]{6}$/i.test(q),T=q=>J=>{q(J.target.value)},lt=q=>J=>{const Z=J.target.value;(A(Z)||Z===""||Z==="#")&&q(Z)},Ot=q=>{o(q.target.value)},ge=F.useCallback(async()=>{if(!Q){console.error("Load Data Error: Firestore db instance is not available."),N(!1),E(!1);return}N(!0),E(!0);const q=xt(Q,"settings","styles");try{const Z=await Zu(q);if(Z.exists()){const ht=Z.data();t(ht.primaryColor||K.primaryColor),r(ht.secondaryColor||K.secondaryColor),o(ht.fontFamily||K.fontFamily),l(ht.titleColor||K.titleColor||"#ffffff"),d(ht.h3TitleColor||K.h3TitleColor||"#d7e3ee"),_(ht.textColor||K.textColor||"#c6d3e2"),I(ht.backgroundFromColor??K.backgroundFromColor??"#111827"),S(ht.backgroundToColor??K.backgroundToColor??"#1F2937")}else console.log("No current style document found, using defaults."),Wt()}catch(Z){console.error("Error loading current styles:",Z),alert("Failed to load current styles."),Wt()}finally{N(!1)}const J=ms(Q,"themes");try{const Z=await No(J),ht=[];Z.forEach(ct=>{const Pt=ct.data();Pt.name&&Pt.style?ht.push({id:ct.id,...Pt}):console.warn(`Theme document ${ct.id} has invalid data:`,Pt)}),y(ht.sort((ct,Pt)=>ct.name.localeCompare(Pt.name))),console.log("Loaded themes:",ht)}catch(Z){console.error("Error loading saved themes:",Z),alert("Failed to load saved themes."),y([])}finally{E(!1)}},[Q]);F.useEffect(()=>{ge()},[ge]),F.useEffect(()=>{if(!R){const q=n.match(/^#[0-9A-F]{6}$/i)?n:K.primaryColor,J=e.match(/^#[0-9A-F]{6}$/i)?e:K.secondaryColor,Z=a.match(/^#[0-9A-F]{6}$/i)?a:K.titleColor,ht=u.match(/^#[0-9A-F]{6}$/i)?u:K.h3TitleColor,ct=f.match(/^#[0-9A-F]{6}$/i)?f:K.textColor,Pt=v.match(/^#[0-9A-F]{6}$/i)?v:K.backgroundFromColor,ne=C.match(/^#[0-9A-F]{6}$/i)?C:K.backgroundToColor;document.documentElement.style.setProperty("--primary-color",q),document.documentElement.style.setProperty("--secondary-color",J),document.documentElement.style.setProperty("--font-family",s),document.documentElement.style.setProperty("--title-color",Z),document.documentElement.style.setProperty("--h3title-color",ht),document.documentElement.style.setProperty("--text-color",ct),document.documentElement.style.setProperty("--background-from-color",Pt),document.documentElement.style.setProperty("--background-to-color",ne)}},[n,e,s,a,u,f,v,C,R]);const Yt=async()=>{if(!Q){console.error("Save Error: Firestore db instance is not available."),alert("Error: Cannot save styles. Firestore not available.");return}const q=xt(Q,"settings","styles");if(!q){console.error("Save Error: Failed to create doc reference."),alert("Error: Cannot save styles. Failed to create reference.");return}$(!0);const J={primaryColor:n,secondaryColor:e,fontFamily:s,titleColor:a,h3TitleColor:u,textColor:f,backgroundFromColor:v,backgroundToColor:C};console.log("Attempting to save styles to Firestore:",J);try{await Oi(q,J),console.log("Firestore save successful:",J),alert("Styles saved successfully!")}catch(Z){console.error("Firestore save error:",Z),alert(`Failed to save styles. Error: ${Z instanceof Error?Z.message:String(Z)}`)}finally{console.log("Finished save attempt."),$(!1)}},Wt=()=>{console.log("Resetting styles to default values."),t(K.primaryColor),r(K.secondaryColor),o(K.fontFamily),l(K.titleColor),d(K.h3TitleColor),_(K.textColor),I(K.backgroundFromColor),S(K.backgroundToColor)},Ge=()=>{try{const q=W.valid(n)?W(n):W(K.primaryColor),J=z%3;let Z,ht;switch(J){case 1:Z=q.set("hsl.h","+30").hex(),ht=q.set("hsl.h","-30").hex(),console.log("AI Mode: Analogous");break;case 2:Z=q.set("hsl.h","+120").hex(),ht=q.set("hsl.h","-120").hex(),console.log("AI Mode: Triadic");break;case 0:default:Z=q.set("hsl.h","+180").hex(),ht=q.set("hsl.h","+150").hex(),console.log("AI Mode: Complementary");break}r(Z);let ct=q;J===1?ct=W.mix(q,Z,.5):J===2&&(ct=W.mix(q,ht,.5));const Pt=W("#18181b");let ne=ct.brighten(1.5).hex();W.contrast(ne,Pt)<4.5&&(ne=ct.brighten(2.5).hex()),ne=W.mix(ne,"#ffffff",.1).hex(),l(ne);let ae=ct.brighten(1).hex();W.contrast(ae,Pt)<4.5&&(ae=ct.brighten(2).hex()),ae=W.mix(ae,"#ffffff",.05).hex(),d(ae);let le=ct.brighten(2.5).desaturate(.5).hex();W.contrast(le,Pt)<4.5&&(le=ct.brighten(3.5).desaturate(.2).hex()),le=W.mix(le,"#ffffff",.2).hex(),_(le);const Ln=ct.darken(2.2).desaturate(.5).hex(),Mn=ct.darken(1.8).desaturate(.3).hex();I(Ln),S(Mn)}catch(q){console.error("Error generating AI colors:",q),alert("Failed to generate colors. Please ensure the primary color is valid."),Wt()}finally{it(q=>q+1)}},Nn=q=>{console.log("Applying theme:",q.name);const{style:J}=q;t(J.primaryColor||K.primaryColor),r(J.secondaryColor||K.secondaryColor),o(J.fontFamily||K.fontFamily),l(J.titleColor||K.titleColor||"#ffffff"),d(J.h3TitleColor||K.h3TitleColor||"#d7e3ee"),_(J.textColor||K.textColor||"#c6d3e2"),I(J.backgroundFromColor??K.backgroundFromColor??"#111827"),S(J.backgroundToColor??K.backgroundToColor??"#1F2937")},Dn=async()=>{if(!Q){alert("Error: Firestore not available.");return}if(!m.trim()){alert("Please enter a name for the theme.");return}if(D.some(J=>J.name.toLowerCase()===m.trim().toLowerCase())){alert(`A theme named "${m.trim()}" already exists. Please choose a different name.`);return}const q={primaryColor:n,secondaryColor:e,fontFamily:s,titleColor:a,h3TitleColor:u,textColor:f,backgroundFromColor:v,backgroundToColor:C};$(!0),console.log(`Saving current style as new theme: "${m.trim()}"`);try{const J=ms(Q,"themes"),Z=await eh(J,{name:m.trim(),style:q});console.log("New theme saved with ID:",Z.id);const ht={id:Z.id,name:m.trim(),style:q};y(ct=>[...ct,ht].sort((Pt,ne)=>Pt.name.localeCompare(ne.name))),p(""),alert(`Theme "${ht.name}" saved successfully!`)}catch(J){console.error("Error saving new theme:",J),alert(`Failed to save theme. Error: ${J instanceof Error?J.message:String(J)}`)}finally{$(!1)}},Jt=async(q,J)=>{if(!Q){alert("Error: Firestore not available.");return}if(window.confirm(`Are you sure you want to delete the theme "${J}"? This cannot be undone.`)){$(!0),console.log(`Attempting to delete theme: ${J} (ID: ${q})`);try{const Z=xt(Q,"themes",q);await th(Z),console.log(`Theme "${J}" deleted successfully.`),y(ht=>ht.filter(ct=>ct.id!==q)),alert(`Theme "${J}" deleted.`)}catch(Z){console.error(`Error deleting theme ${J}:`,Z),alert(`Failed to delete theme "${J}". Error: ${Z instanceof Error?Z.message:String(Z)}`)}finally{$(!1)}}};return R||b?w.jsx("div",{children:"Loading styles and themes..."}):w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[" ",w.jsxs("div",{className:"md:col-span-2 space-y-4",children:[" ",w.jsx("h4",{className:"text-lg font-medium mb-4",children:"Style Editor"}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"primaryColorText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Primary Color"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"color",id:"primaryColorPicker",value:n.match(/^#[0-9A-F]{6}$/i)?n:K.primaryColor,onChange:T(t),className:"h-10 w-10 p-1 border border-gray-300 rounded cursor-pointer"}),w.jsx("input",{type:"text",id:"primaryColorText",value:n,onChange:lt(t),className:"flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"#rrggbb",maxLength:7})]})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"secondaryColorText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Secondary Color"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"color",id:"secondaryColorPicker",value:e.match(/^#[0-9A-F]{6}$/i)?e:K.secondaryColor,onChange:T(r),className:"h-10 w-10 p-1 border border-gray-300 rounded cursor-pointer"}),w.jsx("input",{type:"text",id:"secondaryColorText",value:e,onChange:lt(r),className:"flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"#rrggbb",maxLength:7})]})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"fontFamily",className:"block text-sm font-medium text-gray-700 mb-1",children:"Font Family"}),w.jsxs("select",{id:"fontFamily",value:s,onChange:Ot,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[w.jsx("option",{value:"'Noto Sans', sans-serif",children:"'Noto Sans', sans-serif"}),w.jsx("option",{value:"'Arial', sans-serif",children:"'Arial', sans-serif"}),w.jsx("option",{value:"'Verdana', sans-serif",children:"'Verdana', sans-serif"}),w.jsx("option",{value:"'Georgia', serif",children:"'Georgia', serif"}),w.jsx("option",{value:"'Times New Roman', serif",children:"'Times New Roman', serif"}),w.jsx("option",{value:"'Inconsolata', monospace",children:"'Inconsolata', monospace"})]}),w.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Select a font family from the list."})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"titleColorText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title Color (h2)"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"color",id:"titleColorPicker",value:a.match(/^#[0-9A-F]{6}$/i)?a:K.titleColor,onChange:T(l),className:"h-10 w-10 p-1 border border-gray-300 rounded cursor-pointer"}),w.jsx("input",{type:"text",id:"titleColorText",value:a,onChange:lt(l),className:"flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"#rrggbb",maxLength:7})]})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"h3TitleColorText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sub-Title Color (h3)"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"color",id:"h3TitleColorPicker",value:u.match(/^#[0-9A-F]{6}$/i)?u:K.h3TitleColor,onChange:T(d),className:"h-10 w-10 p-1 border border-gray-300 rounded cursor-pointer"}),w.jsx("input",{type:"text",id:"h3TitleColorText",value:u,onChange:lt(d),className:"flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"#rrggbb",maxLength:7})]})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"textColorText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Text Color (p, label)"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"color",id:"textColorPicker",value:f.match(/^#[0-9A-F]{6}$/i)?f:K.textColor,onChange:T(_),className:"h-10 w-10 p-1 border border-gray-300 rounded cursor-pointer"}),w.jsx("input",{type:"text",id:"textColorText",value:f,onChange:lt(_),className:"flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"#rrggbb",maxLength:7})]})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"backgroundFromColorText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Background Gradient From"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"color",id:"backgroundFromColorPicker",value:v.match(/^#[0-9A-F]{6}$/i)?v:K.backgroundFromColor,onChange:T(I),className:"h-10 w-10 p-1 border border-gray-300 rounded cursor-pointer"}),w.jsx("input",{type:"text",id:"backgroundFromColorText",value:v,onChange:lt(I),className:"flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"#rrggbb",maxLength:7})]})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"backgroundToColorText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Background Gradient To"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"color",id:"backgroundToColorPicker",value:C.match(/^#[0-9A-F]{6}$/i)?C:K.backgroundToColor,onChange:T(S),className:"h-10 w-10 p-1 border border-gray-300 rounded cursor-pointer"}),w.jsx("input",{type:"text",id:"backgroundToColorText",value:C,onChange:lt(S),className:"flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"#rrggbb",maxLength:7})]})]}),w.jsxs("div",{className:"p-4 md:p-6 border border-gray-300 text-white rounded-lg shadow-lg",style:{background:`linear-gradient(to bottom right, ${v}, ${C})`},children:[w.jsx("h5",{className:"text-md font-medium mb-3",children:"Preview"}),w.jsxs("div",{style:{fontFamily:s},children:[w.jsx("h1",{style:{color:n},className:"text-3xl text-center font-bold mb-1",children:Mt.en.generalInfo.siteTitle}),w.jsx("p",{style:{color:e},className:"text-xl text-center mb-6",children:Mt.en.generalInfo.siteRole}),w.jsx("h2",{style:{color:a},className:"text-2xl font-bold text-center mb-3",children:Mt.en.services.title}),w.jsx("h3",{style:{color:u},className:"text-lg font-semibold text-center mb-6",children:Mt.en.projects.project1.title}),w.jsx("p",{style:{color:f},className:"text-center mb-12",children:Mt.en.projects.project1.description})]})]}),w.jsxs("div",{className:"pt-4 flex space-x-2",children:[" ",w.jsx("button",{onClick:Yt,disabled:j||R,className:`px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${j||R?"opacity-50 cursor-not-allowed":""}`,children:j?"Saving...":"Save Styles"}),w.jsx("button",{onClick:Wt,disabled:j||R,className:`px-4 py-2 bg-gray-500 text-white font-medium rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 ${j||R?"opacity-50 cursor-not-allowed":""}`,children:"Reset to Defaults"}),w.jsx("button",{onClick:Ge,disabled:j||R||b,className:`px-4 py-2 bg-purple-600 text-white font-medium rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 ${j||R||b?"opacity-50 cursor-not-allowed":""}`,children:"Generate Colors"})]})]})," ",w.jsxs("div",{className:"md:col-span-1 space-y-4",children:[" ",w.jsx("h4",{className:"text-lg font-medium mb-4",children:"Theme History"}),w.jsxs("div",{className:"p-4 border border-gray-200 rounded-md bg-gray-50",children:[w.jsx("label",{htmlFor:"newThemeName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Save Current Style as Theme"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"text",id:"newThemeName",value:m,onChange:q=>p(q.target.value),className:"flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter theme name",disabled:j}),w.jsx("button",{onClick:Dn,disabled:j||!m.trim(),className:`px-3 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 ${j||!m.trim()?"opacity-50 cursor-not-allowed":""}`,children:"Save Theme"})]})]}),w.jsxs("div",{children:[w.jsx("h5",{className:"text-md font-medium mb-2",children:"Saved Themes"}),D.length===0?w.jsx("p",{className:"text-sm text-gray-500",children:"No themes saved yet."}):w.jsx("ul",{className:"space-y-2 max-h-96 overflow-y-auto border border-gray-200 rounded-md p-2 bg-white",children:D.map(q=>w.jsxs("li",{className:"flex items-center justify-between p-2 border-b border-gray-100 last:border-b-0",children:[w.jsx("span",{className:"text-sm font-medium text-gray-800",children:q.name}),w.jsxs("div",{className:"flex space-x-1",children:[w.jsx("button",{onClick:()=>Nn(q),disabled:j,className:"px-2 py-1 text-xs font-medium rounded bg-blue-100 text-blue-700 hover:bg-blue-200 disabled:opacity-50",title:"Apply this theme to the editor",children:"Apply"}),w.jsx("button",{onClick:()=>Jt(q.id,q.name),disabled:j,className:"px-2 py-1 text-xs font-medium rounded bg-red-100 text-red-700 hover:bg-red-200 disabled:opacity-50",title:"Delete this theme permanently",children:"Delete"})]})]},q.id))})]})]})," "]})},Xr=["Github","Facebook","Mail","Instagram","Linkedin","Twitter"],ky=()=>{const[n,t]=F.useState([]),[e,r]=F.useState(!0),[s,o]=F.useState(null),[a,l]=F.useState(!1),[u,d]=F.useState(null),[f,_]=F.useState({name:"",url:"",icon:Xr[0],order:0}),v=F.useMemo(()=>Q?ms(Q,"socialLinks"):null,[]),I=F.useCallback(async()=>{if(!Q||!v){o("Firestore is not initialized correctly."),r(!1);return}r(!0),o(null);try{const D=Qu(v,Hu("order","asc")),m=(await No(D)).docs.map(p=>({...p.data(),id:p.id}));t(m)}catch(D){console.error("Error fetching social links:",D),o("Failed to load social links. Please try again.")}finally{r(!1)}},[v]);F.useEffect(()=>{I()},[I]);const C=D=>{const{name:y,value:m}=D.target;_(p=>({...p,[y]:y==="order"?parseInt(m,10)||0:m}))},S=()=>{l(!1),d(null),_({name:"",url:"",icon:Xr[0],order:0})},R=async D=>{if(D.preventDefault(),!f.name||!f.url||!f.icon){o("Name, URL, and Icon are required.");return}if(o(null),!Q||!v){o("Firestore is not initialized correctly.");return}try{await eh(v,f),S(),I()}catch(y){console.error("Error adding link:",y),o("Failed to add link. Please try again.")}},N=async D=>{if(D.preventDefault(),!u||!f.name||!f.url||!f.icon){o("Name, URL, and Icon are required.");return}if(o(null),!Q){o("Firestore is not initialized correctly.");return}try{const y=xt(Q,"socialLinks",u);await Ui(y,f),S(),I()}catch(y){console.error("Error updating link:",y),o("Failed to update link. Please try again.")}},j=async D=>{if(D===0||!Q)return;o(null);const y=n[D],m=n[D-1],p=Ql(Q),b=xt(Q,"socialLinks",y.id),E=xt(Q,"socialLinks",m.id);p.update(b,{order:m.order}),p.update(E,{order:y.order});try{await p.commit(),I()}catch(A){console.error("Error moving link up:",A),o("Failed to reorder link. Please try again.")}},$=async D=>{if(D===n.length-1||!Q)return;o(null);const y=n[D],m=n[D+1],p=Ql(Q),b=xt(Q,"socialLinks",y.id),E=xt(Q,"socialLinks",m.id);p.update(b,{order:m.order}),p.update(E,{order:y.order});try{await p.commit(),I()}catch(A){console.error("Error moving link down:",A),o("Failed to reorder link. Please try again.")}},z=async D=>{if(window.confirm("Are you sure you want to delete this link?")){if(o(null),!Q){o("Firestore is not initialized correctly.");return}try{const y=xt(Q,"socialLinks",D);await th(y),I()}catch(y){console.error("Error deleting link:",y),o("Failed to delete link. Please try again.")}}},it=D=>{d(D.id),_({name:D.name,url:D.url,icon:D.icon,order:D.order}),l(!1)};return w.jsxs("div",{className:"p-4 md:p-6 bg-gray-800 rounded-lg shadow-lg text-gray-200",children:[w.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"Manage Social Links"}),s&&w.jsx("p",{className:"text-red-400 bg-red-900/50 p-3 rounded mb-4",children:s}),e&&w.jsx("p",{children:"Loading links..."}),(a||u)&&w.jsxs("form",{onSubmit:u?N:R,className:"mb-6 p-4 bg-gray-700 rounded",children:[w.jsx("h3",{className:"text-xl font-medium mb-3 text-white",children:u?"Edit Link":"Add New Link"}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[w.jsx("input",{type:"text",name:"name",placeholder:"Link Name (e.g., GitHub)",value:f.name,onChange:C,className:"p-2 rounded bg-gray-600 text-white border border-gray-500 focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50",required:!0}),w.jsx("input",{type:"url",name:"url",placeholder:"Full URL (e.g., https://github.com/user)",value:f.url,onChange:C,className:"p-2 rounded bg-gray-600 text-white border border-gray-500 focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50",required:!0}),w.jsxs("select",{name:"icon",value:f.icon,onChange:C,className:"p-2 rounded bg-gray-600 text-white border border-gray-500 focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50",required:!0,children:[w.jsx("option",{value:"",disabled:!0,children:"Select Icon"}),Xr.map(D=>w.jsx("option",{value:D,children:D},D))]}),w.jsx("input",{type:"number",name:"order",placeholder:"Order (e.g., 1)",value:f.order,onChange:C,className:"p-2 rounded bg-gray-600 text-white border border-gray-500 focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50",required:!0,min:"0"})]}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("button",{type:"submit",className:"flex items-center gap-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-150 ease-in-out",children:[w.jsx(af,{size:18})," ",u?"Save Changes":"Add Link"]}),w.jsxs("button",{type:"button",onClick:S,className:"flex items-center gap-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded transition duration-150 ease-in-out",children:[w.jsx(Qd,{size:18})," Cancel"]})]})]}),!a&&!u&&w.jsxs("button",{onClick:()=>{l(!0),_({name:"",url:"",icon:Xr[0],order:n.length>0?Math.max(...n.map(D=>D.order))+1:0})},className:"mb-6 flex items-center gap-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-150 ease-in-out",children:[w.jsx(Kd,{size:18})," Add New Link"]}),!e&&n.length>0&&w.jsx("div",{className:"overflow-x-auto",children:w.jsxs("table",{className:"min-w-full bg-gray-700 rounded",children:[w.jsx("thead",{children:w.jsxs("tr",{className:"bg-gray-600",children:[w.jsx("th",{className:"text-left py-2 px-3 text-white",children:"Order"}),w.jsx("th",{className:"text-left py-2 px-3 text-white",children:"Name"}),w.jsx("th",{className:"text-left py-2 px-3 text-white",children:"URL"}),w.jsx("th",{className:"text-left py-2 px-3 text-white",children:"Icon"}),w.jsx("th",{className:"text-left py-2 px-3 text-white",children:"Actions"})]})}),w.jsx("tbody",{children:n.map((D,y)=>w.jsxs("tr",{className:"border-b border-gray-600 hover:bg-gray-600/50",children:[w.jsx("td",{className:"py-2 px-3",children:D.order}),w.jsx("td",{className:"py-2 px-3",children:D.name}),w.jsx("td",{className:"py-2 px-3",children:w.jsx("a",{href:D.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline truncate max-w-xs inline-block",children:D.url})}),w.jsx("td",{className:"py-2 px-3",children:D.icon}),w.jsxs("td",{className:"py-2 px-3 flex items-center gap-1",children:[w.jsx("button",{onClick:()=>j(y),disabled:y===0,className:`p-1 ${y===0?"text-gray-500 cursor-not-allowed":"text-blue-400 hover:text-blue-300"}`,title:"Move Up",children:w.jsx(zd,{size:18})}),w.jsx("button",{onClick:()=>$(y),disabled:y===n.length-1,className:`p-1 ${y===n.length-1?"text-gray-500 cursor-not-allowed":"text-blue-400 hover:text-blue-300"}`,title:"Move Down",children:w.jsx(qd,{size:18})}),w.jsx("button",{onClick:()=>it(D),className:"text-yellow-400 hover:text-yellow-300 p-1",title:"Edit",children:w.jsx(cf,{size:18})}),w.jsx("button",{onClick:()=>z(D.id),className:"text-red-500 hover:text-red-400 p-1",title:"Delete",children:w.jsx(hf,{size:18})})]})]},D.id))})]})}),!e&&n.length===0&&!a&&w.jsx("p",{className:"text-center text-gray-400 mt-4",children:"No social links found. Add one!"})]})},Vy={title:"New Project Title",description:"New project description.",tags:["Tag1","Tag2"],link:""},Pe=(n,t,e,r,s,o,a)=>t.length===1&&t[0]==="projects"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?w.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded",children:[w.jsxs("div",{className:"flex justify-between items-center mb-3",children:[w.jsx("h4",{className:"text-lg font-semibold capitalize",children:String(t[0]).replace(/([A-Z])/g," $1")}),o&&w.jsx("button",{onClick:o,className:"bg-blue-500 hover:bg-blue-700 text-white text-sm font-bold py-1 px-3 rounded focus:outline-none focus:shadow-outline",children:"+ Add Project"})]}),Object.entries(n).map(([l,u])=>{if(l!=="title"&&typeof u=="object"&&u!==null&&!Array.isArray(u)){const d=[...t,l];return w.jsxs("div",{className:"mb-6 p-4 bg-white border border-gray-200 rounded-lg shadow-sm relative",children:[w.jsxs("div",{className:"flex justify-between items-start mb-3",children:[" ",w.jsxs("h5",{className:"text-lg font-semibold text-gray-700 mr-4",children:["Project: ",w.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:l})]}),a&&w.jsx("button",{onClick:()=>{window.confirm(`Are you sure you want to delete project "${l}"?`)&&a(d)},className:"bg-red-500 hover:bg-red-600 text-white text-xs font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline transition-colors duration-150","aria-label":`Delete project ${l}`,children:"Delete Project"})]}),w.jsxs("div",{className:"space-y-4",children:[" ",Pe(u,d,e,r,s,void 0,void 0)]})]},d.join("."))}else if(l==="title"&&typeof u=="string"){const d=[...t,l],f=d.join("."),_=r===f;return w.jsxs("div",{className:"mb-4",children:[w.jsx("label",{htmlFor:f,className:"block text-sm font-medium text-gray-700 capitalize mb-1",children:l.replace(/([A-Z])/g," $1")}),_?w.jsx("input",{type:"text",id:f,name:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2",value:u,onChange:v=>e(d,v.target.value),onBlur:()=>s(null),autoFocus:!0}):w.jsx("div",{className:"mt-1 block w-full rounded-md border border-transparent p-2 cursor-pointer hover:bg-gray-100 min-h-[38px]",onClick:()=>s(f),children:u||w.jsx("span",{className:"text-gray-400 italic",children:"Click to edit..."})})]},f)}return null})]},t.join(".")):Object.entries(n).map(([l,u])=>{const d=[...t,l],f=d.map(String).join("."),_=r===f;return typeof u=="string"?w.jsxs("div",{className:"mb-4",children:[w.jsx("label",{htmlFor:f,className:"block text-sm font-medium text-gray-700 capitalize mb-1",children:l.replace(/([A-Z])/g," $1")}),_?w.jsx("textarea",{id:f,name:f,rows:u.length>100?4:2,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 bg-white",value:u,onChange:v=>e(d,v.target.value),onBlur:()=>s(null),autoFocus:!0}):w.jsx("div",{className:"mt-1 block w-full rounded-md border border-gray-200 bg-gray-50 p-2 cursor-pointer hover:bg-gray-100 min-h-[50px] whitespace-pre-wrap text-gray-800",onClick:()=>s(f),children:u||w.jsx("span",{className:"text-gray-400 italic",children:"Click to edit..."})})]},f):typeof u=="object"&&u!==null&&!Array.isArray(u)?w.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded",children:[w.jsx("h4",{className:"text-lg font-semibold mb-3 capitalize",children:String(l).replace(/([A-Z])/g," $1")}),Pe(u,d,e,r,s)]},f):Array.isArray(u)?w.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-white shadow-sm",children:[w.jsx("h4",{className:"text-lg font-semibold mb-3 capitalize text-gray-700",children:String(l).replace(/([A-Z])/g," $1")}),w.jsxs("div",{className:"space-y-3",children:[" ",u.map((v,I)=>{const C=[...d,I],S=C.map(String).join("."),R=r===S;return typeof v=="string"?w.jsxs("div",{className:"flex items-center space-x-2",children:[R?w.jsx("input",{type:"text",id:S,name:S,className:"flex-grow rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 bg-white",value:v,onChange:N=>e(C,N.target.value),onBlur:()=>s(null),autoFocus:!0}):w.jsx("div",{className:"flex-grow rounded-md border border-gray-200 bg-gray-50 p-2 cursor-pointer hover:bg-gray-100 min-h-[38px] text-gray-800",onClick:()=>s(S),children:v||w.jsx("span",{className:"text-gray-400 italic",children:"Click to edit..."})}),a&&w.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this item?")&&a(C)},className:"bg-red-400 hover:bg-red-600 text-white text-xs font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline transition-colors duration-150","aria-label":`Delete item ${I+1}`,children:"Delete"})]},S):typeof v=="object"&&v!==null?w.jsxs("div",{className:"mb-4 p-3 border border-gray-100 rounded relative",children:[" ",w.jsxs("div",{className:"flex justify-between items-center mb-2",children:[" ",w.jsxs("h5",{className:"text-md font-medium",children:["Item ",I+1]}),a&&w.jsx("button",{onClick:()=>{window.confirm(`Are you sure you want to delete Item ${I+1}?`)&&a(C)},className:"bg-red-400 hover:bg-red-600 text-white text-xs font-bold py-0.5 px-1.5 rounded focus:outline-none focus:shadow-outline","aria-label":`Delete item ${I+1}`,children:"Delete"})]}),Pe(v,C,e,r,s,void 0,a)]},S):null})]})," "]},f):null}),Ny=(n,t,e)=>{if(!t||t.length===0)return n;const r=JSON.parse(JSON.stringify(n));let s=r;for(let a=0;a<t.length-1;a++){const l=t[a];if(s[l]===void 0||s[l]===null){const u=typeof t[a+1]=="number";s[l]=u?[]:{}}if(Array.isArray(s)&&typeof l=="number")for(;s.length<=l;)s.push(null);s=s[l]}const o=t[t.length-1];return typeof s!="object"||s===null?(console.error("Cannot set property on non-object:",s,"at path",t),n):(s[o]=e,r)},Dy={title:"New Service Title",description:"New service description."},vi=n=>n.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()),Xn="translations/en",Ly=()=>{var y;const n=uc(),[t,e]=F.useState(Mt),[r,s]=F.useState(!0),[o,a]=F.useState(""),[l,u]=F.useState(""),[d,f]=F.useState(null),[_,v]=F.useState(null);F.useMemo(()=>{if(t&&t.en){const m=Object.keys(t.en);return d===null&&m.length>0&&f(m[0]),m}return[]},[t,d]),F.useEffect(()=>{if(!Q){console.error("Firestore instance is not available."),a("Error: Firestore connection failed."),s(!1);return}const m=xt(Q,Xn);s(!0);const p=nh(m,b=>{if(b.exists()){const E=b.data();e(A=>({...A,en:E}))}else e(Mt),console.log("No translations document found in Firestore, using defaults.");s(!1)},b=>{console.error("Firestore snapshot error:",b),a("Error fetching data from Firestore."),s(!1)});return()=>p()},[]);const I=async()=>{if(u(""),!Ne){console.error("Firebase auth instance is not available."),u("Logout service unavailable. Please try again later.");return}try{await Cd(Ne),n("/admin/login")}catch(m){console.error("Logout failed:",m),u("Failed to log out. Please try again.")}},C=F.useCallback((m,p)=>{e(b=>{const E="en";if(!m||m.length===0)return b;const A=Ny(b[E],m,p);return{...b,[E]:A}}),a("")},[]),S=F.useCallback(()=>{e(m=>{const p=`project_${Date.now()}`,b={...m.en};return(typeof b.projects!="object"||b.projects===null)&&(b.projects={title:Mt.en.projects.title}),b.projects[p]={...Vy},{...m,en:b}}),a("New project added. Edit details and save."),d!=="projects"&&f("projects")},[d]),R=F.useCallback(()=>{e(m=>{var T;const p=(T=m.en)==null?void 0:T.services,E=[...Array.isArray(p==null?void 0:p.list)?p.list:[],{...Dy}],A={...m.en,services:{...p||{title:Mt.en.services.title||"Services",list:[]},list:E}};return{...m,en:A}}),a("New service added. Edit details and save."),d!=="services"&&f("services")},[d]),N=async m=>{const p=t.en;if(!Q){a("Error: Firestore connection failed.");return}a("Saving...");try{const b=xt(Q,Xn);await Oi(b,p,{merge:!0}),a("Content changes saved successfully!"),setTimeout(()=>a(""),3e3)}catch(b){console.error("Failed to save translations to Firestore:",b),a("Error saving content changes."),setTimeout(()=>a(""),5e3)}},j=async m=>{if(!Q){a("Error: Firestore connection failed.");return}a("Deleting item...");const p=xt(Q,Xn);try{await Ui(p,{[m]:Tp()})}catch(b){console.error("Failed to delete item from Firestore:",b),a("Error deleting item."),setTimeout(()=>a(""),5e3)}},$=F.useCallback(async m=>{var p;if(!m||m.length<1){console.error("Invalid path for deletion:",m),a("Error: Invalid deletion path.");return}if(m[0]==="services"&&m[1]==="list"&&typeof m[2]=="number"){const b=m[2],E=(p=t.en.services)==null?void 0:p.list;if(!Array.isArray(E)){console.error("Cannot delete service item: services.list is not an array or is missing.",E),a("Error: Services data structure issue.");return}const A=E.filter((lt,Ot)=>Ot!==b);if(!Q){a("Error: Firestore connection failed.");return}a("Deleting service item...");const T=xt(Q,Xn);try{await Ui(T,{"services.list":A})}catch(lt){console.error("Failed to update services list in Firestore:",lt),a("Error deleting service item."),setTimeout(()=>a(""),5e3)}}else{const b=m.join(".");if(!b){console.error("Generated empty field path for deletion:",m),a("Error: Could not determine field to delete.");return}await j(b)}},[(y=t.en.services)==null?void 0:y.list,Q]),z=async()=>{if(!Q){a("Error: Firestore connection failed.");return}if(window.confirm("Are you sure you want to reset the English text content (About, Contact, Services, General Info) to the default values? This cannot be undone and does not affect Projects, Styles, or Social Links.")){a("Resetting...");const m={...Mt.en,projects:t.en.projects};try{const p=xt(Q,Xn);await Oi(p,m),a("Text content sections reset to defaults."),setTimeout(()=>a(""),3e3)}catch(p){console.error("Failed to reset translations in Firestore:",p),a("Error resetting content."),setTimeout(()=>a(""),5e3)}}},it=m=>m===null?!1:m in Mt.en,D=()=>{if(r)return w.jsx("p",{className:"text-gray-500 text-center py-10",children:"Loading content..."});if(!d)return w.jsx("p",{className:"text-gray-500",children:"Select a section above to start editing."});if(d==="styleEditor")return w.jsx(Sy,{});if(d==="socialLinks")return w.jsx(ky,{});if(it(d)){const m=vi(d);return w.jsxs(w.Fragment,{children:[w.jsxs("h3",{className:"text-xl font-semibold mb-4 text-gray-700 capitalize",children:["Editing: ",m," Content"]}),d==="projects"?(()=>{const p=t.en.projects;return w.jsx(xp,{data:p,path:[d],handleChange:C,editingPath:_,setEditingPath:v,handleAddProject:S,handleDelete:$,renderFields:Pe})})():d==="services"?(()=>{const p=t.en.services;if(!p||typeof p!="object"||!Array.isArray(p.list)){console.error("Services data is not in the expected format:",p);const b={title:"Services",list:[]};return w.jsx(Hl,{data:b,path:[d],handleChange:C,editingPath:_,setEditingPath:v,handleAddService:R,handleDelete:$,renderFields:Pe})}return w.jsx(Hl,{data:p,path:[d],handleChange:C,editingPath:_,setEditingPath:v,handleAddService:R,handleDelete:$,renderFields:Pe})})():Pe(t.en[d],[d],C,_,v,void 0,$),d==="generalInfo"&&t.en.about&&w.jsxs(w.Fragment,{children:[w.jsxs("h4",{className:"text-lg font-semibold mt-6 mb-3 text-gray-600 capitalize",children:[vi("about")," Content (Merged)"]}),Pe(t.en.about,["about"],C,_,v,void 0,$)]})]})}return w.jsxs("p",{className:"text-red-500",children:["Error: Invalid tab '",d,"' selected."]})};return w.jsxs("div",{className:"p-4 md:p-6 bg-gray-100 min-h-screen",children:[w.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 pb-4 border-b border-gray-300 gap-4",children:[w.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800",children:"Admin Dashboard"}),w.jsxs("div",{className:"flex gap-2 flex-wrap justify-center sm:justify-end",children:[w.jsx("button",{onClick:z,className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-sm transition-colors",title:"Reset text content (About, Contact, Services, General Info) to defaults. Does not affect Projects, Styles, or Social Links.",children:"Reset Text Defaults"}),w.jsx("button",{onClick:I,className:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline text-sm transition-colors",children:"Logout"})]}),l&&w.jsx("p",{className:"text-red-500 text-xs italic w-full text-center sm:text-right mt-2",children:l})]}),w.jsx("div",{className:"mb-6 border-b border-gray-300",children:w.jsx("nav",{className:"-mb-px flex space-x-4 sm:space-x-6 overflow-x-auto pb-px","aria-label":"Tabs",children:["generalInfo","socialLinks","projects","services","contact","styleEditor"].map(m=>{let p;if(m==="styleEditor")p="Style Editor";else if(m==="socialLinks")p="Social Links";else if(it(m))p=vi(m);else return null;return w.jsx("button",{onClick:()=>f(m),className:`${d===m?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm capitalize transition-colors duration-150`,"aria-current":d===m?"page":void 0,children:p},m)})})}),w.jsx("div",{className:"bg-white p-4 md:p-6 rounded-lg shadow-md",children:D()}),w.jsxs("div",{className:"mt-6 text-right flex justify-end items-center gap-4",children:[o&&w.jsx("span",{className:"text-green-600 text-sm transition-opacity duration-300",children:o}),w.jsx("button",{onClick:()=>N(),className:`bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-5 rounded focus:outline-none focus:shadow-outline transition-all duration-150 text-sm ${d==="styleEditor"||d==="socialLinks"?"opacity-50 cursor-not-allowed":"opacity-100"}`,disabled:d==="styleEditor"||d==="socialLinks",title:d==="styleEditor"||d==="socialLinks"?"Changes are saved directly within this tab":"Save text content changes",children:"Save Content Changes"})]})]})},My=(n=Mt)=>{const t=n.en,e=t==null?void 0:t.projects,r=e?Object.entries(e).filter(([s,o])=>s!=="title"&&typeof o=="object"&&o!==null).map(([s,o])=>({title:(o==null?void 0:o.title)??`Project ${s}`,description:(o==null?void 0:o.description)??"Description missing.",tags:(o==null?void 0:o.tags)??[],link:(o==null?void 0:o.link)??""})):[];return{title:(e==null?void 0:e.title)??"Featured Projects",projects:r}},jy=({logoUrl:n})=>w.jsx("img",{src:n||"https://raw.githubusercontent.com/tiger3homs/home/refs/heads/main/public/logo.png",alt:"Logo",className:"mx-auto mb-6 w-24 h-24",style:{pointerEvents:"none",userSelect:"none"}}),Fy=F.lazy(()=>zi(()=>import("./ServicesSection-CojDcNF_.js"),__vite__mapDeps([0,1,2]))),Oy=F.lazy(()=>zi(()=>import("./ProjectsSection-BoCnFBN1.js"),__vite__mapDeps([3,1,2]))),Uy=F.lazy(()=>zi(()=>import("./ContactSection-BrHP75uJ.js"),__vite__mapDeps([4,1,2]))),$y=6e4;let cc=0;const qy=n=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),By=n=>n.length>=10&&n.length<=1e3,zy={Github:Jd,Facebook:Xd,Mail:sf,Instagram:tf,Linkedin:nf,Twitter:ff},Gy=({children:n})=>{const[t,e]=F.useState(null),[r,s]=F.useState(!0);return F.useEffect(()=>{if(!Ne){s(!1);return}const o=dc(Ne,a=>{e(a),s(!1)});return()=>o()},[]),r?w.jsx("div",{className:"flex items-center justify-center min-h-screen",children:w.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"})}):t?n:w.jsx(hc,{to:"/admin/login",replace:!0})},Ky=()=>{const[n,t]=F.useState(Mt),[e,r]=F.useState(!0);F.useEffect(()=>{if(!Q){console.error("MainSite: Firestore instance is not available."),r(!1);return}const S=xt(Q,"translations/en");r(!0);const R=nh(S,N=>{if(N.exists()){const j=N.data();t($=>({...$,en:{...Mt.en,...j}}))}else t(Mt),console.log("MainSite: No translations document found in Firestore, using defaults.");r(!1)},N=>{console.error("MainSite: Firestore snapshot error:",N),t(Mt),r(!1)});return()=>R()},[]);const s=F.useMemo(()=>n.en,[n]),[o,a]=F.useState([]),[l,u]=F.useState({name:"",email:"",message:""}),d=F.useCallback(S=>{const{name:R,value:N}=S.target;u(j=>({...j,[R]:N}))},[]),f=F.useCallback(async S=>{S.preventDefault();const R=Date.now();if(R-cc<$y){alert("Please wait a minute before sending another message.");return}if(!qy(l.email)){alert("Please enter a valid email address.");return}if(!By(l.message)){alert("Message must be between 10 and 1000 characters.");return}cc=R;try{Wa.init("skwn_-DYfDakGK644"),await Wa.send("service_bdj14o3","template_2e2nikq",{name:l.name,email:l.email,message:l.message,to_email:"tiger3homs@gmail.com"}),alert("Message sent successfully!"),u({name:"",email:"",message:""})}catch(N){console.error("Failed to send message:",N),alert("Failed to send message. Please try again.")}},[l]);F.useEffect(()=>{(async()=>{if(Q)try{const R=ms(Q,"socialLinks"),N=Qu(R,Hu("order","asc")),$=(await No(N)).docs.map(z=>({id:z.id,...z.data()}));a($)}catch(R){console.error("Error fetching social links:",R)}})()},[]);const _=F.useMemo(()=>My(n),[n]),v=w.jsx("div",{className:"flex items-center justify-center p-8",children:w.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})});return e?w.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:w.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"})}):w.jsxs("div",{className:"min-h-screen text-white ltr",style:{background:"linear-gradient(to bottom right, var(--background-from-color, #111827), var(--background-to-color, #1F2937))"},children:[w.jsx("header",{className:"container mx-auto px-4 py-16 md:py-32",children:w.jsxs("div",{className:"max-w-3xl mx-auto text-center",children:[w.jsx(jy,{logoUrl:s.generalInfo.logoUrl}),w.jsx("h1",{className:"text-4xl md:text-6xl font-bold mb-6 text-primary",style:{pointerEvents:"none",userSelect:"none"},children:s.generalInfo.siteTitle}),w.jsx("p",{className:"text-xl md:text-2xl text-secondary mb-8",style:{pointerEvents:"none",userSelect:"none"},children:s.generalInfo.siteRole}),w.jsx("div",{className:"flex justify-center space-x-6",children:o.map(S=>{const R=zy[S.icon];return R?w.jsx("a",{href:S.url,target:"_blank",rel:"noopener noreferrer","aria-label":S.name,className:"text-primary hover:text-text transition-colors transform hover:scale-110",children:w.jsx(R,{size:24})},S.id):null})})]})}),w.jsx(F.Suspense,{fallback:v,children:w.jsx(Oy,{title:_.title,projects:_.projects})}),w.jsx("section",{className:"container mx-auto px-4 py-16 bg-gray-800/50 backdrop-blur-sm",children:w.jsxs("div",{className:"max-w-3xl mx-auto",children:[w.jsx("h2",{className:"text-3xl font-bold text-center mb-8",style:{color:"var(--title-color)"},children:s.about.title}),w.jsx("p",{className:"text-lg leading-relaxed text-text",children:s.about.description})]})}),w.jsx(F.Suspense,{fallback:v,children:w.jsx(Fy,{title:s.services.title,services:s.services.list})}),w.jsx(F.Suspense,{fallback:v,children:w.jsx(Uy,{t:s.contact,handleSubmit:f,formData:l,handleInputChange:d})}),w.jsx("footer",{className:"container mx-auto px-4 py-8 text-center",children:w.jsx("p",{className:"text-secondary",children:s.generalInfo.footerText})})]})};function Wy(){const n="/home/";return F.useEffect(()=>{(async()=>{if(!Q){console.error("App.tsx: Firestore not initialized correctly for loading styles.");return}const e=xt(Q,"settings","styles");try{console.log("App.tsx: Attempting to load global styles...");const r=await Zu(e);if(r.exists()){const s=r.data();document.documentElement.style.setProperty("--primary-color",s.primaryColor),document.documentElement.style.setProperty("--secondary-color",s.secondaryColor),document.documentElement.style.setProperty("--font-family",s.fontFamily),s.titleColor&&document.documentElement.style.setProperty("--title-color",s.titleColor),s.h3TitleColor&&document.documentElement.style.setProperty("--h3title-color",s.h3TitleColor),s.textColor&&document.documentElement.style.setProperty("--text-color",s.textColor),s.backgroundFromColor&&document.documentElement.style.setProperty("--background-from-color",s.backgroundFromColor),s.backgroundToColor&&document.documentElement.style.setProperty("--background-to-color",s.backgroundToColor),console.log("App.tsx: Global styles applied from Firestore:",s)}else console.log("App.tsx: No global styles document found in Firestore, using CSS defaults.")}catch(r){console.error("App.tsx: Error loading global styles from Firestore:",r)}})()},[]),w.jsx(ud,{basename:n,children:w.jsxs(hd,{children:[w.jsx(Ur,{path:"/",element:w.jsx(Ky,{})}),w.jsx(Ur,{path:"/admin/login",element:w.jsx(Ip,{})}),w.jsx(Ur,{path:"/admin/dashboard",element:w.jsx(Gy,{children:w.jsx(Ly,{})})}),w.jsx(Ur,{path:"/admin",element:w.jsx(hc,{to:"/admin/login",replace:!0})})]})})}gc(document.getElementById("root")).render(w.jsx(F.StrictMode,{children:w.jsx(Wy,{})}));export{Xt as c,w as j};
//# sourceMappingURL=index-DTOCV88l.js.map
